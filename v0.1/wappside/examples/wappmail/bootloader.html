<html>
<script language="JavaScript" type="text/javascript" src="../../unhosted/prng4.js"></script>
<script language="JavaScript" type="text/javascript" src="../../unhosted/rng.js"></script>
<script language="JavaScript" type="text/javascript" src="../../unhosted/rijndael.js"></script>
<script language="JavaScript" type="text/javascript" src="../../unhosted/sha1.js"></script>
<script language="JavaScript" type="text/javascript" src="../../unhosted/jsbn.js"></script>
<script language="JavaScript" type="text/javascript" src="../../unhosted/unhosted.js"></script>
<script>
function login() {
	/*global*/ unhosted = Unhosted();
	unhosted.importPub({
		"r":document.getElementById("r").value,
		"c":document.getElementById("c").value,
		"n":document.getElementById("n").value,
		"w":document.getElementById("w").value,
		"d":document.getElementById("d").value}, "me");
}
function receiveMail() {
	var messages = unhosted.receive("me", "inbox");
	document.getElementById("readMail").innerHTML = "<table border='1'><tr><td><b>From</b></td><td><b>Message</b></td></tr>";
	for(msg in messages) {
		document.getElementById("readMail").innerHTML = document.getElementById("readMail").innerHTML 
			+ "<tr><td>" + messages[msg].SenderSub.r+"@"+messages[msg].SenderSub.c + "</td><td>" + messages[msg].body + "</td></tr>";
		unhosted.set("me", "addressbook/"+messages[msg].SenderSub.r+"@"+messages[msg].SenderSub.c, messages[msg].SenderSub.n); 
	}
	document.getElementById("readMail").innerHTML = document.getElementById("readMail").innerHTML + "</table>"; 
}
function sendMail() {
	recipient= {
		"r":document.getElementById("to_r").value,
		"c":document.getElementById("to_c").value,
		"n":document.getElementById("to_n").value};
	mySenderSub= {
		"r":document.getElementById("r").value,
		"c":document.getElementById("c").value,
		"n":document.getElementById("n").value};
	unhosted.importSub(recipient, "recipient");
	unhosted.send("me", "recipient", "inbox", 
		JSON.stringify({"body":document.getElementById("writeMail").value.replace(/\n/g, "<br>"),
				"SenderSub":mySenderSub})); 
}
</script>
<body>
<H2>Login:</H2>
email: <textarea id="r" rows="1" cols="10">7db31</textarea>
@<textarea id="c" rows="1" cols="30">demo.unhosted.org</textarea><br>
public key: <textarea id="n" rows="1" cols="128">54e8739e86580ee0407150842f060e00b0188cc419c526a0ed921ff71f77e6551ead679dcfc9b47a96a6cbdee5debbdfbfb5e3e31755ec0ff798627d9d8e7341</textarea><br>
password: <textarea id="w" rows="1" cols="6">0249e</textarea>_<textarea id="d" rows="1" cols="128">a52f956b2c74018d78e908cdc9971f0c90009587b8a2df6c0e95666d1b82886c3b6ae41fd364f1a42b7aff47e1621289e4510a8218285d6fa9448e91849cccaf</textarea><br>
<input type="submit" value="Login" onclick="login();receiveMail();"/>
<table border="1">
<tr><td><p>
<input type="submit" value="Check mail" onclick="receiveMail();"/>
<H2>Read mail:</H2>
<div id="readMail">Loading unhosted json...</div>
</p></td>
<td><p>
<H2>Write mail:</H2>
to: <textarea id="to_r" rows="1" cols="10">140d9</textarea>@<textarea id="to_c" rows="1" cols="30">demo.unhosted.org</textarea><br>:
<textarea id="to_n" rows="1" cols="128">6b334f6f2129abd0a1934c660c69c3ebc4b644df2f04f6de868bddd279136ef7520e031b1ba6541b32d3e9f5a9bfa6d9f9e08da0b0fbd82c4baee473009aadb1</textarea>
<textarea id="writeMail" rows="10" cols="80"> 
hello, world! Let me tell you about this great project called Unhosted... bla bla bla
</textarea>
<br>
<input type="submit" value="Send mail!" onclick="sendMail();"/>
</p></td></tr>
</table>
</body>
</html>

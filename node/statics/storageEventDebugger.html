<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>storage events test</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js">
</script><script type="text/javascript">
function init() {
  $('input').click(change);
  if (window.addEventListener)
    addEventListener('storage', storage_event, false);
  else if (window.attachEvent)
    attachEvent('onstorage', storage_event, false);
}

function change(e) {
  var id = this.id;
  var nv = /^(\D+)(\d+)/.exec(id);
  var del = /^de(.*)/.exec(id);
  if (del) {
    rm(del[1]);
  } else if (nv) {
    var name = nv[1], value = nv[2];
    set(name, value);
  } else {
    log('Triggering a clear all event.');
    localStorage.clear();
  }
}

function rm(name) {
  log('Triggering deletion of '+ val(name));
  localStorage.removeItem(name);
}

function set(name, value) {
  log('Triggering assignment of '+ val(name) +' = '+ val(value));
  localStorage.setItem(name, value);
}

function log(msg) {
  var text = $('#log').val();
  $('#log').val(text + msg + "\n");
}

function storage_event(e) {
  log('Got '+ e.type +' event for '+ val(e.key) +' key; new value: '+
      val(e.newValue) +'.');
}

function val(v) {
  if (v === null) return "[null]";
  if (v === '') return "[the empty string]";
  if ('string' == typeof v) return '"'+ v +'"';
  if ('undefined' == typeof v) return '[undefined]';
  return '['+ typeof v + ': '+ v + ']';;
}
</script>

  </head>

  <body onload="init()">
    <h1>Load this document into two or more tabs/windows</h1>

    Then click these buttons to see what happens in the other window:<br>

<input type="button" id="x5" value="Set x=5" />
<input type="button" id="x12" value="Set x=12" />
<input type="button" id="y17" value="Set y=17" />
<input type="button" id="y99" value="Set y=99" />
<input type="button" id="dex" value="Delete x" />
<input type="button" id="dey" value="Delete y" />
<input type="button" id="clr" value="Clear" />

<br>
When setting a key in this window, only other windows should see the event.<br>
Deleting a key should show that key get set to [null] in all other windows.<br>

Clearing all should show a [null] key get set to [null] in all other windows.

<textarea id="log" style="width:100%; height: 400px"></textarea>

<!-- Created: Tue Jan 12 12:48:58 PST 2010 -->
<!-- hhmts start -->
Last modified: Tue Jan 12 14:52:16 PST 2010
<!-- hhmts end -->
  </body>
</html>


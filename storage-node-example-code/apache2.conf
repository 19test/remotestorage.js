<VirtualHost *:80>
</VirtualHost>
<VirtualHost *:443>
	DocumentRoot /var/www

	SSLEngine On

	SSLCertificateFile /root/ssl.crt
	SSLCertificateKeyFile /root/ssl.key
	SSLCertificateChainFile /root/sub.class1.server.ca.pem

	<Location /webdav >
		AuthType Basic
		AuthName "choose a subdir please"
		AuthUserFile /etc/apache2/couchAdmins.passwd
		Require valid-user
	</Location>

	<Location /webdav/federoni.org/mich/sandwiches >
		AuthName "unhosted storage"
		AuthUserFile /etc/apache2/mich.passwd
		<LimitExcept OPTIONS GET>
			Require valid-user
		</LimitExcept>
	</Location>

	<Location /webdav/dev.unhosted.org/mich/sandwiches >
		AuthName "unhosted storage"
		AuthUserFile /etc/apache2/mich.passwd
		<LimitExcept OPTIONS GET>
			Require valid-user
		</LimitExcept>
	</Location>

	<Location /webdav/dev.unhosted.org/mich/jacktodoapp >
		AuthName "unhosted storage"
		AuthUserFile /etc/apache2/mich.passwd
		<LimitExcept OPTIONS GET>
			Require valid-user
		</LimitExcept>
	</Location>

	RequestHeader unset Authorization

	SetEnvIf Origin "(.+)" ORIGIN=$1
	Header always set Access-Control-Allow-Origin %{ORIGIN}e
	Header always set Access-Control-Allow-Methods "GET, PUT"
	Header always set Access-Control-Allow-Credentials "true"
	Header always set Access-Control-Allow-Headers "Authorization"

	AllowEncodedSlashes On
	#ProxyRequests Off
	KeepAlive Off
	ProxyPass /webdav/federoni.org/mich http://localhost:5984 nocanon
	ProxyPassReverse /webdav/federoni.org/mich http://localhost:5984
	ProxyPass /webdav/dev.unhosted.org/mich http://localhost:5984 nocanon
	ProxyPassReverse /webdav/dev.unhosted.org/mich http://localhost:5984
	ErrorLog "/var/log/apache2/error.log"
	CustomLog "/var/log/apache2/access.log" common
</VirtualHost>

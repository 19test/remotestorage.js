!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("xmlhttprequest")):"function"==typeof define&&define.amd?define("RemoteStorage",["xmlhttprequest"],t):"object"==typeof exports?exports.RemoteStorage=t(require("xmlhttprequest")):e.RemoteStorage=t(e.xmlhttprequest)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){r(1),e.exports=r(4)},function(e,t,r){(function(t,r,n){/* @preserve
	 * The MIT License (MIT)
	 * 
	 * Copyright (c) 2013-2015 Petka Antonov
	 * 
	 * Permission is hereby granted, free of charge, to any person obtaining a copy
	 * of this software and associated documentation files (the "Software"), to deal
	 * in the Software without restriction, including without limitation the rights
	 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	 * copies of the Software, and to permit persons to whom the Software is
	 * furnished to do so, subject to the following conditions:
	 * 
	 * The above copyright notice and this permission notice shall be included in
	 * all copies or substantial portions of the Software.
	 * 
	 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
	 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	 * THE SOFTWARE.
	 * 
	 */
!function(t){e.exports=t()}(function(){var e,o,i;return function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof _dereq_&&_dereq_;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof _dereq_&&_dereq_,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,r){"use strict";t.exports=function(e){function t(e){var t=new r(e),n=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),n}var r=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,r,n){"use strict";function o(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=c}function i(e,t,r){this._lateQueue.push(e,t,r),this._queueTick()}function s(e,t,r){this._normalQueue.push(e,t,r),this._queueTick()}function a(e){this._normalQueue._pushOne(e),this._queueTick()}var u;try{throw new Error}catch(e){u=e}var c=e("./schedule"),l=e("./queue"),h=e("./util");o.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},o.prototype.hasCustomScheduler=function(){return this._customScheduler},o.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},o.prototype.disableTrampolineIfNecessary=function(){h.hasDevTools&&(this._trampolineEnabled=!1)},o.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},o.prototype.fatalError=function(e,r){r?(t.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),t.exit(2)):this.throwLater(e)},o.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},h.hasDevTools?(o.prototype.invokeLater=function(e,t,r){this._trampolineEnabled?i.call(this,e,t,r):this._schedule(function(){setTimeout(function(){e.call(t,r)},100)})},o.prototype.invoke=function(e,t,r){this._trampolineEnabled?s.call(this,e,t,r):this._schedule(function(){e.call(t,r)})},o.prototype.settlePromises=function(e){this._trampolineEnabled?a.call(this,e):this._schedule(function(){e._settlePromises()})}):(o.prototype.invokeLater=i,o.prototype.invoke=s,o.prototype.settlePromises=a),o.prototype.invokeFirst=function(e,t,r){this._normalQueue.unshift(e,t,r),this._queueTick()},o.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var r=e.shift(),n=e.shift();t.call(r,n)}else t._settlePromises()}},o.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},o.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},o.prototype._reset=function(){this._isTickUsed=!1},r.exports=o,r.exports.firstLineError=u},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){var o=!1,i=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(i,i,null,this,e)},a=function(e,t){0===(50397184&this._bitField)&&this._resolveCallback(t.target)},u=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(i){o||(o=!0,e.prototype._propagateFrom=n.propagateFromFunction(),e.prototype._boundValue=n.boundValueFunction());var c=r(i),l=new e(t);l._propagateFrom(this,1);var h=this._target();if(l._setBoundTo(c),c instanceof e){var f={promiseRejectionQueued:!1,promise:l,target:h,bindingPromise:c};h._then(t,s,void 0,l,f),c._then(a,u,void 0,l,f),l._setOnCancel(c)}else l._resolveCallback(h);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=this._bitField&-2097153},e.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},e.bind=function(t,r){return e.resolve(r).bind(t)}}},{}],4:[function(e,t,r){"use strict";function n(){try{Promise===i&&(Promise=o)}catch(e){}return i}var o;"undefined"!=typeof Promise&&(o=Promise);var i=e("./promise")();i.noConflict=n,t.exports=i},{"./promise":22}],5:[function(e,t,r){"use strict";var n=Object.create;if(n){var o=n(null),i=n(null);o[" size"]=i[" size"]=0}t.exports=function(t){function r(e,r){var n;if(null!=e&&(n=e[r]),"function"!=typeof n){var o="Object "+a.classString(e)+" has no method '"+a.toString(r)+"'";throw new t.TypeError(o)}return n}function n(e){var t=this.pop(),n=r(e,t);return n.apply(e,this)}function o(e){return e[this]}function i(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var s,a=e("./util"),u=a.canEvaluate;a.isIdentifier;t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(n,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t,r="number"==typeof e;if(r)t=i;else if(u){var n=s(e);t=null!==n?n:o}else t=o;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,r){"use strict";t.exports=function(t,r,n,o){var i=e("./util"),s=i.tryCatch,a=i.errorObj,u=t._async;t.prototype.break=t.prototype.cancel=function(){if(!o.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var r=e._cancellationParent;if(null==r||!r._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=r}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(i.isArray(e))for(var r=0;r<e.length;++r)this._doInvokeOnCancel(e[r],t);else if(void 0!==e)if("function"==typeof e){if(!t){var n=s(e).call(this._boundValue());n===a&&(this._attachExtraTrace(n.e),u.throwLater(n.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,r){"use strict";t.exports=function(t){function r(e,r,a){return function(u){var c=a._boundValue();e:for(var l=0;l<e.length;++l){var h=e[l];if(h===Error||null!=h&&h.prototype instanceof Error){if(u instanceof h)return i(r).call(c,u)}else if("function"==typeof h){var f=i(h).call(c,u);if(f===s)return f;if(f)return i(r).call(c,u)}else if(n.isObject(u)){for(var p=o(h),d=0;d<p.length;++d){var m=p[d];if(h[m]!=u[m])continue e}return i(r).call(c,u)}}return t}}var n=e("./util"),o=e("./es5").keys,i=n.tryCatch,s=n.errorObj;return r}},{"./es5":13,"./util":36}],8:[function(e,t,r){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(n())}function r(){if(o)return new t}function n(){var e=i.length-1;if(e>=0)return i[e]}var o=!1,i=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=i.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=r,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var r=e.prototype._pushContext,i=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,u=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=r,e.prototype._popContext=i,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=u,o=!1},o=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=n,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,r,n){"use strict";r.exports=function(r,n){function o(e,t){return{promise:t}}function i(){return!1}function s(e,t,r){var n=this;try{e(t,r,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+D.toString(e));n._attachCancellationCallback(e)})}catch(e){return e}}function a(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?D.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function u(){return this._onCancelField}function c(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function h(e,t){if(0!==(1&t)){this._cancellationParent=e;var r=e._branchesRemainingToCancel;void 0===r&&(r=0),e._branchesRemainingToCancel=r+1}0!==(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function f(e,t){0!==(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function p(){var e=this._boundTo;return void 0!==e&&e instanceof r?e.isFulfilled()?e.value():void 0:e}function d(){this._trace=new x(this._peekContext())}function m(e,t){if(B(e)){var r=this._trace;if(void 0!==r&&t&&(r=r._parent),void 0!==r)r.attachExtraTrace(e);else if(!e.__stackCleaned__){var n=T(e);D.notEnumerableProp(e,"stack",n.message+"\n"+n.stack.join("\n")),D.notEnumerableProp(e,"__stackCleaned__",!0)}}}function y(e,t,r,n,o){if(void 0===e&&null!==t&&$){if(void 0!==o&&o._returnedNonUndefined())return;if(0===(65535&n._bitField))return;r&&(r+=" ");var i="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),u=E(a),c=u.length-1;c>=0;--c){var l=u[c];if(!q.test(l)){var h=l.match(H);h&&(i="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(u.length>0)for(var f=u[0],c=0;c<a.length;++c)if(a[c]===f){c>0&&(s="\n"+a[c-1]);break}}var p="a promise was created in a "+r+"handler "+i+"but was not returned from it, see http://goo.gl/rRqMUw"+s;n._warn(p,!0,t)}}function v(e,t){var r=e+" is deprecated and will be removed in a future version.";return t&&(r+=" Use "+t+" instead."),g(r)}function g(e,t,n){if(se.warnings){var o,i=new L(e);if(t)n._attachExtraTrace(i);else if(se.longStackTraces&&(o=r._peekContext()))o.attachExtraTrace(i);else{var s=T(i);i.stack=s.message+"\n"+s.stack.join("\n")}te("warning",i)||C(i,"",!0)}}function _(e,t){for(var r=0;r<t.length-1;++r)t[r].push("From previous event:"),t[r]=t[r].join("\n");return r<t.length&&(t[r]=t[r].join("\n")),e+"\n"+t.join("\n")}function b(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function w(e){for(var t=e[0],r=1;r<e.length;++r){for(var n=e[r],o=t.length-1,i=t[o],s=-1,a=n.length-1;a>=0;--a)if(n[a]===i){s=a;break}for(var a=s;a>=0;--a){var u=n[a];if(t[o]!==u)break;t.pop(),o--}t=n}}function E(e){for(var t=[],r=0;r<e.length;++r){var n=e[r],o="    (No stack trace)"===n||G.test(n),i=o&&ne(n);o&&!i&&(J&&" "!==n.charAt(0)&&(n="    "+n),t.push(n))}return t}function P(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),r=0;r<t.length;++r){var n=t[r];if("    (No stack trace)"===n||G.test(n))break}return r>0&&(t=t.slice(r)),t}function T(e){var t=e.stack,r=e.toString();return t="string"==typeof t&&t.length>0?P(e):["    (No stack trace)"],{message:r,stack:E(t)}}function C(e,t,r){if("undefined"!=typeof console){var n;if(D.isObject(e)){var o=e.stack;n=t+z(o,e)}else n=t+String(e);"function"==typeof M?M(n,r):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function S(e,t,r,n){var o=!1;try{"function"==typeof t&&(o=!0,"rejectionHandled"===e?t(n):t(r,n))}catch(e){U.throwLater(e)}"unhandledRejection"===e?te(e,r,n)||o||C(r,"Unhandled rejection "):te(e,n)}function k(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e&&"function"==typeof e.toString?e.toString():D.toString(e);var r=/\[object [a-zA-Z0-9$_]+\]/;if(r.test(t))try{var n=JSON.stringify(e);t=n}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+A(t)+">, no stack trace)"}function A(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}function R(){return"function"==typeof ie}function j(e){var t=e.match(oe);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function O(e,t){if(R()){for(var r,n,o=e.stack.split("\n"),i=t.stack.split("\n"),s=-1,a=-1,u=0;u<o.length;++u){var c=j(o[u]);if(c){r=c.fileName,s=c.line;break}}for(var u=0;u<i.length;++u){var c=j(i[u]);if(c){n=c.fileName,a=c.line;break}}s<0||a<0||!r||!n||r!==n||s>=a||(ne=function(e){if(V.test(e))return!0;var t=j(e);return!!(t&&t.fileName===r&&s<=t.line&&t.line<=a)})}}function x(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ie(this,x),t>32&&this.uncycle()}var F,I,M,N=r._getDomain,U=r._async,L=e("./errors").Warning,D=e("./util"),B=D.canAttachTrace,V=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,q=/\((?:timers\.js):\d+:\d+\)/,H=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,G=null,z=null,J=!1,Y=!(0==D.env("BLUEBIRD_DEBUG")),W=!(0==D.env("BLUEBIRD_WARNINGS")||!Y&&!D.env("BLUEBIRD_WARNINGS")),K=!(0==D.env("BLUEBIRD_LONG_STACK_TRACES")||!Y&&!D.env("BLUEBIRD_LONG_STACK_TRACES")),$=0!=D.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(W||!!D.env("BLUEBIRD_W_FORGOTTEN_RETURN"));r.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=e._bitField&-1048577|524288},r.prototype._ensurePossibleRejectionHandled=function(){0===(524288&this._bitField)&&(this._setRejectionIsUnhandled(),U.invokeLater(this._notifyUnhandledRejection,this,void 0))},r.prototype._notifyUnhandledRejectionIsHandled=function(){S("rejectionHandled",F,void 0,this)},r.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},r.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},r.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),S("unhandledRejection",I,e,this)}},r.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},r.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},r.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},r.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},r.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},r.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},r.prototype._warn=function(e,t,r){return g(e,t,r||this)},r.onPossiblyUnhandledRejection=function(e){var t=N();I="function"==typeof e?null===t?e:D.domainBind(t,e):void 0},r.onUnhandledRejectionHandled=function(e){var t=N();F="function"==typeof e?null===t?e:D.domainBind(t,e):void 0};var Q=function(){};r.longStackTraces=function(){if(U.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!se.longStackTraces&&R()){var e=r.prototype._captureStackTrace,t=r.prototype._attachExtraTrace;se.longStackTraces=!0,Q=function(){if(U.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");r.prototype._captureStackTrace=e,r.prototype._attachExtraTrace=t,n.deactivateLongStackTraces(),U.enableTrampoline(),se.longStackTraces=!1},r.prototype._captureStackTrace=d,r.prototype._attachExtraTrace=m,n.activateLongStackTraces(),U.disableTrampolineIfNecessary()}},r.hasLongStackTraces=function(){return se.longStackTraces&&R()};var X=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return D.global.dispatchEvent(e),function(e,t){var r=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!D.global.dispatchEvent(r)}}if("function"==typeof Event){var e=new Event("CustomEvent");return D.global.dispatchEvent(e),function(e,t){var r=new Event(e.toLowerCase(),{cancelable:!0});return r.detail=t,!D.global.dispatchEvent(r)}}var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),D.global.dispatchEvent(e),function(e,t){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e.toLowerCase(),!1,!0,t),!D.global.dispatchEvent(r)}}catch(e){}return function(){return!1}}(),Z=function(){return D.isNode?function(){return t.emit.apply(t,arguments)}:D.global?function(e){var t="on"+e.toLowerCase(),r=D.global[t];return!!r&&(r.apply(D.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),ee={promiseCreated:o,promiseFulfilled:o,promiseRejected:o,promiseResolved:o,promiseCancelled:o,promiseChained:function(e,t,r){return{promise:t,child:r}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,r){return{reason:t,promise:r}},rejectionHandled:o},te=function(e){var t=!1;try{t=Z.apply(null,arguments)}catch(e){U.throwLater(e),t=!0}var r=!1;try{r=X(e,ee[e].apply(null,arguments))}catch(e){U.throwLater(e),r=!0}return r||t};r.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?r.longStackTraces():!e.longStackTraces&&r.hasLongStackTraces()&&Q()),"warnings"in e){var t=e.warnings;se.warnings=!!t,$=se.warnings,D.isObject(t)&&"wForgottenReturn"in t&&($=!!t.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!se.cancellation){if(U.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");r.prototype._clearCancellationData=l,r.prototype._propagateFrom=h,r.prototype._onCancel=u,r.prototype._setOnCancel=c,r.prototype._attachCancellationCallback=a,r.prototype._execute=s,re=h,se.cancellation=!0}"monitoring"in e&&(e.monitoring&&!se.monitoring?(se.monitoring=!0,r.prototype._fireEvent=te):!e.monitoring&&se.monitoring&&(se.monitoring=!1,r.prototype._fireEvent=i))},r.prototype._fireEvent=i,r.prototype._execute=function(e,t,r){try{e(t,r)}catch(e){return e}},r.prototype._onCancel=function(){},r.prototype._setOnCancel=function(e){},r.prototype._attachCancellationCallback=function(e){},r.prototype._captureStackTrace=function(){},r.prototype._attachExtraTrace=function(){},r.prototype._clearCancellationData=function(){},r.prototype._propagateFrom=function(e,t){};var re=f,ne=function(){return!1},oe=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;D.inherits(x,Error),n.CapturedTrace=x,x.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],r={},n=0,o=this;void 0!==o;++n)t.push(o),o=o._parent;e=this._length=n;for(var n=e-1;n>=0;--n){var i=t[n].stack;void 0===r[i]&&(r[i]=n)}for(var n=0;n<e;++n){var s=t[n].stack,a=r[s];if(void 0!==a&&a!==n){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[n]._parent=void 0,t[n]._length=1;var u=n>0?t[n-1]:this;a<e-1?(u._parent=t[a+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var c=u._length+1,l=n-2;l>=0;--l)t[l]._length=c,c++;return}}}},x.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=T(e),r=t.message,n=[t.stack],o=this;void 0!==o;)n.push(E(o.stack.split("\n"))),o=o._parent;w(n),b(n),D.notEnumerableProp(e,"stack",_(r,n)),D.notEnumerableProp(e,"__stackCleaned__",!0)}};var ie=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():k(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,G=e,z=t;var r=Error.captureStackTrace;return ne=function(e){return V.test(e)},function(e,t){Error.stackTraceLimit+=6,r(e,t),Error.stackTraceLimit-=6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return G=/@/,z=t,J=!0,function(e){e.stack=(new Error).stack};var o;try{throw new Error}catch(e){o="stack"in e}return"stack"in n||!o||"number"!=typeof Error.stackTraceLimit?(z=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?k(t):t.toString()},null):(G=e,z=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(M=function(e){console.warn(e)},D.isNode&&t.stderr.isTTY?M=function(e,t){var r=t?"[33m":"[31m";console.warn(r+e+"[0m\n")}:D.isNode||"string"!=typeof(new Error).stack||(M=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var se={warnings:W,longStackTraces:!1,cancellation:!1,monitoring:!1};return K&&r.longStackTraces(),{longStackTraces:function(){return se.longStackTraces},warnings:function(){return se.warnings},cancellation:function(){return se.cancellation},monitoring:function(){return se.monitoring},propagateFromFunction:function(){return re},boundValueFunction:function(){return p},checkForgottenReturns:y,setBounds:O,warn:g,deprecated:v,CapturedTrace:x,fireDomEvent:X,fireGlobalEvent:Z}}},{"./errors":12,"./util":36}],10:[function(e,t,r){"use strict";t.exports=function(e){function t(){return this.value}function r(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(r){return r instanceof e&&r.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:r},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(r,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:e},void 0);var t=arguments[1],n=function(){throw t};return this.caught(e,n)},e.prototype.catchReturn=function(r){if(arguments.length<=1)return r instanceof e&&r.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:r},void 0);var n=arguments[1];n instanceof e&&n.suppressUnhandledRejections();var o=function(){return n};return this.caught(r,o)}}},{}],11:[function(e,t,r){"use strict";t.exports=function(e,t){function r(){return i(this)}function n(e,r){return o(e,r,t,t)}var o=e.reduce,i=e.all;e.prototype.each=function(e){return o(this,e,t,0)._then(r,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return o(this,e,t,t)},e.each=function(e,n){return o(e,n,t,0)._then(r,void 0,void 0,e,void 0)},e.mapSeries=n}},{}],12:[function(e,t,r){"use strict";function n(e,t){function r(n){return this instanceof r?(h(this,"message","string"==typeof n?n:t),h(this,"name",e),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new r(n)}return l(r,Error),r}function o(e){return this instanceof o?(h(this,"name","OperationalError"),h(this,"message",e),this.cause=e,this.isOperational=!0,void(e instanceof Error?(h(this,"message",e.message),h(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new o(e)}var i,s,a=e("./es5"),u=a.freeze,c=e("./util"),l=c.inherits,h=c.notEnumerableProp,f=n("Warning","warning"),p=n("CancellationError","cancellation error"),d=n("TimeoutError","timeout error"),m=n("AggregateError","aggregate error");try{i=TypeError,s=RangeError}catch(e){i=n("TypeError","type error"),s=n("RangeError","range error")}for(var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),v=0;v<y.length;++v)"function"==typeof Array.prototype[y[v]]&&(m.prototype[y[v]]=Array.prototype[y[v]]);a.defineProperty(m.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),m.prototype.isOperational=!0;var g=0;m.prototype.toString=function(){var e=Array(4*g+1).join(" "),t="\n"+e+"AggregateError of:\n";g++,e=Array(4*g+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",o=n.split("\n"),i=0;i<o.length;++i)o[i]=e+o[i];n=o.join("\n"),t+=n+"\n"}return g--,t},l(o,Error);var _=Error.__BluebirdErrorTypes__;_||(_=u({CancellationError:p,TimeoutError:d,OperationalError:o,RejectionError:o,AggregateError:m}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:_,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:i,RangeError:s,CancellationError:_.CancellationError,OperationalError:_.OperationalError,TimeoutError:_.TimeoutError,AggregateError:_.AggregateError,Warning:f}},{"./es5":13,"./util":36}],13:[function(e,t,r){var n=function(){"use strict";return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(r&&!r.writable&&!r.set)}};else{var o={}.hasOwnProperty,i={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var r in e)o.call(e,r)&&t.push(r);return t},u=function(e,t){return{value:e[t]}},c=function(e,t,r){return e[t]=r.value,e},l=function(e){return e},h=function(e){try{return Object(e).constructor.prototype}catch(e){return s}},f=function(e){try{return"[object Array]"===i.call(e)}catch(e){return!1}};t.exports={isArray:f,keys:a,names:a,defineProperty:c,getDescriptor:u,freeze:l,getPrototypeOf:h,isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,r){"use strict";t.exports=function(e,t){var r=e.map;e.prototype.filter=function(e,n){return r(this,e,n,t)},e.filter=function(e,n,o){return r(e,n,o,t)}}},{}],15:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e,t,r){this.promise=e,this.type=t,this.handler=r,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function i(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return u.call(this,this.promise._target()._settledValue())}function a(e){if(!i(this,e))return h.e=e,h}function u(e){var n=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(n._boundValue()):u.call(n._boundValue(),e);if(void 0!==c){n._setReturnedNonUndefined();var f=r(c,n);if(f instanceof t){if(null!=this.cancelPromise){if(f._isCancelled()){var p=new l("late cancellation observer");return n._attachExtraTrace(p),h.e=p,h}f.isPending()&&f._attachCancellationCallback(new o(this))}return f._then(s,a,void 0,this,void 0)}}}return n.isRejected()?(i(this),h.e=e,h):(i(this),e)}var c=e("./util"),l=t.CancellationError,h=c.errorObj;return n.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){i(this.finallyHandler)},t.prototype._passThrough=function(e,t,r,o){return"function"!=typeof e?this.then():this._then(r,o,void 0,new n(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},n}},{"./util":36}],16:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,s){function a(e,r,n){for(var i=0;i<r.length;++i){n._pushContext();var s=p(r[i])(e);if(n._popContext(),s===f){n._pushContext();var a=t.reject(f.e);return n._popContext(),a}var u=o(s,n);if(u instanceof t)return u}return null}function u(e,r,o,i){if(s.cancellation()){var a=new t(n),u=this._finallyPromise=new t(n);this._promise=a.lastly(function(){return u}),a._captureStackTrace(),a._setOnCancel(this)}else{var c=this._promise=new t(n);c._captureStackTrace()}this._stack=i,this._generatorFunction=e,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof o?[o].concat(d):d,this._yieldedPromise=null,this._cancellationPhase=!1}var c=e("./errors"),l=c.TypeError,h=e("./util"),f=h.errorObj,p=h.tryCatch,d=[];h.inherits(u,i),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,r="undefined"!=typeof this._generator.return;if(r)this._promise._pushContext(),e=p(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=p(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},u.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=p(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=p(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(e){var r=this._promise;if(e===f)return this._cleanup(),this._cancellationPhase?r.cancel():r._rejectCallback(e.e,!1);var n=e.value;if(e.done===!0)return this._cleanup(),this._cancellationPhase?r.cancel():r._resolveCallback(n);var i=o(n,this._promise);if(!(i instanceof t)&&(i=a(i,this._yieldHandlers,this._promise),null===i))return void this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",n)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));i=i._target();var s=i._bitField;0===(50397184&s)?(this._yieldedPromise=i,i._proxy(this,null)):0!==(33554432&s)?t._async.invoke(this._promiseFulfilled,this,i._value()):0!==(16777216&s)?t._async.invoke(this._promiseRejected,this,i._reason()):this._promiseCancelled()},t.coroutine=function(e,t){if("function"!=typeof e)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=Object(t).yieldHandler,n=u,o=(new Error).stack;return function(){var t=e.apply(this,arguments),i=new n(void 0,void 0,r,o),s=i.promise();return i._generator=t,i._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+h.classString(e));d.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new u(e,this),o=n.promise();
return n._run(t.spawn),o}}},{"./errors":12,"./util":36}],17:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,s){var a=e("./util");a.canEvaluate,a.tryCatch,a.errorObj;t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t];var n}var o=[].slice.call(arguments);e&&o.pop();var n=new r(o).promise();return void 0!==e?n.spread(e):n}}},{"./util":36}],18:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,s){function a(e,t,r,n){this.constructor$(e),this._promise._captureStackTrace();var o=c();this._callback=null===o?t:l.domainBind(o,t),this._preservedValues=n===i?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=[],p.invoke(this._asyncInit,this,void 0)}function u(e,r,o,i){if("function"!=typeof r)return n("expecting a function but got "+l.classString(r));var s=0;if(void 0!==o){if("object"!=typeof o||null===o)return t.reject(new TypeError("options argument must be an object but it is "+l.classString(o)));if("number"!=typeof o.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+l.classString(o.concurrency)));s=o.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new a(e,r,s,i).promise()}var c=t._getDomain,l=e("./util"),h=l.tryCatch,f=l.errorObj,p=t._async;l.inherits(a,r),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,r){var n=this._values,i=this.length(),a=this._preservedValues,u=this._limit;if(r<0){if(r=r*-1-1,n[r]=e,u>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(u>=1&&this._inFlight>=u)return n[r]=e,this._queue.push(r),!1;null!==a&&(a[r]=e);var c=this._promise,l=this._callback,p=c._boundValue();c._pushContext();var d=h(l).call(p,e,r,i),m=c._popContext();if(s.checkForgottenReturns(d,m,null!==a?"Promise.filter":"Promise.map",c),d===f)return this._reject(d.e),!0;var y=o(d,this._promise);if(y instanceof t){y=y._target();var v=y._bitField;if(0===(50397184&v))return u>=1&&this._inFlight++,n[r]=y,y._proxy(this,(r+1)*-1),!1;if(0===(33554432&v))return 0!==(16777216&v)?(this._reject(y._reason()),!0):(this._cancel(),!0);d=y._value()}n[r]=d}var g=++this._totalResolved;return g>=i&&(null!==a?this._filter(n,a):this._resolve(n),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,r=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var n=e.pop();this._promiseFulfilled(r[n],n)}},a.prototype._filter=function(e,t){for(var r=t.length,n=new Array(r),o=0,i=0;i<r;++i)e[i]&&(n[o++]=t[i]);n.length=o,this._resolve(n)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return u(this,e,t,null)},t.map=function(e,t,r,n){return u(e,t,r,n)}}},{"./util":36}],19:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i){var s=e("./util"),a=s.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+s.classString(e));return function(){var n=new t(r);n._captureStackTrace(),n._pushContext();var o=a(e).apply(this,arguments),s=n._popContext();return i.checkForgottenReturns(o,s,"Promise.method",n),n._resolveFromSyncValue(o),n}},t.attempt=t.try=function(e){if("function"!=typeof e)return o("expecting a function but got "+s.classString(e));var n=new t(r);n._captureStackTrace(),n._pushContext();var u;if(arguments.length>1){i.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],l=arguments[2];u=s.isArray(c)?a(e).apply(l,c):a(e).call(l,c)}else u=a(e)();var h=n._popContext();return i.checkForgottenReturns(u,h,"Promise.try",n),n._resolveFromSyncValue(u),n},t.prototype._resolveFromSyncValue=function(e){e===s.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,r){"use strict";function n(e){return e instanceof Error&&l.getPrototypeOf(e)===Error.prototype}function o(e){var t;if(n(e)){t=new c(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var r=l.keys(e),o=0;o<r.length;++o){var i=r[o];h.test(i)||(t[i]=e[i])}return t}return s.markAsOriginatingFromRejection(e),e}function i(e,t){return function(r,n){if(null!==e){if(r){var i=o(a(r));e._attachExtraTrace(i),e._reject(i)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(n);e=null}}}var s=e("./util"),a=s.maybeWrapAsError,u=e("./errors"),c=u.OperationalError,l=e("./es5"),h=/^(?:name|message|stack|cause)$/;t.exports=i},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,r){"use strict";t.exports=function(t){function r(e,t){var r=this;if(!i.isArray(e))return n.call(r,e,t);var o=a(t).apply(r._boundValue(),[null].concat(e));o===u&&s.throwLater(o.e)}function n(e,t){var r=this,n=r._boundValue(),o=void 0===e?a(t).call(n,null):a(t).call(n,null,e);o===u&&s.throwLater(o.e)}function o(e,t){var r=this;if(!e){var n=new Error(e+"");n.cause=e,e=n}var o=a(t).call(r._boundValue(),e);o===u&&s.throwLater(o.e)}var i=e("./util"),s=t._async,a=i.tryCatch,u=i.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var i=n;void 0!==t&&Object(t).spread&&(i=r),this._then(i,o,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,r,n){"use strict";r.exports=function(){function n(){}function o(e,t){if("function"!=typeof t)throw new _("expecting a function but got "+d.classString(t));if(e.constructor!==i)throw new _("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function i(e){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,e!==w&&(o(this,e),this._resolveFromExecutor(e)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function s(e){this.promise._resolveCallback(e)}function a(e){this.promise._rejectCallback(e,!1)}function u(e){var t=new i(w);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var c,l=function(){return new _("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},h=function(){return new i.PromiseInspection(this._target())},f=function(e){return i.reject(new _(e))},p={},d=e("./util");c=d.isNode?function(){var e=t.domain;return void 0===e&&(e=null),e}:function(){return null},d.notEnumerableProp(i,"_getDomain",c);var m=e("./es5"),y=e("./async"),v=new y;m.defineProperty(i,"_async",{value:v});var g=e("./errors"),_=i.TypeError=g.TypeError;i.RangeError=g.RangeError;var b=i.CancellationError=g.CancellationError;i.TimeoutError=g.TimeoutError,i.OperationalError=g.OperationalError,i.RejectionError=g.OperationalError,i.AggregateError=g.AggregateError;var w=function(){},E={},P={},T=e("./thenables")(i,w),C=e("./promise_array")(i,w,T,f,n),S=e("./context")(i),k=S.create,A=e("./debuggability")(i,S),R=(A.CapturedTrace,e("./finally")(i,T)),j=e("./catch_filter")(P),O=e("./nodeback"),x=d.errorObj,F=d.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(e){var t=arguments.length;if(t>1){var r,n=new Array(t-1),o=0;for(r=0;r<t-1;++r){var i=arguments[r];if(!d.isObject(i))return f("expecting an object but got A catch statement predicate "+d.classString(i));n[o++]=i}return n.length=o,e=arguments[r],this.then(void 0,j(n,e,this))}return this.then(void 0,e)},i.prototype.reflect=function(){return this._then(h,h,void 0,this,void 0)},i.prototype.then=function(e,t){if(A.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+d.classString(e);arguments.length>1&&(r+=", "+d.classString(t)),this._warn(r)}return this._then(e,t,void 0,void 0,void 0)},i.prototype.done=function(e,t){var r=this._then(e,t,void 0,void 0,void 0);r._setIsFinal()},i.prototype.spread=function(e){return"function"!=typeof e?f("expecting a function but got "+d.classString(e)):this.all()._then(e,void 0,void 0,E,void 0)},i.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},i.prototype.error=function(e){return this.caught(d.originatesFromRejection,e)},i.getNewLibraryCopy=r.exports,i.is=function(e){return e instanceof i},i.fromNode=i.fromCallback=function(e){var t=new i(w);t._captureStackTrace();var r=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=F(e)(O(t,r));return n===x&&t._rejectCallback(n.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},i.all=function(e){return new C(e).promise()},i.cast=function(e){var t=T(e);return t instanceof i||(t=new i(w),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(e){var t=new i(w);return t._captureStackTrace(),t._rejectCallback(e,!0),t},i.setScheduler=function(e){if("function"!=typeof e)throw new _("expecting a function but got "+d.classString(e));return v.setScheduler(e)},i.prototype._then=function(e,t,r,n,o){var s=void 0!==o,a=s?o:new i(w),u=this._target(),l=u._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!==(2097152&this._bitField)&&(n=0!==(50397184&l)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var h=c();if(0!==(50397184&l)){var f,p,m=u._settlePromiseCtx;0!==(33554432&l)?(p=u._rejectionHandler0,f=e):0!==(16777216&l)?(p=u._fulfillmentHandler0,f=t,u._unsetRejectionIsUnhandled()):(m=u._settlePromiseLateCancellationObserver,p=new b("late cancellation observer"),u._attachExtraTrace(p),f=t),v.invoke(m,u,{handler:null===h?f:"function"==typeof f&&d.domainBind(h,f),promise:a,receiver:n,value:p})}else u._addCallbacks(e,t,a,n,h);return a},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},i.prototype._setLength=function(e){this._bitField=this._bitField&-65536|65535&e},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},i.prototype._setAsyncGuaranteed=function(){v.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},i.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==p)return void 0===t&&this._isBound()?this._boundValue():t},i.prototype._promiseAt=function(e){return this[4*e-4+2]},i.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},i.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),r=e._rejectionHandler0,n=e._promise0,o=e._receiverAt(0);void 0===o&&(o=p),this._addCallbacks(t,r,n,o,null)},i.prototype._migrateCallbackAt=function(e,t){var r=e._fulfillmentHandlerAt(t),n=e._rejectionHandlerAt(t),o=e._promiseAt(t),i=e._receiverAt(t);void 0===i&&(i=p),this._addCallbacks(r,n,o,i,null)},i.prototype._addCallbacks=function(e,t,r,n,o){var i=this._length();if(i>=65531&&(i=0,this._setLength(0)),0===i)this._promise0=r,this._receiver0=n,"function"==typeof e&&(this._fulfillmentHandler0=null===o?e:d.domainBind(o,e)),"function"==typeof t&&(this._rejectionHandler0=null===o?t:d.domainBind(o,t));else{var s=4*i-4;this[s+2]=r,this[s+3]=n,"function"==typeof e&&(this[s+0]=null===o?e:d.domainBind(o,e)),"function"==typeof t&&(this[s+1]=null===o?t:d.domainBind(o,t))}return this._setLength(i+1),i},i.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},i.prototype._resolveCallback=function(e,t){if(0===(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var r=T(e,this);if(!(r instanceof i))return this._fulfill(e);t&&this._propagateFrom(r,2);var n=r._target();if(n===this)return void this._reject(l());var o=n._bitField;if(0===(50397184&o)){var s=this._length();s>0&&n._migrateCallback0(this);for(var a=1;a<s;++a)n._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!==(33554432&o))this._fulfill(n._value());else if(0!==(16777216&o))this._reject(n._reason());else{var u=new b("late cancellation observer");n._attachExtraTrace(u),this._reject(u)}}},i.prototype._rejectCallback=function(e,t,r){var n=d.ensureErrorObject(e),o=n===e;if(!o&&!r&&A.warnings()){var i="a promise was rejected with a non-error: "+d.classString(e);this._warn(i,!0)}this._attachExtraTrace(n,!!t&&o),this._reject(e)},i.prototype._resolveFromExecutor=function(e){var t=this;this._captureStackTrace(),this._pushContext();var r=!0,n=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,r)});r=!1,this._popContext(),void 0!==n&&t._rejectCallback(n,!0)},i.prototype._settlePromiseFromHandler=function(e,t,r,n){var o=n._bitField;if(0===(65536&o)){n._pushContext();var i;t===E?r&&"number"==typeof r.length?i=F(e).apply(this._boundValue(),r):(i=x,i.e=new _("cannot .spread() a non-array: "+d.classString(r))):i=F(e).call(t,r);var s=n._popContext();o=n._bitField,0===(65536&o)&&(i===P?n._reject(r):i===x?n._rejectCallback(i.e,!1):(A.checkForgottenReturns(i,s,"",n,this),n._resolveCallback(i)))}},i.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(e){this._rejectionHandler0=e},i.prototype._settlePromise=function(e,t,r,o){var s=e instanceof i,a=this._bitField,u=0!==(134217728&a);0!==(65536&a)?(s&&e._invokeInternalOnCancel(),r instanceof R&&r.isFinallyHandler()?(r.cancelPromise=e,F(t).call(r,o)===x&&e._reject(x.e)):t===h?e._fulfill(h.call(r)):r instanceof n?r._promiseCancelled(e):s||e instanceof C?e._cancel():r.cancel()):"function"==typeof t?s?(u&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,o,e)):t.call(r,o,e):r instanceof n?r._isResolved()||(0!==(33554432&a)?r._promiseFulfilled(o,e):r._promiseRejected(o,e)):s&&(u&&e._setAsyncGuaranteed(),0!==(33554432&a)?e._fulfill(o):e._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,r=e.promise,n=e.receiver,o=e.value;"function"==typeof t?r instanceof i?this._settlePromiseFromHandler(t,n,o,r):t.call(n,o,r):r instanceof i&&r._reject(o)},i.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},i.prototype._settlePromise0=function(e,t,r){var n=this._promise0,o=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,e,o,t)},i.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},i.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var r=l();return this._attachExtraTrace(r),this._reject(r)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!==(134217728&t)?this._settlePromises():v.settlePromises(this))}},i.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16))return this._setRejected(),this._fulfillmentHandler0=e,this._isFinal()?v.fatalError(e,d.isNode):void((65535&t)>0?v.settlePromises(this):this._ensurePossibleRejectionHandled())},i.prototype._fulfillPromises=function(e,t){for(var r=1;r<e;r++){var n=this._fulfillmentHandlerAt(r),o=this._promiseAt(r),i=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(o,n,i,t)}},i.prototype._rejectPromises=function(e,t){for(var r=1;r<e;r++){var n=this._rejectionHandlerAt(r),o=this._promiseAt(r),i=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(o,n,i,t)}},i.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!==(16842752&e)){var r=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,r,e),this._rejectPromises(t,r)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,e),this._fulfillPromises(t,n)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var e=this._bitField;return 0!==(33554432&e)?this._rejectionHandler0:0!==(16777216&e)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){A.deprecated("Promise.defer","new Promise");var e=new i(w);return{promise:e,resolve:s,reject:a}},d.notEnumerableProp(i,"_makeSelfResolutionError",l),e("./method")(i,w,T,f,A),e("./bind")(i,w,T,A),e("./cancel")(i,C,f,A),e("./direct_resolve")(i),e("./synchronous_inspection")(i),e("./join")(i,C,T,w,v,c),i.Promise=i,i.version="3.4.6",e("./map.js")(i,C,f,T,w,A),e("./call_get.js")(i),e("./using.js")(i,f,T,k,w,A),e("./timers.js")(i,w,A),e("./generators.js")(i,f,w,T,n,A),e("./nodeify.js")(i),e("./promisify.js")(i,w),e("./props.js")(i,C,T,f),e("./race.js")(i,w,T,f),e("./reduce.js")(i,C,f,T,w,A),e("./settle.js")(i,C,A),e("./some.js")(i,C,f),e("./filter.js")(i,w),e("./each.js")(i,w),e("./any.js")(i),d.toFastProperties(i),d.toFastProperties(i.prototype),u({a:1}),u({b:2}),u({c:3}),u(1),u(function(){}),u(void 0),u(!1),u(new i(w)),A.setBounds(y.firstLineError,d.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i){function s(e){switch(e){case-2:return[];case-3:return{}}}function a(e){var n=this._promise=new t(r);e instanceof t&&n._propagateFrom(e,3),n._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=e("./util");u.isArray;return u.inherits(a,i),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(r,i){var a=n(this._values,this._promise);if(a instanceof t){a=a._target();var c=a._bitField;if(this._values=a,0===(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,i);if(0===(33554432&c))return 0!==(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(a=u.asArray(a),null===a){var l=o("expecting an array or an iterable object but got "+u.classString(a)).reason();return void this._promise._rejectCallback(l,!1)}return 0===a.length?void(i===-5?this._resolveEmptyArray():this._resolve(s(i))):void this._iterate(a)},a.prototype._iterate=function(e){var r=this.getActualLength(e.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var o=this._promise,i=!1,s=null,a=0;a<r;++a){var u=n(e[a],o);u instanceof t?(u=u._target(),s=u._bitField):s=null,i?null!==s&&u.suppressUnhandledRejections():null!==s?0===(50397184&s)?(u._proxy(this,a),this._values[a]=u):i=0!==(33554432&s)?this._promiseFulfilled(u._value(),a):0!==(16777216&s)?this._promiseRejected(u._reason(),a):this._promiseCancelled(a):i=this._promiseFulfilled(u,a)}i||o._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var r=++this._totalResolved;return r>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var r=0;r<e.length;++r)e[r]instanceof t&&e[r].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e){return!E.test(e)}function o(e){try{return e.__isPromisified__===!0}catch(e){return!1}}function i(e,t,r){var n=p.getDataPropertyOrDefault(e,t+r,b);return!!n&&o(n)}function s(e,t,r){for(var n=0;n<e.length;n+=2){var o=e[n];if(r.test(o))for(var i=o.replace(r,""),s=0;s<e.length;s+=2)if(e[s]===i)throw new g("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function a(e,t,r,n){for(var a=p.inheritedDataKeys(e),u=[],c=0;c<a.length;++c){var l=a[c],h=e[l],f=n===P||P(l,h,e);"function"!=typeof h||o(h)||i(e,l,t)||!n(l,h,e,f)||u.push(l,h)}return s(u,t,r),u}function u(e,n,o,i,s,a){function u(){var o=n;n===f&&(o=this);var i=new t(r);i._captureStackTrace();var s="string"==typeof l&&this!==c?this[l]:e,u=d(i,a);try{s.apply(o,m(arguments,u))}catch(e){i._rejectCallback(y(e),!0,!0)}return i._isFateSealed()||i._setAsyncGuaranteed(),i}var c=function(){return this}(),l=e;return"string"==typeof l&&(e=i),p.notEnumerableProp(u,"__isPromisified__",!0),u}function c(e,t,r,n,o){for(var i=new RegExp(T(t)+"$"),s=a(e,t,i,r),u=0,c=s.length;u<c;u+=2){var l=s[u],h=s[u+1],d=l+t;if(n===C)e[d]=C(l,f,l,h,t,o);else{var m=n(h,function(){return C(l,f,l,h,t,o)});p.notEnumerableProp(m,"__isPromisified__",!0),e[d]=m}}return p.toFastProperties(e),e}function l(e,t,r){return C(e,t,void 0,e,null,r)}var h,f={},p=e("./util"),d=e("./nodeback"),m=p.withAppended,y=p.maybeWrapAsError,v=p.canEvaluate,g=e("./errors").TypeError,_="Async",b={__isPromisified__:!0},w=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],E=new RegExp("^(?:"+w.join("|")+")$"),P=function(e){return p.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},T=function(e){return e.replace(/([$])/,"\\$")},C=v?h:u;t.promisify=function(e,t){if("function"!=typeof e)throw new g("expecting a function but got "+p.classString(e));if(o(e))return e;t=Object(t);var r=void 0===t.context?f:t.context,i=!!t.multiArgs,s=l(e,r,i);return p.copyDescriptors(e,s,n),s},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new g("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var r=!!t.multiArgs,n=t.suffix;"string"!=typeof n&&(n=_);var o=t.filter;"function"!=typeof o&&(o=P);var i=t.promisifier;if("function"!=typeof i&&(i=C),!p.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=p.inheritedDataKeys(e),a=0;a<s.length;++a){var u=e[s[a]];"constructor"!==s[a]&&p.isClass(u)&&(c(u.prototype,n,o,i,r),c(u,n,o,i,r))}return c(e,n,o,i,r)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,r){"use strict";t.exports=function(t,r,n,o){function i(e){var t,r=!1;if(void 0!==a&&e instanceof a)t=h(e),r=!0;else{var n=l.keys(e),o=n.length;t=new Array(2*o);for(var i=0;i<o;++i){var s=n[i];t[i]=e[s],t[i+o]=s}}this.constructor$(t),this._isMap=r,this._init$(void 0,-3)}function s(e){var r,s=n(e);return c(s)?(r=s instanceof t?s._then(t.props,void 0,void 0,void 0,void 0):new i(s).promise(),s instanceof t&&r._propagateFrom(s,2),r):o("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,u=e("./util"),c=u.isObject,l=e("./es5");"function"==typeof Map&&(a=Map);var h=function(){function e(e,n){this[t]=e,this[t+r]=n,t++}var t=0,r=0;return function(n){r=n.size,t=0;var o=new Array(2*n.size);return n.forEach(e,o),o}}(),f=function(e){for(var t=new a,r=e.length/2|0,n=0;n<r;++n){var o=e[r+n],i=e[n];t.set(o,i)}return t};u.inherits(i,r),i.prototype._init=function(){},i.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var r=++this._totalResolved;if(r>=this._length){var n;if(this._isMap)n=f(this._values);else{n={};for(var o=this.length(),i=0,s=this.length();i<s;++i)n[this._values[i+o]]=this._values[i]}return this._resolve(n),!0}return!1},i.prototype.shouldCopyValues=function(){return!1},i.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return s(this)},t.props=function(e){return s(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,r){"use strict";function n(e,t,r,n,o){for(var i=0;i<o;++i)r[i+n]=e[i+t],e[i+t]=void 0}function o(e){this._capacity=e,this._length=0,this._front=0}o.prototype._willBeOverCapacity=function(e){return this._capacity<e},o.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var r=this._front+t&this._capacity-1;this[r]=e,this._length=t+1},o.prototype._unshiftOne=function(e){var t=this._capacity;this._checkCapacity(this.length()+1);var r=this._front,n=(r-1&t-1^t)-t;this[n]=e,this._front=n,this._length=this.length()+1},o.prototype.unshift=function(e,t,r){this._unshiftOne(r),this._unshiftOne(t),this._unshiftOne(e)},o.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(e),this._pushOne(t),void this._pushOne(r);var o=this._front+n-3;this._checkCapacity(n);var i=this._capacity-1;this[o+0&i]=e,this[o+1&i]=t,this[o+2&i]=r,this._length=n},o.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},o.prototype.length=function(){return this._length},o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,o=this._length,i=r+o&t-1;n(this,0,this,t,i)},t.exports=o},{}],27:[function(e,t,r){"use strict";t.exports=function(t,r,n,o){function i(e,i){var u=n(e);if(u instanceof t)return a(u);if(e=s.asArray(e),null===e)return o("expecting an array or an iterable object but got "+s.classString(e));var c=new t(r);void 0!==i&&c._propagateFrom(i,3);for(var l=c._fulfill,h=c._reject,f=0,p=e.length;f<p;++f){var d=e[f];(void 0!==d||f in e)&&t.cast(d)._then(l,h,void 0,c,null)}return c}var s=e("./util"),a=function(e){return e.then(function(t){return i(t,e)})};t.race=function(e){return i(e,void 0)},t.prototype.race=function(){return i(this,void 0)}}},{"./util":36}],28:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,s){function a(e,r,n,o){this.constructor$(e);var s=f();this._fn=null===s?r:p.domainBind(s,r),void 0!==n&&(n=t.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,o===i?this._eachValues=Array(this._length):0===o?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,r,o){if("function"!=typeof t)return n("expecting a function but got "+p.classString(t));var i=new a(e,t,r,o);return i.promise()}function l(e){this.accum=e,this.array._gotAccum(e);var r=o(this.value,this.array._promise);return r instanceof t?(this.array._currentCancellable=r,r._then(h,void 0,void 0,this,void 0)):h.call(this,r)}function h(e){var r=this.array,n=r._promise,o=d(r._fn);n._pushContext();var i;i=void 0!==r._eachValues?o.call(n._boundValue(),e,this.index,this.length):o.call(n._boundValue(),this.accum,e,this.index,this.length),i instanceof t&&(r._currentCancellable=i);var a=n._popContext();return s.checkForgottenReturns(i,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",n),i}var f=t._getDomain,p=e("./util"),d=p.tryCatch;p.inherits(a,r),a.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==i&&this._eachValues.push(e)},a.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},a.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},a.prototype._iterate=function(e){this._values=e;var r,n,o=e.length;if(void 0!==this._initialValue?(r=this._initialValue,n=0):(r=t.resolve(e[0]),n=1),this._currentCancellable=r,!r.isRejected())for(;n<o;++n){var i={accum:null,value:e[n],index:n,length:o,array:this};r=r._then(l,void 0,void 0,i,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(u,u,void 0,r,this)},t.prototype.reduce=function(e,t){return c(this,e,t,null)},t.reduce=function(e,t,r,n){return c(e,t,r,n)}}},{"./util":36}],29:[function(e,o,i){"use strict";var s,a=e("./util"),u=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},c=a.getNativePromise();if(a.isNode&&"undefined"==typeof MutationObserver){var l=r.setImmediate,h=t.nextTick;s=a.isRecentNode?function(e){l.call(r,e)}:function(e){h.call(t,e)}}else if("function"==typeof c&&"function"==typeof c.resolve){var f=c.resolve();s=function(e){f.then(e)}}else s="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof n?function(e){n(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:u:function(){var e=document.createElement("div"),t={attributes:!0},r=!1,n=document.createElement("div"),o=new MutationObserver(function(){e.classList.toggle("foo"),r=!1});o.observe(n,t);var i=function(){r||(r=!0,n.classList.toggle("foo"))};return function(r){var n=new MutationObserver(function(){n.disconnect(),r()});n.observe(e,t),i()}}();o.exports=s},{"./util":36}],30:[function(e,t,r){"use strict";t.exports=function(t,r,n){function o(e){this.constructor$(e)}var i=t.PromiseInspection,s=e("./util");s.inherits(o,r),o.prototype._promiseResolved=function(e,t){this._values[e]=t;var r=++this._totalResolved;return r>=this._length&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(e,t){var r=new i;return r._bitField=33554432,r._settledValueField=e,this._promiseResolved(t,r)},o.prototype._promiseRejected=function(e,t){var r=new i;return r._bitField=16777216,r._settledValueField=e,this._promiseResolved(t,r)},t.settle=function(e){return n.deprecated(".settle()",".reflect()"),new o(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,r){"use strict";t.exports=function(t,r,n){function o(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function i(e,t){if((0|t)!==t||t<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var r=new o(e),i=r.promise();return r.setHowMany(t),r.init(),i}var s=e("./util"),a=e("./errors").RangeError,u=e("./errors").AggregateError,c=s.isArray,l={};s.inherits(o,r),o.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()));
}},o.prototype.init=function(){this._initialized=!0,this._init()},o.prototype.setUnwrap=function(){this._unwrap=!0},o.prototype.howMany=function(){return this._howMany},o.prototype.setHowMany=function(e){this._howMany=e},o.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},o.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},o.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},o.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new u,t=this.length();t<this._values.length;++t)this._values[t]!==l&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},o.prototype._fulfilled=function(){return this._totalResolved},o.prototype._rejected=function(){return this._values.length-this.length()},o.prototype._addRejected=function(e){this._values.push(e)},o.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},o.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},o.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)},o.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return i(e,t)},t.prototype.some=function(e){return i(this,e)},t._SomePromiseArray=o}},{"./errors":12,"./util":36}],32:[function(e,t,r){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var r=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},o=t.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},i=t.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0===(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!==(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536===(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!==(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return i.call(this._target())},e.prototype.isFulfilled=function(){return o.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return r.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),n.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,r){"use strict";t.exports=function(t,r){function n(e,n){if(l(e)){if(e instanceof t)return e;var o=i(e);if(o===c){n&&n._pushContext();var u=t.reject(o.e);return n&&n._popContext(),u}if("function"==typeof o){if(s(e)){var u=new t(r);return e._then(u._fulfill,u._reject,void 0,u,null),u}return a(e,o,n)}}return e}function o(e){return e.then}function i(e){try{return o(e)}catch(e){return c.e=e,c}}function s(e){try{return h.call(e,"_promise0")}catch(e){return!1}}function a(e,n,o){function i(e){a&&(a._resolveCallback(e),a=null)}function s(e){a&&(a._rejectCallback(e,h,!0),a=null)}var a=new t(r),l=a;o&&o._pushContext(),a._captureStackTrace(),o&&o._popContext();var h=!0,f=u.tryCatch(n).call(e,i,s);return h=!1,a&&f===c&&(a._rejectCallback(f.e,!0,!0),a=null),l}var u=e("./util"),c=u.errorObj,l=u.isObject,h={}.hasOwnProperty;return n}},{"./util":36}],34:[function(e,t,r){"use strict";t.exports=function(t,r,n){function o(e){this.handle=e}function i(e){return clearTimeout(this.handle),e}function s(e){throw clearTimeout(this.handle),e}var a=e("./util"),u=t.TimeoutError;o.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(e){return l(+this).thenReturn(e)},l=t.delay=function(e,i){var s,a;return void 0!==i?(s=t.resolve(i)._then(c,null,null,e,void 0),n.cancellation()&&i instanceof t&&s._setOnCancel(i)):(s=new t(r),a=setTimeout(function(){s._fulfill()},+e),n.cancellation()&&s._setOnCancel(new o(a)),s._captureStackTrace()),s._setAsyncGuaranteed(),s};t.prototype.delay=function(e){return l(e,this)};var h=function(e,t,r){var n;n="string"!=typeof t?t instanceof Error?t:new u("operation timed out"):new u(t),a.markAsOriginatingFromRejection(n),e._attachExtraTrace(n),e._reject(n),null!=r&&r.cancel()};t.prototype.timeout=function(e,t){e=+e;var r,a,u=new o(setTimeout(function(){r.isPending()&&h(r,t,a)},e));return n.cancellation()?(a=this.then(),r=a._then(i,s,void 0,u,void 0),r._setOnCancel(u)):r=this._then(i,s,void 0,u,void 0),r}}},{"./util":36}],35:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,s){function a(e){setTimeout(function(){throw e},0)}function u(e){var t=n(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function c(e,r){function o(){if(s>=c)return l._fulfill();var i=u(e[s++]);if(i instanceof t&&i._isDisposable()){try{i=n(i._getDisposer().tryDispose(r),e.promise)}catch(e){return a(e)}if(i instanceof t)return i._then(o,a,null,null,null)}o()}var s=0,c=e.length,l=new t(i);return o(),l}function l(e,t,r){this._data=e,this._promise=t,this._context=r}function h(e,t,r){this.constructor$(e,t,r)}function f(e){return l.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function p(e){this.length=e,this.promise=null,this[e-1]=null}var d=e("./util"),m=e("./errors").TypeError,y=e("./util").inherits,v=d.errorObj,g=d.tryCatch,_={};l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():_},l.prototype.tryDispose=function(e){var t=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=t!==_?this.doDispose(t,e):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},l.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},y(h,l),h.prototype.doDispose=function(e,t){var r=this.data();return r.call(e,e,t)},p.prototype._resultCancelled=function(){for(var e=this.length,r=0;r<e;++r){var n=this[r];n instanceof t&&n.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return r("you must pass at least 2 arguments to Promise.using");var o=arguments[e-1];if("function"!=typeof o)return r("expecting a function but got "+d.classString(o));var i,a=!0;2===e&&Array.isArray(arguments[0])?(i=arguments[0],e=i.length,a=!1):(i=arguments,e--);for(var u=new p(e),h=0;h<e;++h){var m=i[h];if(l.isDisposer(m)){var y=m;m=m.promise(),m._setDisposable(y)}else{var _=n(m);_ instanceof t&&(m=_._then(f,null,null,{resources:u,index:h},void 0))}u[h]=m}for(var b=new Array(u.length),h=0;h<b.length;++h)b[h]=t.resolve(u[h]).reflect();var w=t.all(b).then(function(e){for(var t=0;t<e.length;++t){var r=e[t];if(r.isRejected())return v.e=r.error(),v;if(!r.isFulfilled())return void w.cancel();e[t]=r.value()}E._pushContext(),o=g(o);var n=a?o.apply(void 0,e):o(e),i=E._popContext();return s.checkForgottenReturns(n,i,"Promise.using",E),n}),E=w.lastly(function(){var e=new t.PromiseInspection(w);return c(u,e)});return u.promise=E,E._setOnCancel(u),E},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new h(e,this,o());throw new m}}},{"./errors":12,"./util":36}],36:[function(e,n,o){"use strict";function i(){try{var e=O;return O=null,e.apply(this,arguments)}catch(e){return j.e=e,j}}function s(e){return O=e,i}function a(e){return null==e||e===!0||e===!1||"string"==typeof e||"number"==typeof e}function u(e){return"function"==typeof e||"object"==typeof e&&null!==e}function c(e){return a(e)?new Error(g(e)):e}function l(e,t){var r,n=e.length,o=new Array(n+1);for(r=0;r<n;++r)o[r]=e[r];return o[r]=t,o}function h(e,t,r){if(!A.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var n=Object.getOwnPropertyDescriptor(e,t);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function f(e,t,r){if(a(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return A.defineProperty(e,t,n),e}function p(e){throw e}function d(e){try{if("function"==typeof e){var t=A.names(e.prototype),r=A.isES5&&t.length>1,n=t.length>0&&!(1===t.length&&"constructor"===t[0]),o=M.test(e+"")&&A.names(e).length>0;if(r||n||o)return!0}return!1}catch(e){return!1}}function m(e){function t(){}t.prototype=e;for(var r=8;r--;)new t;return e}function y(e){return N.test(e)}function v(e,t,r){for(var n=new Array(e),o=0;o<e;++o)n[o]=t+o+r;return n}function g(e){try{return e+""}catch(e){return"[no string representation]"}}function _(e){return null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function b(e){try{f(e,"isOperational",!0)}catch(e){}}function w(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||e.isOperational===!0)}function E(e){return _(e)&&A.propertyIsWritable(e,"stack")}function P(e){return{}.toString.call(e)}function T(e,t,r){for(var n=A.names(e),o=0;o<n.length;++o){var i=n[o];if(r(i))try{A.defineProperty(t,i,A.getDescriptor(e,i))}catch(e){}}}function C(e,r){return B?t.env[e]:r}function S(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function k(e,t){return e.bind(t)}var A=e("./es5"),R="undefined"==typeof navigator,j={e:{}},O,x="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof r?r:void 0!==this?this:null,F=function(e,t){function r(){this.constructor=e,this.constructor$=t;for(var r in t.prototype)n.call(t.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=t.prototype[r])}var n={}.hasOwnProperty;return r.prototype=t.prototype,e.prototype=new r,e.prototype},I=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1};if(A.isES5){var r=Object.getOwnPropertyNames;return function(e){for(var n=[],o=Object.create(null);null!=e&&!t(e);){var i;try{i=r(e)}catch(e){return n}for(var s=0;s<i.length;++s){var a=i[s];if(!o[a]){o[a]=!0;var u=Object.getOwnPropertyDescriptor(e,a);null!=u&&null==u.get&&null==u.set&&n.push(a)}}e=A.getPrototypeOf(e)}return n}}var n={}.hasOwnProperty;return function(r){if(t(r))return[];var o=[];e:for(var i in r)if(n.call(r,i))o.push(i);else{for(var s=0;s<e.length;++s)if(n.call(e[s],i))continue e;o.push(i)}return o}}(),M=/this\s*\.\s*\S+\s*=/,N=/^[a-z$_][a-z$_0-9]*$/i,U=function(){return"stack"in new Error?function(e){return E(e)?e:new Error(g(e))}:function(e){if(E(e))return e;try{throw new Error(g(e))}catch(e){return e}}}(),L=function(e){return A.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var D="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,r=[],n=e[Symbol.iterator]();!(t=n.next()).done;)r.push(t.value);return r};L=function(e){return A.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?D(e):null}}var B="undefined"!=typeof t&&"[object process]"===P(t).toLowerCase(),V={isClass:d,isIdentifier:y,inheritedDataKeys:I,getDataPropertyOrDefault:h,thrower:p,isArray:A.isArray,asArray:L,notEnumerableProp:f,isPrimitive:a,isObject:u,isError:_,canEvaluate:R,errorObj:j,tryCatch:s,inherits:F,withAppended:l,maybeWrapAsError:c,toFastProperties:m,filledRange:v,toString:g,canAttachTrace:E,ensureErrorObject:U,originatesFromRejection:w,markAsOriginatingFromRejection:b,classString:P,copyDescriptors:T,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:B,env:C,global:x,getNativePromise:S,domainBind:k};V.isRecentNode=V.isNode&&function(){var e=t.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),V.isNode&&V.toFastProperties(t);try{throw new Error}catch(e){V.lastLineError=e}n.exports=V},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(t,r(2),function(){return this}(),r(3).setImmediate)},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function i(e){if(h===clearTimeout)return clearTimeout(e);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function s(){m&&p&&(m=!1,p.length?d=p.concat(d):y=-1,d.length&&a())}function a(){if(!m){var e=o(s);m=!0;for(var t=d.length;t;){for(p=d,d=[];++y<t;)p&&p[y].run();y=-1,t=d.length}p=null,m=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,h,f=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(e){h=n}}();var p,d=[],m=!1,y=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new u(e,t)),1!==d.length||m||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,r){(function(e,n){function o(e,t){this._id=e,this._clearFn=t}var i=r(2).nextTick,s=Function.prototype.apply,a=Array.prototype.slice,u={},c=0;t.setTimeout=function(){return new o(s.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new o(s.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var r=c++,n=!(arguments.length<2)&&a.call(arguments,1);return u[r]=!0,i(function(){u[r]&&(n?e.apply(null,n):e.call(null),t.clearImmediate(r))}),r},t.clearImmediate="function"==typeof n?n:function(e){delete u[e]}}).call(t,r(3).setImmediate,r(3).clearImmediate)},function(e,t,r){"use strict";function n(e){return 403!==e.statusCode&&401!==e.statusCode||this._emit("error",new p.Unauthorized),Promise.resolve(e)}function o(e){return"number"==typeof e&&e>1e3&&e<36e5}var i,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(5),u=r(9),c=r(24),l=r(25),h=r(11),f=r(8),p=r(10),d=r(22),m=r(7),y=r(28),v=a.getGlobalContext(),g=r(6),_=function(e){if("object"===("undefined"==typeof e?"undefined":s(e))&&a.extend(f,e),g(this,"ready","connected","disconnected","not-connected","conflict","error","features-loaded","connecting","authing","sync-interval-change","wire-busy","wire-done","network-offline","network-online"),this._pending=[],this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")}),this._cleanups=[],this._pathHandlers={change:{}},this.apiKeys={},i=a.localStorageAvailable()){try{this.apiKeys=JSON.parse(localStorage.getItem("remotestorage:api-keys"))||{}}catch(e){}this.setBackend(localStorage.getItem("remotestorage:backend")||"remotestorage")}var t=this.on;this.on=function(e,r){return"ready"===e&&this.remote&&this.remote.connected&&this._allLoaded?setTimeout(r,0):"features-loaded"===e&&this._allLoaded&&setTimeout(r,0),t.call(this,e,r)},this._init(),this.fireInitial=function(){this.local&&setTimeout(this.local.fireInitial.bind(this.local),0)}.bind(this),this.on("ready",this.fireInitial.bind(this))};_.Authorize=p,_.SyncError=d.SyncError,_.Unauthorized=p.Unauthorized,_.DiscoveryError=l.DiscoveryError,_.prototype={authorize:function(e,t){this.access.setStorageType(this.remote.storageType);var r=this.access.scopeParameter,n=v.cordova?t:String(p.getLocation()),o=n.match(/^(https?:\/\/[^\/]+)/)[0];p(this,e,r,n,o)},impliedauth:function(e,t){var e=this.remote.storageApi,t=String(document.location);m("ImpliedAuth proceeding due to absent authURL; storageApi = "+e+" redirectUri = "+t),this.remote.configure({token:p.IMPLIED_FAKE_TOKEN}),document.location=t},connect:function(e,t){if(this.setBackend("remotestorage"),e.indexOf("@")<0)return void this._emit("error",new _.DiscoveryError("User address doesn't contain an @."));if(v.cordova){if("string"!=typeof f.cordovaRedirectUri)return void this._emit("error",new _.DiscoveryError("Please supply a custom HTTPS redirect URI for your Cordova app"));if(!v.cordova.InAppBrowser)return void this._emit("error",new _.DiscoveryError("Please include the InAppBrowser Cordova plugin to enable OAuth"))}this.remote.configure({userAddress:e}),this._emit("connecting");var r=setTimeout(function(){this._emit("error",new _.DiscoveryError("No storage information found for this user address."))}.bind(this),f.discoveryTimeout);l(e).then(function(n){if(clearTimeout(r),this._emit("authing"),n.userAddress=e,this.remote.configure(n),!this.remote.connected)if(n.authURL)if("undefined"==typeof t)this.authorize(n.authURL,f.cordovaRedirectUri);else{if("string"!=typeof t)throw new Error("Supplied bearer token must be a string");m("Skipping authorization sequence and connecting with known token"),this.remote.configure({token:t})}else this.impliedauth()}.bind(this),function(e){clearTimeout(r),this._emit("error",new _.DiscoveryError("No storage information found for this user address."))}.bind(this))},disconnect:function(){this.remote&&this.remote.configure({userAddress:null,href:null,storageApi:null,token:null,properties:null}),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")});var e=this._cleanups.length,t=0,r=function(){t++,t>=e&&(this._init(),m("Done cleaning up, emitting disconnected and disconnect events"),this._emit("disconnected"))}.bind(this);e>0?this._cleanups.forEach(function(e){var t=e(this);"object"===("undefined"==typeof t?"undefined":s(t))&&"function"==typeof t.then?t.then(r):r()}.bind(this)):r()},setBackend:function(e){this.backend=e,i&&(e?localStorage.setItem("remotestorage:backend",e):localStorage.removeItem("remotestorage:backend"))},onChange:function(e,t){this._pathHandlers.change[e]||(this._pathHandlers.change[e]=[]),this._pathHandlers.change[e].push(t)},enableLog:function(){f.logging=!0},disableLog:function(){f.logging=!1},log:function(){m.apply(_,arguments)},setApiKeys:function(e,t){t?(this.apiKeys[e]=t,"dropbox"!==e||"undefined"!=typeof this.dropbox&&this.dropbox.clientId===t.appKey?"googledrive"!==e||"undefined"!=typeof this.googledrive&&this.googledrive.clientId===t.clientId||c._rs_init(this):u._rs_init(this)):delete this.apiKeys[e],i&&localStorage.setItem("remotestorage:api-keys",JSON.stringify(this.apiKeys))},setCordovaRedirectUri:function(e){if("string"!=typeof e||!e.match(/http(s)?\:\/\//))throw new Error("Cordova redirect URI must be a URI string");f.cordovaRedirectUri=e},_init:y.loadFeatures,features:y.features,loadFeature:y.loadFeature,featureSupported:y.featureSupported,featureDone:y.featureDone,featuresDone:y.featuresDone,featuresLoaded:y.featuresLoaded,featureInitialized:y.featureInitialized,featureFailed:y.featureFailed,hasFeature:y.hasFeature,_setCachingModule:y._setCachingModule,_collectCleanupFunctions:y._collectCleanupFunctions,_fireReady:y._fireReady,initFeature:y.initFeature,_setGPD:function(e,t){function r(e){return function(){return e.apply(t,arguments).then(n.bind(this))}}this.get=r(e.get),this.put=r(e.put),this.delete=r(e.delete)},_pendingGPD:function(e){return function(){var t=Promise.defer();return this._pending.push({method:e,args:Array.prototype.slice.call(arguments),promise:t}),t.promise}.bind(this)},_processPending:function(){this._pending.forEach(function(e){try{this[e.method].apply(this,e.args).then(e.promise.resolve,e.promise.reject)}catch(t){e.promise.reject(t)}}.bind(this)),this._pending=[]},_bindChange:function(e){e.on("change",this._dispatchEvent.bind(this,"change"))},_dispatchEvent:function(e,t){var r=this;Object.keys(this._pathHandlers[e]).forEach(function(n){var o=n.length;t.path.substr(0,o)===n&&r._pathHandlers[e][n].forEach(function(e){var o={};for(var i in t)o[i]=t[i];o.relativePath=t.path.replace(new RegExp("^"+n),"");try{e(o)}catch(e){console.error("'change' handler failed: ",e,e.stack),r._emit("error",e)}})})},scope:function(e){if("string"!=typeof e)throw"Argument 'path' of baseClient.scope must be a string";if(!this.access.checkPathPermission(e,"r")){var t=e.replace(/(['\\])/g,"\\$1");console.warn("WARNING: please call remoteStorage.access.claim('"+t+"', 'r') (read only) or remoteStorage.access.claim('"+t+"', 'rw') (read/write) first")}return new h(this,e)},getSyncInterval:function(){return f.syncInterval},setSyncInterval:function(e){if(!o(e))throw e+" is not a valid sync interval";var t=f.syncInterval;f.syncInterval=parseInt(e,10),this._emit("sync-interval-change",{oldValue:t,newValue:e})},getBackgroundSyncInterval:function(){return f.backgroundSyncInterval},setBackgroundSyncInterval:function(e){if(!o(e))throw e+" is not a valid sync interval";var t=f.backgroundSyncInterval;f.backgroundSyncInterval=parseInt(e,10),this._emit("sync-interval-change",{oldValue:t,newValue:e})},getCurrentSyncInterval:function(){return f.isBackground?f.backgroundSyncInterval:f.syncInterval},syncCycle:function(){this.sync.stopped||(this.sync.on("done",function(){m("[Sync] Sync done. Setting timer to",this.getCurrentSyncInterval()),this.sync.stopped||(this._syncTimer&&clearTimeout(this._syncTimer),this._syncTimer=setTimeout(this.sync.sync.bind(this.sync),this.getCurrentSyncInterval()))}.bind(this)),this.sync.sync())},stopSync:function(){this.sync?(m("[Sync] Stopping sync"),this.sync.stopped=!0):(m("[Sync] Will instantiate sync stopped"),this.syncStopped=!0)},startSync:function(){f.cache&&(this.sync.stopped=!1,this.syncStopped=!1,this.sync.sync())}},_.util=a,Object.defineProperty(_.prototype,"connected",{get:function(){return this.remote.connected}});var b=r(30);Object.defineProperty(_.prototype,"access",{get:function(){var e=new b;return Object.defineProperty(this,"access",{value:e}),e},configurable:!0});var w=r(31);Object.defineProperty(_.prototype,"caching",{configurable:!0,get:function(){var e=new w;return Object.defineProperty(this,"caching",{value:e}),e}}),e.exports=_,r(36)},function(e,t,r){(function(t){"use strict";function n(e,t){var r,i,s;if("object"===("undefined"==typeof e?"undefined":o(e))&&!Array.isArray(e)&&null!==e)for(r in e)"object"===o(e[r])&&null!==e[r]&&("[object ArrayBuffer]"===e[r].toString()?(t[r]=new ArrayBuffer(e[r].byteLength),i=new Int8Array(e[r]),s=new Int8Array(t[r]),s.set(i)):n(e[r],t[r]))}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r(6);Promise.defer=function(){var e,t,r=new Promise(function(){e=arguments[0],t=arguments[1]});return{resolve:e,reject:t,promise:r}};var i={logError:function(e){"string"==typeof e?console.error(e):console.error(e.message,e.stack)},globalContext:"undefined"!=typeof window?window:t,getGlobalContext:function(){return"undefined"!=typeof window?window:t},extend:function(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){for(var r in t)e[r]=t[r]}),e},asyncEach:function(e,t){return this.asyncMap(e,t).then(function(){return e})},asyncMap:function(e,t){function r(){s++,s===i&&n.resolve(a,u)}var n=Promise.defer(),i=e.length,s=0,a=[],u=[];return e.forEach(function(e,n){var i;try{i=t(e)}catch(e){r(),u[n]=e}"object"===("undefined"==typeof i?"undefined":o(i))&&"function"==typeof i.then?i.then(function(e){a[n]=e,r()},function(e){u[n]=e,r()}):(r(),a[n]=i)}),n.promise},containingFolder:function(e){if(""===e)return"/";if(!e)throw"Path not given!";return e.replace(/\/+/g,"/").replace(/[^\/]+\/?$/,"")},isFolder:function(e){return"/"===e.substr(-1)},isDocument:function(e){return!i.isFolder(e)},baseName:function(e){var t=e.split("/");return i.isFolder(e)?t[t.length-2]+"/":t[t.length-1]},cleanPath:function(e){return e.replace(/\/+/g,"/").split("/").map(encodeURIComponent).join("/").replace(/'/g,"%27")},bindAll:function(e){for(var t in this)"function"==typeof e[t]&&(e[t]=e[t].bind(e))},equal:function(e,t,r){var n;if(r=r||[],("undefined"==typeof e?"undefined":o(e))!==("undefined"==typeof t?"undefined":o(t)))return!1;if("number"==typeof e||"boolean"==typeof e||"string"==typeof e)return e===t;if("function"==typeof e)return e.toString()===t.toString();if(e instanceof ArrayBuffer&&t instanceof ArrayBuffer&&(e=new Uint8Array(e),t=new Uint8Array(t)),e instanceof Array){if(e.length!==t.length)return!1;for(var s=0,a=e.length;s<a;s++)if(!i.equal(e[s],t[s],r))return!1}else{for(n in e)if(e.hasOwnProperty(n)&&!(n in t))return!1;for(n in t)if(t.hasOwnProperty(n)){if(!(n in e))return!1;var u;if("object"===o(t[n])){if(r.indexOf(t[n])>=0)continue;u=r.slice(),u.push(t[n])}if(!i.equal(e[n],t[n],u))return!1}}return!0},equalObj:function(e,t){return console.warn("DEPRECATION WARNING: util.equalObj has been replaced by util.equal."),i.equal(e,t)},deepClone:function(e){var t;return void 0===e?void 0:(t=JSON.parse(JSON.stringify(e)),n(e,t),t)},pathsFromRoot:function(e){for(var t=[e],r=e.replace(/\/$/,"").split("/");r.length>1;)r.pop(),t.push(r.join("/")+"/");return t},md5sum:function(e){function t(e,t){var r=e[0],a=e[1],u=e[2],c=e[3];r=n(r,a,u,c,t[0],7,-680876936),c=n(c,r,a,u,t[1],12,-389564586),u=n(u,c,r,a,t[2],17,606105819),a=n(a,u,c,r,t[3],22,-1044525330),r=n(r,a,u,c,t[4],7,-176418897),c=n(c,r,a,u,t[5],12,1200080426),u=n(u,c,r,a,t[6],17,-1473231341),a=n(a,u,c,r,t[7],22,-45705983),r=n(r,a,u,c,t[8],7,1770035416),c=n(c,r,a,u,t[9],12,-1958414417),u=n(u,c,r,a,t[10],17,-42063),a=n(a,u,c,r,t[11],22,-1990404162),r=n(r,a,u,c,t[12],7,1804603682),c=n(c,r,a,u,t[13],12,-40341101),u=n(u,c,r,a,t[14],17,-1502002290),a=n(a,u,c,r,t[15],22,1236535329),r=o(r,a,u,c,t[1],5,-165796510),c=o(c,r,a,u,t[6],9,-1069501632),u=o(u,c,r,a,t[11],14,643717713),a=o(a,u,c,r,t[0],20,-373897302),r=o(r,a,u,c,t[5],5,-701558691),c=o(c,r,a,u,t[10],9,38016083),u=o(u,c,r,a,t[15],14,-660478335),a=o(a,u,c,r,t[4],20,-405537848),r=o(r,a,u,c,t[9],5,568446438),c=o(c,r,a,u,t[14],9,-1019803690),u=o(u,c,r,a,t[3],14,-187363961),a=o(a,u,c,r,t[8],20,1163531501),r=o(r,a,u,c,t[13],5,-1444681467),c=o(c,r,a,u,t[2],9,-51403784),u=o(u,c,r,a,t[7],14,1735328473),a=o(a,u,c,r,t[12],20,-1926607734),r=i(r,a,u,c,t[5],4,-378558),c=i(c,r,a,u,t[8],11,-2022574463),u=i(u,c,r,a,t[11],16,1839030562),a=i(a,u,c,r,t[14],23,-35309556),r=i(r,a,u,c,t[1],4,-1530992060),c=i(c,r,a,u,t[4],11,1272893353),u=i(u,c,r,a,t[7],16,-155497632),a=i(a,u,c,r,t[10],23,-1094730640),r=i(r,a,u,c,t[13],4,681279174),c=i(c,r,a,u,t[0],11,-358537222),u=i(u,c,r,a,t[3],16,-722521979),a=i(a,u,c,r,t[6],23,76029189),r=i(r,a,u,c,t[9],4,-640364487),c=i(c,r,a,u,t[12],11,-421815835),u=i(u,c,r,a,t[15],16,530742520),a=i(a,u,c,r,t[2],23,-995338651),r=s(r,a,u,c,t[0],6,-198630844),c=s(c,r,a,u,t[7],10,1126891415),u=s(u,c,r,a,t[14],15,-1416354905),a=s(a,u,c,r,t[5],21,-57434055),r=s(r,a,u,c,t[12],6,1700485571),c=s(c,r,a,u,t[3],10,-1894986606),u=s(u,c,r,a,t[10],15,-1051523),a=s(a,u,c,r,t[1],21,-2054922799),r=s(r,a,u,c,t[8],6,1873313359),c=s(c,r,a,u,t[15],10,-30611744),u=s(u,c,r,a,t[6],15,-1560198380),a=s(a,u,c,r,t[13],21,1309151649),r=s(r,a,u,c,t[4],6,-145523070),c=s(c,r,a,u,t[11],10,-1120210379),u=s(u,c,r,a,t[2],15,718787259),a=s(a,u,c,r,t[9],21,-343485551),e[0]=p(r,e[0]),e[1]=p(a,e[1]),e[2]=p(u,e[2]),e[3]=p(c,e[3])}function r(e,t,r,n,o,i){return t=p(p(t,e),p(n,i)),p(t<<o|t>>>32-o,r)}function n(e,t,n,o,i,s,a){return r(t&n|~t&o,e,t,i,s,a)}function o(e,t,n,o,i,s,a){return r(t&o|n&~o,e,t,i,s,a)}function i(e,t,n,o,i,s,a){return r(t^n^o,e,t,i,s,a)}function s(e,t,n,o,i,s,a){return r(n^(t|~o),e,t,i,s,a)}function a(e){txt="";var r,n=e.length,o=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=e.length;r+=64)t(o,u(e.substring(r-64,r)));e=e.substring(r-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<e.length;r++)i[r>>2]|=e.charCodeAt(r)<<(r%4<<3);if(i[r>>2]|=128<<(r%4<<3),r>55)for(t(o,i),r=0;r<16;r++)i[r]=0;return i[14]=8*n,t(o,i),o}function u(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function c(e){for(var t="",r=0;r<4;r++)t+=f[e>>8*r+4&15]+f[e>>8*r&15];return t}function l(e){for(var t=0;t<e.length;t++)e[t]=c(e[t]);return e.join("")}function h(e){return l(a(e))}var f="0123456789abcdef".split(""),p=function(e,t){return e+t&4294967295};return"5d41402abc4b2a76b9719d911017c592"!==h("hello")&&(p=function(e,t){var r=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(r>>16);return n<<16|65535&r}),h(e)},localStorageAvailable:function(){var e=i.getGlobalContext();if(!("localStorage"in e))return!1;try{return e.localStorage.setItem("rs-check",1),e.localStorage.removeItem("rs-check"),!0}catch(e){return!1}}};e.exports=i}).call(t,function(){return this}())},function(e,t,r){"use strict";var n=r(7),o={addEventListener:function(e,t){if("string"!=typeof e)throw new Error("Argument eventName should be a string");if("function"!=typeof t)throw new Error("Argument handler should be a function");n("[Eventhandling] Adding event listener",e),this._validateEvent(e),this._handlers[e].push(t)},removeEventListener:function(e,t){this._validateEvent(e);for(var r=this._handlers[e].length,n=0;n<r;n++)if(this._handlers[e][n]===t)return void this._handlers[e].splice(n,1)},_emit:function(e){this._validateEvent(e);var t=Array.prototype.slice.call(arguments,1);this._handlers[e].slice().forEach(function(e){e.apply(this,t)})},_validateEvent:function(e){if(!(e in this._handlers))throw new Error("Unknown event: "+e)},_delegateEvent:function(e,t){t.on(e,function(t){this._emit(e,t)}.bind(this))},_addEvent:function(e){this._handlers[e]=[]}};o.on=o.addEventListener,e.exports=function(e){var t=Array.prototype.slice.call(arguments,1);for(var r in o)e[r]=o[r];
e._handlers={},t.forEach(function(t){e._addEvent(t)})}},function(e,t,r){"use strict";function n(){o.logging&&console.log.apply(console,arguments)}var o=r(8);e.exports=n},function(e,t){"use strict";var r={logging:!1,changeEvents:{local:!0,window:!1,remote:!0,conflict:!0},cache:!0,disableFeatures:[],discoveryTimeout:1e4,syncInterval:1e4,backgroundSyncInterval:6e4,isBackground:!1,cordovaRedirectUri:void 0};e.exports=r},function(e,t,r){"use strict";function n(e){this.defaultValue=e,this._storage={},this.set=this.justSet,this.delete=this.justDelete}function o(e){e._dropboxOrigSync||(e._dropboxOrigSync=e.sync.sync.bind(e.sync),e.sync.sync=function(){return this.dropbox.fetchDelta.apply(this.dropbox,arguments).then(e._dropboxOrigSync,function(t){return e._emit("error",new g.SyncError(t)),Promise.reject(t)})}.bind(e))}function i(e){e._dropboxOrigSync&&(e.sync.sync=e._dropboxOrigSync,delete e._dropboxOrigSync)}function s(e){e._origBaseClientGetItemURL||(e._origBaseClientGetItemURL=d.prototype.getItemURL,d.prototype.getItemURL=function(t){var r=e.dropbox._itemRefs[t];return r?r:""})}function a(e){e._origBaseClientGetItemURL&&(d.prototype.getItemURL=e._origBaseClientGetItemURL,delete e._origBaseClientGetItemURL)}function u(e){e._origRemote||(e._origRemote=e.remote,e.remote=e.dropbox)}function c(e){e._origRemote&&(e.remote=e._origRemote,delete e._origRemote)}function l(e){u(e),e.sync?o(e):e.on("connected",function(){e.sync&&o(e)}),s(e)}function h(e){c(e),i(e),a(e)}var f,p=r(10),d=r(11),m=r(17),y=r(5),v=r(6),g=r(22),_="https://www.dropbox.com/1/oauth2/authorize",b="remotestorage:dropbox",w="/remotestorage",E=y.isFolder,P=function(e){return m.cleanPath(w+"/"+e)},T=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")};n.prototype={get:function(e){e=e.toLowerCase();var t=this._storage[e];return"undefined"==typeof t&&(t=this.defaultValue,this._storage[e]=t),t},propagateSet:function(e,t){return e=e.toLowerCase(),this._storage[e]===t?t:(this._propagate(e,t),this._storage[e]=t,t)},propagateDelete:function(e){return e=e.toLowerCase(),this._propagate(e,this._storage[e]),delete this._storage[e]},_activatePropagation:function(){return this.set=this.propagateSet,this.delete=this.propagateDelete,!0},justSet:function(e,t){return e=e.toLowerCase(),this._storage[e]=t,t},justDelete:function(e,t){return e=e.toLowerCase(),delete this._storage[e]},_propagate:function(e,t){for(var r=e.split("/").slice(0,-1),n="",o=0,i=r.length;o<i;o++)n+=r[o]+"/",t||(t=this._storage[n]+1),this._storage[n]=t}};var C,S=function(e){this.rs=e,this.connected=!1,this.rs=e;var t=this;if(C=function(e){e instanceof p.Unauthorized&&t.configure({userAddress:null,href:null,storageApi:null,token:null,options:null})},v(this,"change","connected","wire-busy","wire-done","not-connected"),e.on("error",C),this.clientId=e.apiKeys.dropbox.appKey,this._revCache=new n("rev"),this._itemRefs={},this._metadataCache={},f){var r;try{r=JSON.parse(localStorage[b])}catch(e){}r&&this.configure(r);try{this._itemRefs=JSON.parse(localStorage[b+":shares"])}catch(e){}}this.connected&&setTimeout(this._emit.bind(this),0,"connected")};S.prototype={online:!0,connect:function(){this.rs.setBackend("dropbox"),this.token?l(this.rs):p(this.rs,_,"",String(p.getLocation()),this.clientId)},configure:function(e){"undefined"!=typeof e.userAddress&&(this.userAddress=e.userAddress),"undefined"!=typeof e.token&&(this.token=e.token),this.token?(this.connected=!0,this.userAddress||this.info().then(function(e){this.userAddress=e.display_name,this._emit("connected")}.bind(this))):this.connected=!1,f&&(localStorage[b]=JSON.stringify({userAddress:this.userAddress,token:this.token}))},stopWaitingForToken:function(){this.connected||this._emit("not-connected")},_getFolder:function(e,t){var r="https://api.dropbox.com/1/metadata/auto"+P(e),n=this._revCache,o=this;return this._request("GET",r,{}).then(function(t){var r=t.status;if(304===r)return Promise.resolve({statusCode:r});var i,s,a,u;try{s=JSON.parse(t.responseText)}catch(e){return Promise.reject(e)}return u=o._revCache.get(e),a="application/json; charset=UTF-8",s.contents&&(i=s.contents.reduce(function(t,r){var o=r.path.split("/").slice(-1)[0]+(r.is_dir?"/":"");return r.is_dir?t[o]={ETag:n.get(e+o)}:t[o]={ETag:r.rev},t},{})),Promise.resolve({statusCode:r,body:i,contentType:a,revision:u})})},get:function(e,t){if(!this.connected)return Promise.reject("not connected (path: "+e+")");var r="https://api-content.dropbox.com/1/files/auto"+P(e),n=this,o=this._revCache.get(e);return null===o?Promise.resolve({statusCode:404}):t&&t.ifNoneMatch&&o&&o===t.ifNoneMatch?Promise.resolve({statusCode:304}):"/"===e.substr(-1)?this._getFolder(e,t):this._request("GET",r,{}).then(function(t){var r,o,i,s,a=t.status;if(200!==a)return Promise.resolve({statusCode:a});o=t.responseText;try{r=JSON.parse(t.getResponseHeader("x-dropbox-metadata"))}catch(e){return Promise.reject(e)}if(i=r.mime_type,s=r.rev,n._revCache.set(e,s),n._shareIfNeeded(e),!t.getResponseHeader("Content-Type")||t.getResponseHeader("Content-Type").match(/charset=binary/)){var u=Promise.defer();return m.readBinaryData(t.response,i,function(e){u.resolve({statusCode:a,body:e,contentType:i,revision:s})}),u.promise}if(i&&i.search("application/json")>=0,!0)try{o=JSON.parse(o),i="application/json; charset=UTF-8"}catch(e){}return Promise.resolve({statusCode:a,body:o,contentType:i,revision:s})})},put:function(e,t,r,n){var o=this;if(!this.connected)throw new Error("not connected (path: "+e+")");var i=this._revCache.get(e);if(n&&n.ifMatch&&i&&i!==n.ifMatch)return Promise.resolve({statusCode:412,revision:i});if(n&&"*"===n.ifNoneMatch&&i&&"rev"!==i)return Promise.resolve({statusCode:412,revision:i});if(!r.match(/charset=/)&&(t instanceof ArrayBuffer||m.isArrayBufferView(t))&&(r+="; charset=binary"),t.length>157286400)return Promise.reject(new Error("Cannot upload file larger than 150MB"));var s,a=n&&(n.ifMatch||"*"===n.ifNoneMatch),u={body:t,contentType:r,path:e};return s=a?this._getMetadata(e).then(function(e){return n&&"*"===n.ifNoneMatch&&e?Promise.resolve({statusCode:412,revision:e.rev}):n&&n.ifMatch&&e&&e.rev!==n.ifMatch?Promise.resolve({statusCode:412,revision:e.rev}):o._uploadSimple(u)}):o._uploadSimple(u),s.then(function(t){return o._shareIfNeeded(e),t})},delete:function(e,t){var r=this;if(!this.connected)throw new Error("not connected (path: "+e+")");var n=this._revCache.get(e);return t&&t.ifMatch&&n&&t.ifMatch!==n?Promise.resolve({statusCode:412,revision:n}):t&&t.ifMatch?this._getMetadata(e).then(function(n){return t&&t.ifMatch&&n&&n.rev!==t.ifMatch?Promise.resolve({statusCode:412,revision:n.rev}):r._deleteSimple(e)}):r._deleteSimple(e)},_shareIfNeeded:function(e){e.match(/^\/public\/.*[^\/]$/)&&void 0===this._itemRefs[e]&&this.share(e)},share:function(e){var t=this,r="https://api.dropbox.com/1/media/auto"+P(e);return this._request("POST",r,{}).then(function(n){if(200!==n.status)return Promise.reject(new Error('Invalid Dropbox API response status when sharing "'+e+'":'+n.status));try{n=JSON.parse(n.responseText)}catch(t){return Promise.reject(new Error('Invalid Dropbox API response when sharing "'+e+'": '+n.responseText))}return t._itemRefs[e]=n.url,f&&(localStorage[b+":shares"]=JSON.stringify(t._itemRefs)),Promise.resolve(r)},function(t){return err.message='Sharing dropbox file or folder ("'+e+'") failed.'+err.message,Promise.reject(t)})},info:function(){var e="https://api.dropbox.com/1/account/info";return this._request("GET",e,{}).then(function(e){try{var t=JSON.parse(e.responseText);return Promise.resolve(t)}catch(e){return Promise.reject(e)}})},_request:function(e,t,r){var n=this;return r.headers||(r.headers={}),r.headers.Authorization="Bearer "+this.token,this._emit("wire-busy",{method:e,isFolder:E(t)}),m.request.call(this,e,t,r).then(function(o){return o&&503===o.status?(n.online&&(n.online=!1,n.rs._emit("network-offline")),setTimeout(n._request(e,t,r),3210)):(n.online||(n.online=!0,n.rs._emit("network-online")),n._emit("wire-done",{method:e,isFolder:E(t),success:!0}),Promise.resolve(o))},function(r){return n.online&&(n.online=!1,n.rs._emit("network-offline")),n._emit("wire-done",{method:e,isFolder:E(t),success:!1}),Promise.reject(r)})},fetchDelta:function(){var e=Array.prototype.slice.call(arguments),t=this,r={path_prefix:w};return t._deltaCursor&&(r.cursor=t._deltaCursor),t._request("POST","https://api.dropbox.com/1/delta",{body:T(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(r){if(200!==r.status)return 400===r.status?(t.rs._emit("error",new p.Unauthorized),Promise.resolve(e)):Promise.reject("dropbox.fetchDelta returned "+r.status+r.responseText);var o;try{o=JSON.parse(r.responseText)}catch(e){return log("fetchDeltas can not parse response",e),Promise.reject("can not parse response of fetchDelta : "+e.message)}return o.entries?(o.reset&&(t._revCache=new n("rev")),o.cursor&&(t._deltaCursor=o.cursor),o.entries.forEach(function(e){var r,n=e[0].substr(w.length);if(e[1]){if(e[1].is_dir)return;r=e[1].rev}else r=null;t._revCache.set(n,r)}),Promise.resolve(e)):Promise.reject("dropbox.fetchDeltas failed, no entries found")},function(t){return this.rs.log("fetchDeltas",t),this.rs._emit("error",new g.SyncError("fetchDeltas failed."+t)),Promise.resolve(e)}.bind(this)).then(function(){if(t._revCache){var e=Array.prototype.slice.call(arguments);return t._revCache._activatePropagation(),Promise.resolve(e)}})},_getMetadata:function(e,t){var r=this,n=this._metadataCache[e],o="https://api.dropbox.com/1/metadata/auto"+P(e);return o+="?list="+(t&&t.list?"true":"false"),n&&n.hash&&(o+="&hash="+encodeURIComponent(n.hash)),this._request("GET",o,{}).then(function(t){if(304===t.status)return Promise.resolve(n);if(200===t.status){var o=JSON.parse(t.responseText);return r._metadataCache[e]=o,Promise.resolve(o)}return Promise.resolve()})},_uploadSimple:function(e){var t=this,r="https://api-content.dropbox.com/1/files_put/auto"+P(e.path)+"?";return e&&e.ifMatch&&(r+="parent_rev="+encodeURIComponent(e.ifMatch)),t._request("PUT",r,{body:e.body,headers:{"Content-Type":e.contentType}}).then(function(r){if(200!==r.status)return Promise.resolve({statusCode:r.status});var n;try{n=JSON.parse(r.responseText)}catch(e){return Promise.reject(e)}if(n.path!==P(e.path)){var o="https://api.dropbox.com/1/fileops/delete?root=auto&path="+encodeURIComponent(n.path);return t._request("POST",o,{}),t._getMetadata(e.path).then(function(e){return Promise.resolve({statusCode:412,revision:e.rev})})}return t._revCache.propagateSet(e.path,n.rev),Promise.resolve({statusCode:r.status})})},_deleteSimple:function(e){var t=this,r="https://api.dropbox.com/1/fileops/delete?root=auto&path="+encodeURIComponent(P(e));return t._request("POST",r,{}).then(function(r){return 406===r.status?Promise.reject(new Error("Cannot delete '"+e+"': too many files involved")):(200!==r.status&&404!==r.status||(t._revCache.delete(e),delete t._itemRefs[e]),Promise.resolve({statusCode:r.status}))})}},S._rs_init=function(e){f=y.localStorageAvailable(),e.apiKeys.dropbox&&(e.dropbox=new S(e)),"dropbox"===e.backend&&l(e)},S._rs_supported=function(){return!0},S._rs_cleanup=function(e){h(e),f&&delete localStorage[b],e.removeEventListener("error",C),e.setBackend(void 0)},e.exports=S},function(e,t,r){"use strict";function n(e){var t,r=e||a.getLocation().href,n=r.indexOf("#");if(n!==-1&&(t=r.substring(n+1),t.indexOf("=")!==-1))return t.split("&").reduce(function(e,t){var r=t.split("=");if("state"===r[0]&&r[1].match(/rsDiscovery/)){var n=decodeURIComponent(r[1]),o=n.substr(n.indexOf("rsDiscovery=")).split("&")[0].split("=")[1];e.rsDiscovery=JSON.parse(atob(o)),n=n.replace(new RegExp("&?rsDiscovery="+o),""),n.length>0&&(e.state=n)}else e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]);return e},{})}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(7),s=r(5),a=function e(t,r,n,o,a){if(i("[Authorize] authURL = ",r,"scope = ",n,"redirectUri = ",o,"clientId = ",a),!s.localStorageAvailable()&&"remotestorage"===t.backend){o+=o.indexOf("#")>0?"&":"#";var u={userAddress:t.remote.userAddress,href:t.remote.href,storageApi:t.remote.storageApi,properties:t.remote.properties};o+="rsDiscovery="+btoa(JSON.stringify(u))}var c=r,l=o.indexOf("#");return c+=r.indexOf("?")>0?"&":"?",c+="redirect_uri="+encodeURIComponent(o.replace(/#.*$/,"")),c+="&scope="+encodeURIComponent(n),c+="&client_id="+encodeURIComponent(a),l!==-1&&l+1!==o.length&&(c+="&state="+encodeURIComponent(o.substring(l+1))),c+="&response_type=token",s.globalContext.cordova?e.openWindow(c,o,"location=yes,clearsessioncache=yes,clearcache=yes").then(function(e){t.remote.configure({token:e.access_token})}):void e.setLocation(c)};a.IMPLIED_FAKE_TOKEN=!1,a.Unauthorized=function(){Error.apply(this,arguments)},a.Unauthorized.prototype=Object.create(Error.prototype),a.getLocation=function(){return document.location},a.setLocation=function(e){if("string"==typeof e)document.location.href=e;else{if("object"!==("undefined"==typeof e?"undefined":o(e)))throw"Invalid location "+e;document.location=e}},a.openWindow=function(e,t,r){var o=Promise.defer(),i=open(e,"_blank",r);if(!i||i.closed)return o.reject("Authorization popup was blocked"),o.promise;var s=function(){o.reject("Authorization was canceled")},a=function(e){if(0===e.url.indexOf(t)){i.removeEventListener("exit",s),i.close();var r=n(e.url);return r?o.resolve(r):o.reject("Authorization error")}};return i.addEventListener("loadstart",a),i.addEventListener("exit",s),o.promise},a._rs_supported=function(){return"undefined"!=typeof document};var u;a._rs_init=function(e){u=function(){var n=!1;if(r){if(r.error)throw"Authorization server errored: "+r.error;r.rsDiscovery&&e.remote.configure(r.rsDiscovery),r.access_token&&(e.remote.configure({token:r.access_token}),n=!0),r.remotestorage&&(e.connect(r.remotestorage),n=!0),r.state&&(t=a.getLocation(),a.setLocation(t.href.split("#")[0]+"#"+r.state))}n||e.remote.stopWaitingForToken()};var t,r=n();r&&(t=a.getLocation(),t.hash=""),e.on("features-loaded",u)},a._rs_cleanup=function(e){e.removeEventListener("features-loaded",u)},e.exports=a},function(e,t,r){"use strict";function n(e,t){console.log("WARNING: "+e+" is deprecated. Use "+t+" instead.")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(6),s=r(5),a=r(8),u=r(12),c=function(e,t){if("/"!==t[t.length-1])throw"Not a folder: "+t;"/"===t&&(this.makePath=function(e){return("/"===e[0]?"":"/")+e}),this.storage=e,this.base=t;var r=this.base.split("/");r.length>2?this.moduleName=r[1]:this.moduleName="root",i(this,"change"),this.on=this.on.bind(this),e.onChange(this.base,this._fireChange.bind(this))};c.prototype={extend:function(e){for(var t in e)this[t]=e[t];return this},scope:function(e){return new c(this.storage,this.makePath(e))},getListing:function(e,t){if("string"!=typeof e)e="";else if(e.length>0&&"/"!==e[e.length-1])return Promise.reject("Not a folder: "+e);return this.storage.get(this.makePath(e),t).then(function(e){return 404===e.statusCode?{}:e.body})},getAll:function(e,t){if("string"!=typeof e)e="";else if(e.length>0&&"/"!==e[e.length-1])return Promise.reject("Not a folder: "+e);return this.storage.get(this.makePath(e),t).then(function(r){if(404===r.statusCode)return{};if("object"===o(r.body)){var n=Object.keys(r.body);if(0===n.length)return{};var i=n.map(function(n){return this.storage.get(this.makePath(e+n),t).then(function(e){if("string"==typeof e.body)try{e.body=JSON.parse(e.body)}catch(e){}"object"===o(e.body)&&(r.body[n]=e.body)})}.bind(this));return Promise.all(i).then(function(){return r.body})}}.bind(this))},getFile:function(e,t){return"string"!=typeof e?Promise.reject("Argument 'path' of baseClient.getFile must be a string"):this.storage.get(this.makePath(e),t).then(function(e){return{data:e.body,contentType:e.contentType,revision:e.revision}})},storeFile:function(e,t,r){return"string"!=typeof e?Promise.reject("Argument 'mimeType' of baseClient.storeFile must be a string"):"string"!=typeof t?Promise.reject("Argument 'path' of baseClient.storeFile must be a string"):"string"!=typeof r&&"object"!==("undefined"==typeof r?"undefined":o(r))?Promise.reject("Argument 'body' of baseClient.storeFile must be a string, ArrayBuffer, or ArrayBufferView"):(this.storage.access.checkPathPermission(this.makePath(t),"rw")||console.warn("WARNING: Editing a document to which only read access ('r') was claimed"),this.storage.put(this.makePath(t),r,e).then(function(e){return 200===e.statusCode||201===e.statusCode?e.revision:Promise.reject("Request (PUT "+this.makePath(t)+") failed with status: "+e.statusCode)}.bind(this)))},getObject:function(e,t){return"string"!=typeof e?Promise.reject("Argument 'path' of baseClient.getObject must be a string"):this.storage.get(this.makePath(e),t).then(function(t){if("object"===o(t.body))return t.body;if("string"==typeof t.body)try{return JSON.parse(t.body)}catch(t){throw"Not valid JSON: "+this.makePath(e)}else if("undefined"!=typeof t.body&&200===t.statusCode)return Promise.reject("Not an object: "+this.makePath(e))}.bind(this))},storeObject:function(e,t,r){if("string"!=typeof e)return Promise.reject("Argument 'typeAlias' of baseClient.storeObject must be a string");if("string"!=typeof t)return Promise.reject("Argument 'path' of baseClient.storeObject must be a string");if("object"!==("undefined"==typeof r?"undefined":o(r)))return Promise.reject("Argument 'object' of baseClient.storeObject must be an object");this._attachType(r,e);try{var n=this.validate(r);if(!n.valid)return Promise.reject(n)}catch(e){return Promise.reject(e)}return this.storage.put(this.makePath(t),JSON.stringify(r),"application/json; charset=UTF-8").then(function(e){return 200===e.statusCode||201===e.statusCode?e.revision:Promise.reject("Request (PUT "+this.makePath(t)+") failed with status: "+e.statusCode)}.bind(this))},remove:function(e){return"string"!=typeof e?Promise.reject("Argument 'path' of baseClient.remove must be a string"):(this.storage.access.checkPathPermission(this.makePath(e),"rw")||console.warn("WARNING: Removing a document to which only read access ('r') was claimed"),this.storage.delete(this.makePath(e)))},cache:function(e,t){if("string"!=typeof e)throw"Argument 'path' of baseClient.cache must be a string";if(t===!1?(n("caching strategy <false>",'<"FLUSH">'),t="FLUSH"):void 0===t?t="ALL":"string"!=typeof t&&(n("that caching strategy",'<"ALL">'),t="ALL"),"FLUSH"!==t&&"SEEN"!==t&&"ALL"!==t)throw'Argument \'strategy\' of baseclient.cache must be one of ["FLUSH", "SEEN", "ALL"]';return this.storage.caching.set(this.makePath(e),t),this},flush:function(e){return this.storage.local.flush(e)},makePath:function(e){return this.base+(e||"")},_fireChange:function(e){a.changeEvents[e.origin]&&(["new","old","lastCommon"].forEach(function(t){if((!e[t+"ContentType"]||/^application\/(.*)json(.*)/.exec(e[t+"ContentType"]))&&"string"==typeof e[t+"Value"])try{e[t+"Value"]=JSON.parse(e[t+"Value"])}catch(e){}}),this._emit("change",e))},_cleanPath:s.cleanPath,getItemURL:function(e){if("string"!=typeof e)throw"Argument 'path' of baseClient.getItemURL must be a string";return this.storage.connected?(e=this._cleanPath(this.makePath(e)),this.storage.remote.href+e):void 0},uuid:function(){return u()}},c._rs_init=function(){},e.exports=c,r(15)},function(e,t,r){function n(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[n+a]=s[a];return t||i(s)}var o=r(13),i=r(14);e.exports=n},function(e,t){(function(t){var r,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var o=new Uint8Array(16);r=function(){return n.getRandomValues(o),o}}if(!r){var i=new Array(16);r=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}e.exports=r}).call(t,function(){return this}())},function(e,t){function r(e,t){var r=t||0,o=n;return o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]}for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);e.exports=r},function(e,t,r){"use strict";var n=r(16),o=r(11);o.Types={uris:{},schemas:{},aliases:{},declare:function(e,t,r,n){var o=e+"/"+t;if(n.extends){var i,s=n.extends.split("/");i=1===s.length?e+"/"+s.shift():s.join("/");var a=this.uris[i];if(!a)throw"Type '"+o+"' tries to extend unknown schema '"+i+"'";n.extends=this.schemas[a]}this.uris[o]=r,this.aliases[r]=o,this.schemas[r]=n},resolveAlias:function(e){return this.uris[e]},getSchema:function(e){return this.schemas[e]},inScope:function(e){var t=e.length,r={};for(var n in this.uris)if(n.substr(0,t+1)===e+"/"){var o=this.uris[n];r[o]=this.schemas[o]}return r}};var i=function(e){var t=new Error("Schema not found: "+e);return t.name="SchemaNotFound",t};i.prototype=Error.prototype,o.Types.SchemaNotFound=i,o.prototype.extend({declareType:function(e,t,r){r||(r=t,t=this._defaultTypeURI(e)),o.Types.declare(this.moduleName,e,t,r)},validate:function(e){var t=o.Types.getSchema(e["@context"]);if(t)return n.validateResult(e,t);throw new i(e["@context"])},_defaultTypeURI:function(e){return"http://remotestorage.io/spec/modules/"+encodeURIComponent(this.moduleName)+"/"+encodeURIComponent(e)},_attachType:function(e,t){e["@context"]=o.Types.resolveAlias(this.moduleName+"/"+t)||this._defaultTypeURI(t)}}),Object.defineProperty(o.prototype,"schemas",{configurable:!0,get:function(){return o.Types.inScope(this.moduleName)}})},function(e,t,r){var n,o,i;!function(r,s){o=[],n=s,i="function"==typeof n?n.apply(t,o):n,!(void 0!==i&&(e.exports=i))}(this,function(){function e(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,function(e){return"%"+e.substring(3)})}function t(t){var r="";f[t.charAt(0)]&&(r=t.charAt(0),t=t.substring(1));var n="",o="",i=!0,s=!1,a=!1;"+"===r?i=!1:"."===r?(o=".",n="."):"/"===r?(o="/",n="/"):"#"===r?(o="#",i=!1):";"===r?(o=";",n=";",s=!0,a=!0):"?"===r?(o="?",n="&",s=!0):"&"===r&&(o="&",n="&",s=!0);for(var u=[],c=t.split(","),l=[],h={},d=0;d<c.length;d++){var m=c[d],y=null;if(m.indexOf(":")!==-1){var v=m.split(":");m=v[0],y=parseInt(v[1],10)}for(var g={};p[m.charAt(m.length-1)];)g[m.charAt(m.length-1)]=!0,m=m.substring(0,m.length-1);var _={truncate:y,name:m,suffices:g};l.push(_),h[m]=_,u.push(m)}var b=function(t){for(var r="",u=0,c=0;c<l.length;c++){var h=l[c],f=t(h.name);if(null===f||void 0===f||Array.isArray(f)&&0===f.length||"object"==typeof f&&0===Object.keys(f).length)u++;else if(r+=c===u?o:n||",",Array.isArray(f)){s&&(r+=h.name+"=");for(var p=0;p<f.length;p++)p>0&&(r+=h.suffices["*"]?n||",":",",h.suffices["*"]&&s&&(r+=h.name+"=")),r+=i?encodeURIComponent(f[p]).replace(/!/g,"%21"):e(f[p])}else if("object"==typeof f){s&&!h.suffices["*"]&&(r+=h.name+"=");var d=!0;for(var m in f)d||(r+=h.suffices["*"]?n||",":","),d=!1,r+=i?encodeURIComponent(m).replace(/!/g,"%21"):e(m),r+=h.suffices["*"]?"=":",",r+=i?encodeURIComponent(f[m]).replace(/!/g,"%21"):e(f[m])}else s&&(r+=h.name,a&&""===f||(r+="=")),null!=h.truncate&&(f=f.substring(0,h.truncate)),r+=i?encodeURIComponent(f).replace(/!/g,"%21"):e(f)}return r};return b.varNames=u,{prefix:o,substitution:b}}function r(e){if(!(this instanceof r))return new r(e);for(var n=e.split("{"),o=[n.shift()],i=[],s=[],a=[];n.length>0;){var u=n.shift(),c=u.split("}")[0],l=u.substring(c.length+1),h=t(c);s.push(h.substitution),i.push(h.prefix),o.push(l),a=a.concat(h.substitution.varNames)}this.fill=function(e){for(var t=o[0],r=0;r<s.length;r++){var n=s[r];t+=n(e),t+=o[r+1]}return t},this.varNames=a,this.template=e}function n(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1}else{var o;for(o in e)if(void 0===t[o]&&void 0!==e[o])return!1;for(o in t)if(void 0===e[o]&&void 0!==t[o])return!1;for(o in e)if(!n(e[o],t[o]))return!1}return!0}return!1}function o(e){var t=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return t?{href:t[0]||"",protocol:t[1]||"",authority:t[2]||"",host:t[3]||"",hostname:t[4]||"",port:t[5]||"",pathname:t[6]||"",search:t[7]||"",hash:t[8]||""}:null}function i(e,t){function r(e){var t=[];return e.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){"/.."===e?t.pop():t.push(e)}),t.join("").replace(/^\//,"/"===e.charAt(0)?"/":"")}return t=o(t||""),e=o(e||""),t&&e?(t.protocol||e.protocol)+(t.protocol||t.authority?t.authority:e.authority)+r(t.protocol||t.authority||"/"===t.pathname.charAt(0)?t.pathname:t.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+t.pathname:e.pathname)+(t.protocol||t.authority||t.pathname?t.search:t.search||e.search)+t.hash:null}function s(e){return e.split("#")[0]}function a(e,t){if(e&&"object"==typeof e)if(void 0===t?t=e.id:"string"==typeof e.id&&(t=i(t,e.id),e.id=t),Array.isArray(e))for(var r=0;r<e.length;r++)a(e[r],t);else{"string"==typeof e.$ref&&(e.$ref=i(t,e.$ref));for(var n in e)"enum"!==n&&a(e[n],t)}}function u(e){e=e||"en";var t=w[e];return function(e){var r=t[e.code]||b[e.code];if("string"!=typeof r)return"Unknown error code "+e.code+": "+JSON.stringify(e.messageParams);var n=e.params;return r.replace(/\{([^{}]*)\}/g,function(e,t){var r=n[t];return"string"==typeof r||"number"==typeof r?r:e})}}function c(e,t,r,n,o){if(Error.call(this),void 0===e)throw new Error("No error code supplied: "+n);this.message="",this.params=t,this.code=e,this.dataPath=r||"",this.schemaPath=n||"",this.subErrors=o||null;var i=new Error(this.message);if(this.stack=i.stack||i.stacktrace,!this.stack)try{throw i}catch(e){this.stack=e.stack||e.stacktrace}}function l(e,t){if(t.substring(0,e.length)===e){var r=t.substring(e.length);if(t.length>0&&"/"===t.charAt(e.length-1)||"#"===r.charAt(0)||"?"===r.charAt(0))return!0}return!1}function h(e){var t,r,n=new d,o={setErrorReporter:function(e){return"string"==typeof e?this.language(e):(r=e,!0)},addFormat:function(){n.addFormat.apply(n,arguments)},language:function(e){return e?(w[e]||(e=e.split("-")[0]),!!w[e]&&(t=e,e)):t},addLanguage:function(e,t){var r;for(r in v)t[r]&&!t[v[r]]&&(t[v[r]]=t[r]);var n=e.split("-")[0];if(w[n]){w[e]=Object.create(w[n]);for(r in t)"undefined"==typeof w[n][r]&&(w[n][r]=t[r]),w[e][r]=t[r]}else w[e]=t,w[n]=t;return this},freshApi:function(e){var t=h();return e&&t.language(e),t},validate:function(e,o,i,s){var a=u(t),c=r?function(e,t,n){return r(e,t,n)||a(e,t,n)}:a,l=new d(n,!1,c,i,s);"string"==typeof o&&(o={$ref:o}),l.addSchema("",o);var h=l.validateAll(e,o,null,null,"");return!h&&s&&(h=l.banUnknownProperties(e,o)),this.error=h,this.missing=l.missing,this.valid=null===h,this.valid},validateResult:function(){var e={};return this.validate.apply(e,arguments),e},validateMultiple:function(e,o,i,s){var a=u(t),c=r?function(e,t,n){return r(e,t,n)||a(e,t,n)}:a,l=new d(n,!0,c,i,s);"string"==typeof o&&(o={$ref:o}),l.addSchema("",o),l.validateAll(e,o,null,null,""),s&&l.banUnknownProperties(e,o);var h={};return h.errors=l.errors,h.missing=l.missing,h.valid=0===h.errors.length,h},addSchema:function(){return n.addSchema.apply(n,arguments)},getSchema:function(){return n.getSchema.apply(n,arguments)},getSchemaMap:function(){return n.getSchemaMap.apply(n,arguments)},getSchemaUris:function(){return n.getSchemaUris.apply(n,arguments)},getMissingUris:function(){return n.getMissingUris.apply(n,arguments)},dropSchemas:function(){n.dropSchemas.apply(n,arguments)},defineKeyword:function(){n.defineKeyword.apply(n,arguments)},defineError:function(e,t,r){if("string"!=typeof e||!/^[A-Z]+(_[A-Z]+)*$/.test(e))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof t||t%1!==0||t<1e4)throw new Error("Code number must be an integer > 10000");if("undefined"!=typeof v[e])throw new Error("Error already defined: "+e+" as "+v[e]);if("undefined"!=typeof g[t])throw new Error("Error code already used: "+g[t]+" as "+t);v[e]=t,g[t]=e,b[e]=b[t]=r;for(var n in w){var o=w[n];o[e]&&(o[t]=o[t]||o[e])}},reset:function(){n.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:a,resolveUrl:i,getDocumentUri:s,errorCodes:v};return o.language(e||"en"),o}Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(o){if("object"!=typeof o&&"function"!=typeof o||null===o)throw new TypeError("Object.keys called on non-object");var i=[];for(var s in o)e.call(o,s)&&i.push(s);if(t)for(var a=0;a<n;a++)e.call(o,r[a])&&i.push(r[a]);return i}}()),Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),r=t.length>>>0;if(0===r)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var o=n>=0?n:Math.max(r-Math.abs(n),0);o<r;o++)if(o in t&&t[o]===e)return o;return-1}),Object.isFrozen||(Object.isFrozen=function(e){for(var t="tv4_test_frozen_key";e.hasOwnProperty(t);)t+=Math.random();try{return e[t]=!0,delete e[t],!1}catch(e){return!0}});var f={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},p={"*":!0};r.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill(function(t){return e[t]})}};var d=function(e,t,r,n,o){if(this.missing=[],this.missingMap={},this.formatValidators=e?Object.create(e.formatValidators):{},this.schemas=e?Object.create(e.schemas):{},this.collectMultiple=t,this.errors=[],this.handleError=t?this.collectError:this.returnError,n&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),o&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=r||u("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},e)for(var i in e.definedKeywords)this.definedKeywords[i]=e.definedKeywords[i].slice(0)};d.prototype.defineKeyword=function(e,t){this.definedKeywords[e]=this.definedKeywords[e]||[],this.definedKeywords[e].push(t)},d.prototype.createError=function(e,t,r,n,o,i,s){var a=new c(e,t,r,n,o);return a.message=this.errorReporter(a,i,s),a},d.prototype.returnError=function(e){return e},d.prototype.collectError=function(e){return e&&this.errors.push(e),null},d.prototype.prefixErrors=function(e,t,r){for(var n=e;n<this.errors.length;n++)this.errors[n]=this.errors[n].prefixWith(t,r);return this},d.prototype.banUnknownProperties=function(e,t){for(var r in this.unknownPropertyPaths){var n=this.createError(v.UNKNOWN_PROPERTY,{path:r},r,"",null,e,t),o=this.handleError(n);if(o)return o}return null},d.prototype.addFormat=function(e,t){if("object"==typeof e){for(var r in e)this.addFormat(r,e[r]);return this}this.formatValidators[e]=t},d.prototype.resolveRefs=function(e,t){if(void 0!==e.$ref){
if(t=t||{},t[e.$ref])return this.createError(v.CIRCULAR_REFERENCE,{urls:Object.keys(t).join(", ")},"","",null,void 0,e);t[e.$ref]=!0,e=this.getSchema(e.$ref,t)}return e},d.prototype.getSchema=function(e,t){var r;if(void 0!==this.schemas[e])return r=this.schemas[e],this.resolveRefs(r,t);var n=e,o="";if(e.indexOf("#")!==-1&&(o=e.substring(e.indexOf("#")+1),n=e.substring(0,e.indexOf("#"))),"object"==typeof this.schemas[n]){r=this.schemas[n];var i=decodeURIComponent(o);if(""===i)return this.resolveRefs(r,t);if("/"!==i.charAt(0))return;for(var s=i.split("/").slice(1),a=0;a<s.length;a++){var u=s[a].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===r[u]){r=void 0;break}r=r[u]}if(void 0!==r)return this.resolveRefs(r,t)}void 0===this.missing[n]&&(this.missing.push(n),this.missing[n]=n,this.missingMap[n]=n)},d.prototype.searchSchemas=function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)this.searchSchemas(e[r],t);else if(e&&"object"==typeof e){"string"==typeof e.id&&l(t,e.id)&&void 0===this.schemas[e.id]&&(this.schemas[e.id]=e);for(var n in e)if("enum"!==n)if("object"==typeof e[n])this.searchSchemas(e[n],t);else if("$ref"===n){var o=s(e[n]);o&&void 0===this.schemas[o]&&void 0===this.missingMap[o]&&(this.missingMap[o]=o)}}},d.prototype.addSchema=function(e,t){if("string"!=typeof e||"undefined"==typeof t){if("object"!=typeof e||"string"!=typeof e.id)return;t=e,e=t.id}e===s(e)+"#"&&(e=s(e)),this.schemas[e]=t,delete this.missingMap[e],a(t,e),this.searchSchemas(t,e)},d.prototype.getSchemaMap=function(){var e={};for(var t in this.schemas)e[t]=this.schemas[t];return e},d.prototype.getSchemaUris=function(e){var t=[];for(var r in this.schemas)e&&!e.test(r)||t.push(r);return t},d.prototype.getMissingUris=function(e){var t=[];for(var r in this.missingMap)e&&!e.test(r)||t.push(r);return t},d.prototype.dropSchemas=function(){this.schemas={},this.reset()},d.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},d.prototype.validateAll=function(e,t,r,n,o){var i;if(t=this.resolveRefs(t),!t)return null;if(t instanceof c)return this.errors.push(t),t;var s,a=this.errors.length,u=null,l=null;if(this.checkRecursive&&e&&"object"==typeof e){if(i=!this.scanned.length,e[this.validatedSchemasKey]){var h=e[this.validatedSchemasKey].indexOf(t);if(h!==-1)return this.errors=this.errors.concat(e[this.validationErrorsKey][h]),null}if(Object.isFrozen(e)&&(s=this.scannedFrozen.indexOf(e),s!==-1)){var f=this.scannedFrozenSchemas[s].indexOf(t);if(f!==-1)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[s][f]),null}if(this.scanned.push(e),Object.isFrozen(e))s===-1&&(s=this.scannedFrozen.length,this.scannedFrozen.push(e),this.scannedFrozenSchemas.push([])),u=this.scannedFrozenSchemas[s].length,this.scannedFrozenSchemas[s][u]=t,this.scannedFrozenValidationErrors[s][u]=[];else{if(!e[this.validatedSchemasKey])try{Object.defineProperty(e,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(e,this.validationErrorsKey,{value:[],configurable:!0})}catch(t){e[this.validatedSchemasKey]=[],e[this.validationErrorsKey]=[]}l=e[this.validatedSchemasKey].length,e[this.validatedSchemasKey][l]=t,e[this.validationErrorsKey][l]=[]}}var p=this.errors.length,d=this.validateBasic(e,t,o)||this.validateNumeric(e,t,o)||this.validateString(e,t,o)||this.validateArray(e,t,o)||this.validateObject(e,t,o)||this.validateCombinations(e,t,o)||this.validateHypermedia(e,t,o)||this.validateFormat(e,t,o)||this.validateDefinedKeywords(e,t,o)||null;if(i){for(;this.scanned.length;){var m=this.scanned.pop();delete m[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(d||p!==this.errors.length)for(;r&&r.length||n&&n.length;){var y=r&&r.length?""+r.pop():null,v=n&&n.length?""+n.pop():null;d&&(d=d.prefixWith(y,v)),this.prefixErrors(p,y,v)}return null!==u?this.scannedFrozenValidationErrors[s][u]=this.errors.slice(a):null!==l&&(e[this.validationErrorsKey][l]=this.errors.slice(a)),this.handleError(d)},d.prototype.validateFormat=function(e,t){if("string"!=typeof t.format||!this.formatValidators[t.format])return null;var r=this.formatValidators[t.format].call(null,e,t);return"string"==typeof r||"number"==typeof r?this.createError(v.FORMAT_CUSTOM,{message:r},"","/format",null,e,t):r&&"object"==typeof r?this.createError(v.FORMAT_CUSTOM,{message:r.message||"?"},r.dataPath||"",r.schemaPath||"/format",null,e,t):null},d.prototype.validateDefinedKeywords=function(e,t,r){for(var n in this.definedKeywords)if("undefined"!=typeof t[n])for(var o=this.definedKeywords[n],i=0;i<o.length;i++){var s=o[i],a=s(e,t[n],t,r);if("string"==typeof a||"number"==typeof a)return this.createError(v.KEYWORD_CUSTOM,{key:n,message:a},"","",null,e,t).prefixWith(null,n);if(a&&"object"==typeof a){var u=a.code;if("string"==typeof u){if(!v[u])throw new Error("Undefined error code (use defineError): "+u);u=v[u]}else"number"!=typeof u&&(u=v.KEYWORD_CUSTOM);var c="object"==typeof a.message?a.message:{key:n,message:a.message||"?"},l=a.schemaPath||"/"+n.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(u,c,a.dataPath||null,l,null,e,t)}}return null},d.prototype.validateBasic=function(e,t,r){var n;return(n=this.validateType(e,t,r))?n.prefixWith(null,"type"):(n=this.validateEnum(e,t,r))?n.prefixWith(null,"type"):null},d.prototype.validateType=function(e,t){if(void 0===t.type)return null;var r=typeof e;null===e?r="null":Array.isArray(e)&&(r="array");var n=t.type;Array.isArray(n)||(n=[n]);for(var o=0;o<n.length;o++){var i=n[o];if(i===r||"integer"===i&&"number"===r&&e%1===0)return null}return this.createError(v.INVALID_TYPE,{type:r,expected:n.join("/")},"","",null,e,t)},d.prototype.validateEnum=function(e,t){if(void 0===t.enum)return null;for(var r=0;r<t.enum.length;r++){var o=t.enum[r];if(n(e,o))return null}return this.createError(v.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(e):e},"","",null,e,t)},d.prototype.validateNumeric=function(e,t,r){return this.validateMultipleOf(e,t,r)||this.validateMinMax(e,t,r)||this.validateNaN(e,t,r)||null};var m=Math.pow(2,-51),y=1-m;d.prototype.validateMultipleOf=function(e,t){var r=t.multipleOf||t.divisibleBy;if(void 0===r)return null;if("number"==typeof e){var n=e/r%1;if(n>=m&&n<y)return this.createError(v.NUMBER_MULTIPLE_OF,{value:e,multipleOf:r},"","",null,e,t)}return null},d.prototype.validateMinMax=function(e,t){if("number"!=typeof e)return null;if(void 0!==t.minimum){if(e<t.minimum)return this.createError(v.NUMBER_MINIMUM,{value:e,minimum:t.minimum},"","/minimum",null,e,t);if(t.exclusiveMinimum&&e===t.minimum)return this.createError(v.NUMBER_MINIMUM_EXCLUSIVE,{value:e,minimum:t.minimum},"","/exclusiveMinimum",null,e,t)}if(void 0!==t.maximum){if(e>t.maximum)return this.createError(v.NUMBER_MAXIMUM,{value:e,maximum:t.maximum},"","/maximum",null,e,t);if(t.exclusiveMaximum&&e===t.maximum)return this.createError(v.NUMBER_MAXIMUM_EXCLUSIVE,{value:e,maximum:t.maximum},"","/exclusiveMaximum",null,e,t)}return null},d.prototype.validateNaN=function(e,t){return"number"!=typeof e?null:isNaN(e)===!0||e===1/0||e===-(1/0)?this.createError(v.NUMBER_NOT_A_NUMBER,{value:e},"","/type",null,e,t):null},d.prototype.validateString=function(e,t,r){return this.validateStringLength(e,t,r)||this.validateStringPattern(e,t,r)||null},d.prototype.validateStringLength=function(e,t){return"string"!=typeof e?null:void 0!==t.minLength&&e.length<t.minLength?this.createError(v.STRING_LENGTH_SHORT,{length:e.length,minimum:t.minLength},"","/minLength",null,e,t):void 0!==t.maxLength&&e.length>t.maxLength?this.createError(v.STRING_LENGTH_LONG,{length:e.length,maximum:t.maxLength},"","/maxLength",null,e,t):null},d.prototype.validateStringPattern=function(e,t){if("string"!=typeof e||"string"!=typeof t.pattern&&!(t.pattern instanceof RegExp))return null;var r;if(t.pattern instanceof RegExp)r=t.pattern;else{var n,o="",i=t.pattern.match(/^\/(.+)\/([img]*)$/);i?(n=i[1],o=i[2]):n=t.pattern,r=new RegExp(n,o)}return r.test(e)?null:this.createError(v.STRING_PATTERN,{pattern:t.pattern},"","/pattern",null,e,t)},d.prototype.validateArray=function(e,t,r){return Array.isArray(e)?this.validateArrayLength(e,t,r)||this.validateArrayUniqueItems(e,t,r)||this.validateArrayItems(e,t,r)||null:null},d.prototype.validateArrayLength=function(e,t){var r;return void 0!==t.minItems&&e.length<t.minItems&&(r=this.createError(v.ARRAY_LENGTH_SHORT,{length:e.length,minimum:t.minItems},"","/minItems",null,e,t),this.handleError(r))?r:void 0!==t.maxItems&&e.length>t.maxItems&&(r=this.createError(v.ARRAY_LENGTH_LONG,{length:e.length,maximum:t.maxItems},"","/maxItems",null,e,t),this.handleError(r))?r:null},d.prototype.validateArrayUniqueItems=function(e,t){if(t.uniqueItems)for(var r=0;r<e.length;r++)for(var o=r+1;o<e.length;o++)if(n(e[r],e[o])){var i=this.createError(v.ARRAY_UNIQUE,{match1:r,match2:o},"","/uniqueItems",null,e,t);if(this.handleError(i))return i}return null},d.prototype.validateArrayItems=function(e,t,r){if(void 0===t.items)return null;var n,o;if(Array.isArray(t.items)){for(o=0;o<e.length;o++)if(o<t.items.length){if(n=this.validateAll(e[o],t.items[o],[o],["items",o],r+"/"+o))return n}else if(void 0!==t.additionalItems)if("boolean"==typeof t.additionalItems){if(!t.additionalItems&&(n=this.createError(v.ARRAY_ADDITIONAL_ITEMS,{},"/"+o,"/additionalItems",null,e,t),this.handleError(n)))return n}else if(n=this.validateAll(e[o],t.additionalItems,[o],["additionalItems"],r+"/"+o))return n}else for(o=0;o<e.length;o++)if(n=this.validateAll(e[o],t.items,[o],["items"],r+"/"+o))return n;return null},d.prototype.validateObject=function(e,t,r){return"object"!=typeof e||null===e||Array.isArray(e)?null:this.validateObjectMinMaxProperties(e,t,r)||this.validateObjectRequiredProperties(e,t,r)||this.validateObjectProperties(e,t,r)||this.validateObjectDependencies(e,t,r)||null},d.prototype.validateObjectMinMaxProperties=function(e,t){var r,n=Object.keys(e);return void 0!==t.minProperties&&n.length<t.minProperties&&(r=this.createError(v.OBJECT_PROPERTIES_MINIMUM,{propertyCount:n.length,minimum:t.minProperties},"","/minProperties",null,e,t),this.handleError(r))?r:void 0!==t.maxProperties&&n.length>t.maxProperties&&(r=this.createError(v.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:n.length,maximum:t.maxProperties},"","/maxProperties",null,e,t),this.handleError(r))?r:null},d.prototype.validateObjectRequiredProperties=function(e,t){if(void 0!==t.required)for(var r=0;r<t.required.length;r++){var n=t.required[r];if(void 0===e[n]){var o=this.createError(v.OBJECT_REQUIRED,{key:n},"","/required/"+r,null,e,t);if(this.handleError(o))return o}}return null},d.prototype.validateObjectProperties=function(e,t,r){var n;for(var o in e){var i=r+"/"+o.replace(/~/g,"~0").replace(/\//g,"~1"),s=!1;if(void 0!==t.properties&&void 0!==t.properties[o]&&(s=!0,n=this.validateAll(e[o],t.properties[o],[o],["properties",o],i)))return n;if(void 0!==t.patternProperties)for(var a in t.patternProperties){var u=new RegExp(a);if(u.test(o)&&(s=!0,n=this.validateAll(e[o],t.patternProperties[a],[o],["patternProperties",a],i)))return n}if(s)this.trackUnknownProperties&&(this.knownPropertyPaths[i]=!0,delete this.unknownPropertyPaths[i]);else if(void 0!==t.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[i]=!0,delete this.unknownPropertyPaths[i]),"boolean"==typeof t.additionalProperties){if(!t.additionalProperties&&(n=this.createError(v.OBJECT_ADDITIONAL_PROPERTIES,{key:o},"","/additionalProperties",null,e,t).prefixWith(o,null),this.handleError(n)))return n}else if(n=this.validateAll(e[o],t.additionalProperties,[o],["additionalProperties"],i))return n}else this.trackUnknownProperties&&!this.knownPropertyPaths[i]&&(this.unknownPropertyPaths[i]=!0)}return null},d.prototype.validateObjectDependencies=function(e,t,r){var n;if(void 0!==t.dependencies)for(var o in t.dependencies)if(void 0!==e[o]){var i=t.dependencies[o];if("string"==typeof i){if(void 0===e[i]&&(n=this.createError(v.OBJECT_DEPENDENCY_KEY,{key:o,missing:i},"","",null,e,t).prefixWith(null,o).prefixWith(null,"dependencies"),this.handleError(n)))return n}else if(Array.isArray(i))for(var s=0;s<i.length;s++){var a=i[s];if(void 0===e[a]&&(n=this.createError(v.OBJECT_DEPENDENCY_KEY,{key:o,missing:a},"","/"+s,null,e,t).prefixWith(null,o).prefixWith(null,"dependencies"),this.handleError(n)))return n}else if(n=this.validateAll(e,i,[],["dependencies",o],r))return n}return null},d.prototype.validateCombinations=function(e,t,r){return this.validateAllOf(e,t,r)||this.validateAnyOf(e,t,r)||this.validateOneOf(e,t,r)||this.validateNot(e,t,r)||null},d.prototype.validateAllOf=function(e,t,r){if(void 0===t.allOf)return null;for(var n,o=0;o<t.allOf.length;o++){var i=t.allOf[o];if(n=this.validateAll(e,i,[],["allOf",o],r))return n}return null},d.prototype.validateAnyOf=function(e,t,r){if(void 0===t.anyOf)return null;var n,o,i=[],s=this.errors.length;this.trackUnknownProperties&&(n=this.unknownPropertyPaths,o=this.knownPropertyPaths);for(var a=!0,u=0;u<t.anyOf.length;u++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var c=t.anyOf[u],l=this.errors.length,h=this.validateAll(e,c,[],["anyOf",u],r);if(null===h&&l===this.errors.length){if(this.errors=this.errors.slice(0,s),this.trackUnknownProperties){for(var f in this.knownPropertyPaths)o[f]=!0,delete n[f];for(var p in this.unknownPropertyPaths)o[p]||(n[p]=!0);a=!1;continue}return null}h&&i.push(h.prefixWith(null,""+u).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=n,this.knownPropertyPaths=o),a?(i=i.concat(this.errors.slice(s)),this.errors=this.errors.slice(0,s),this.createError(v.ANY_OF_MISSING,{},"","/anyOf",i,e,t)):void 0},d.prototype.validateOneOf=function(e,t,r){if(void 0===t.oneOf)return null;var n,o,i=null,s=[],a=this.errors.length;this.trackUnknownProperties&&(n=this.unknownPropertyPaths,o=this.knownPropertyPaths);for(var u=0;u<t.oneOf.length;u++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var c=t.oneOf[u],l=this.errors.length,h=this.validateAll(e,c,[],["oneOf",u],r);if(null===h&&l===this.errors.length){if(null!==i)return this.errors=this.errors.slice(0,a),this.createError(v.ONE_OF_MULTIPLE,{index1:i,index2:u},"","/oneOf",null,e,t);if(i=u,this.trackUnknownProperties){for(var f in this.knownPropertyPaths)o[f]=!0,delete n[f];for(var p in this.unknownPropertyPaths)o[p]||(n[p]=!0)}}else h&&s.push(h)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=n,this.knownPropertyPaths=o),null===i?(s=s.concat(this.errors.slice(a)),this.errors=this.errors.slice(0,a),this.createError(v.ONE_OF_MISSING,{},"","/oneOf",s,e,t)):(this.errors=this.errors.slice(0,a),null)},d.prototype.validateNot=function(e,t,r){if(void 0===t.not)return null;var n,o,i=this.errors.length;this.trackUnknownProperties&&(n=this.unknownPropertyPaths,o=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var s=this.validateAll(e,t.not,null,null,r),a=this.errors.slice(i);return this.errors=this.errors.slice(0,i),this.trackUnknownProperties&&(this.unknownPropertyPaths=n,this.knownPropertyPaths=o),null===s&&0===a.length?this.createError(v.NOT_PASSED,{},"","/not",null,e,t):null},d.prototype.validateHypermedia=function(e,t,n){if(!t.links)return null;for(var o,i=0;i<t.links.length;i++){var s=t.links[i];if("describedby"===s.rel){for(var a=new r(s.href),u=!0,c=0;c<a.varNames.length;c++)if(!(a.varNames[c]in e)){u=!1;break}if(u){var l=a.fillFromObject(e),h={$ref:l};if(o=this.validateAll(e,h,[],["links",i],n))return o}}}};var v={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},g={};for(var _ in v)g[v[_]]=_;var b={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c.prototype.name="ValidationError",c.prototype.prefixWith=function(e,t){if(null!==e&&(e=e.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+e+this.dataPath),null!==t&&(t=t.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+t+this.schemaPath),null!==this.subErrors)for(var r=0;r<this.subErrors.length;r++)this.subErrors[r].prefixWith(e,t);return this};var w={},E=h();return E.addLanguage("en-gb",b),E.tv4=E,E})},function(e,t,r){(function(t,n){"use strict";function o(e){return"string"!=typeof e?e:"*"===e?"*":'"'+e+'"'}function i(e){return"string"!=typeof e?e:e.replace(/^["']|["']$/g,"")}function s(e,r,n){var o;if(y.globalContext.BlobBuilder=y.globalContext.BlobBuilder||y.globalContext.WebKitBlobBuilder,"undefined"!=typeof y.globalContext.BlobBuilder){var i=new t.BlobBuilder;i.append(e),o=i.getBlob(r)}else o=new Blob([e],{type:r});var s=new FileReader;"function"==typeof s.addEventListener?s.addEventListener("loadend",function(){n(s.result)}):s.onloadend=function(){n(s.result)},s.readAsArrayBuffer(o)}function a(e,r){var o=Promise.defer();if("undefined"==typeof Blob){var i=new n(new Uint8Array(e));o.resolve(i.toString(r))}else{var s;if(y.globalContext.BlobBuilder=y.globalContext.BlobBuilder||y.globalContext.WebKitBlobBuilder,"undefined"!=typeof y.globalContext.BlobBuilder){var a=new t.BlobBuilder;a.append(e),s=a.getBlob()}else s=new Blob([e]);var u=new FileReader;"function"==typeof u.addEventListener?u.addEventListener("loadend",function(e){o.resolve(e.target.result)}):u.onloadend=function(e){o.resolve(e.target.result)},u.readAsText(s,r)}return o.promise}function u(e){var t,r="UTF-8";return e&&(t=e.match(/charset=(.+)$/),t&&(r=t[1])),r}function c(e){return"http://remotestorage.io/spec/folder-description"===e["@context"]&&"object"===d(e.items)}function l(e){return[201,204,304].indexOf(e)>=0}function h(e){return[401,403,404,412].indexOf(e)>=0}var f,p,d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=r(7),y=r(5),v=r(6),g=r(10),_="remotestorage:wireclient",b=1,w=2,E=3,P=4,T=5,C={"draft-dejong-remotestorage-00":w,"draft-dejong-remotestorage-01":E,"draft-dejong-remotestorage-02":P,"https://www.w3.org/community/rww/wiki/read-write-web-00#simple":b};if("function"==typeof ArrayBufferView)p=function(e){return e&&e instanceof ArrayBufferView};else{var S=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];p=function(e){for(var t=0;t<8;t++)if(e instanceof S[t])return!0;return!1}}var k,A=y.isFolder,R=y.cleanPath,j=function(e){if(this.rs=e,this.connected=!1,v(this,"change","connected","not-connected","wire-busy","wire-done"),k=function(e){e instanceof g.Unauthorized&&this.configure({token:null})}.bind(this),e.on("error",k),f){var t;try{t=JSON.parse(localStorage[_])}catch(e){}t&&setTimeout(function(){this.configure(t)}.bind(this),0)}this._revisionCache={},this.connected&&setTimeout(this._emit.bind(this),0,"connected")};j.REQUEST_TIMEOUT=3e4,j.prototype={_request:function(e,t,r,n,o,s,c){if(("PUT"===e||"DELETE"===e)&&"/"===t[t.length-1])return Promise.reject("Don't "+e+" on directories!");var f,p=this;return r!==g.IMPLIED_FAKE_TOKEN&&(n.Authorization="Bearer "+r),this._emit("wire-busy",{method:e,isFolder:A(t)}),j.request(e,t,{body:o,headers:n,responseType:"arraybuffer"}).then(function(r){if(p.online||(p.online=!0,p.rs._emit("network-online")),p._emit("wire-done",{method:e,isFolder:A(t),success:!0}),h(r.status))return m("[WireClient] Error response status",r.status),f=s?i(r.getResponseHeader("ETag")):void 0,Promise.resolve({statusCode:r.status,revision:f});if(l(r.status)||200===r.status&&"GET"!==e)return f=i(r.getResponseHeader("ETag")),m("[WireClient] Successful request",f),Promise.resolve({statusCode:r.status,revision:f});var n=r.getResponseHeader("Content-Type");f=s?i(r.getResponseHeader("ETag")):200===r.status?c:void 0;var o=u(n);return n&&"binary"!==o?a(r.response,o).then(function(e){return m("[WireClient] Successful request",f),Promise.resolve({statusCode:r.status,body:e,contentType:n,revision:f})}):(m("[WireClient] Successful request with unknown or binary mime-type",f),Promise.resolve({statusCode:r.status,body:r.response,contentType:n,revision:f}))},function(r){return p.online&&(p.online=!1,p.rs._emit("network-offline")),p._emit("wire-done",{method:e,isFolder:A(t),success:!1}),Promise.reject(r)})},configure:function(e){if("object"!==("undefined"==typeof e?"undefined":d(e)))throw new Error("WireClient configure settings parameter should be an object");"undefined"!=typeof e.userAddress&&(this.userAddress=e.userAddress),"undefined"!=typeof e.href&&(this.href=e.href),"undefined"!=typeof e.storageApi&&(this.storageApi=e.storageApi),"undefined"!=typeof e.token&&(this.token=e.token),"undefined"!=typeof e.properties&&(this.properties=e.properties),"undefined"!=typeof this.storageApi&&(this._storageApi=C[this.storageApi]||T,this.supportsRevs=this._storageApi>=w),this.href&&this.token?(this.connected=!0,this.online=!0,this._emit("connected")):this.connected=!1,f&&(localStorage[_]=JSON.stringify({userAddress:this.userAddress,href:this.href,storageApi:this.storageApi,token:this.token,properties:this.properties}))},stopWaitingForToken:function(){this.connected||this._emit("not-connected")},get:function(e,t){var r=this;if(!this.connected)return Promise.reject("not connected (path: "+e+")");t||(t={});var n={};if(this.supportsRevs)t.ifNoneMatch&&(n["If-None-Match"]=o(t.ifNoneMatch));else if(t.ifNoneMatch){this._revisionCache[e]}return this._request("GET",this.href+R(e),this.token,n,void 0,this.supportsRevs,this._revisionCache[e]).then(function(t){if(!A(e))return Promise.resolve(t);var n={};if("undefined"!=typeof t.body)try{t.body=JSON.parse(t.body)}catch(t){return Promise.reject("Folder description at "+r.href+R(e)+" is not JSON")}if(200===t.statusCode&&"object"===d(t.body)){if(0===Object.keys(t.body).length)t.statusCode=404;else if(c(t.body)){for(var o in t.body.items)r._revisionCache[e+o]=t.body.items[o].ETag;n=t.body.items}else Object.keys(t.body).forEach(function(o){r._revisionCache[e+o]=t.body[o],n[o]={ETag:t.body[o]}});return t.body=n,Promise.resolve(t)}return Promise.resolve(t)})},put:function(e,t,r,n){if(!this.connected)return Promise.reject("not connected (path: "+e+")");n||(n={}),!r.match(/charset=/)&&(t instanceof ArrayBuffer||p(t))&&(r+="; charset=binary");var i={"Content-Type":r};return this.supportsRevs&&(n.ifMatch&&(i["If-Match"]=o(n.ifMatch)),n.ifNoneMatch&&(i["If-None-Match"]=o(n.ifNoneMatch))),this._request("PUT",this.href+R(e),this.token,i,t,this.supportsRevs)},delete:function(e,t){if(!this.connected)throw new Error("not connected (path: "+e+")");t||(t={});var r={};return this.supportsRevs&&t.ifMatch&&(r["If-Match"]=o(t.ifMatch)),this._request("DELETE",this.href+R(e),this.token,r,void 0,this.supportsRevs)}},j.cleanPath=R,j.isArrayBufferView=p,j.readBinaryData=s,j.request=function(e,t,r){var n=Promise.defer();m("[WireClient]",e,t);var o=!1,i=setTimeout(function(){o=!0,n.reject("timeout")},j.REQUEST_TIMEOUT),s=new XMLHttpRequest;if(s.open(e,t,!0),r.responseType&&(s.responseType=r.responseType),r.headers)for(var a in r.headers)s.setRequestHeader(a,r.headers[a]);s.onload=function(){o||(clearTimeout(i),n.resolve(s))},s.onerror=function(e){o||(clearTimeout(i),n.reject(e))};var u=r.body;return"object"===("undefined"==typeof u?"undefined":d(u))&&!p(u)&&u instanceof ArrayBuffer&&(u=new Uint8Array(u)),s.send(u),n.promise},Object.defineProperty(j.prototype,"storageType",{get:function(){if(this.storageApi){var e=this.storageApi.match(/draft-dejong-(remotestorage-\d\d)/);return e?e[1]:"2012.04"}}}),j._rs_init=function(e){f=y.localStorageAvailable(),e.remote=new j(e),this.online=!0},j._rs_supported=function(){return!!XMLHttpRequest},j._rs_cleanup=function(e){f&&delete localStorage[_],e.removeEventListener("error",k)},e.exports=j}).call(t,function(){return this}(),r(18).Buffer)},function(e,t,r){(function(e,n){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function o(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function i(){return e.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,r){if(i()<r)throw new RangeError("Invalid typed array length");return e.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(r),t.__proto__=e.prototype):(null===t&&(t=new e(r)),t.length=r),t}function e(t,r,n){if(!(e.TYPED_ARRAY_SUPPORT||this instanceof e))return new e(t,r,n);if("number"==typeof t){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return a(this,t,r,n)}function a(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?p(e,t,r,n):"string"==typeof t?h(e,t,r):d(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t,r,n){return u(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}function l(t,r){if(u(r),t=s(t,r<0?0:0|m(r)),!e.TYPED_ARRAY_SUPPORT)for(var n=0;n<r;++n)t[n]=0;return t}function h(t,r,n){if("string"==typeof n&&""!==n||(n="utf8"),!e.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|v(r,n);t=s(t,o);var i=t.write(r,n);return i!==o&&(t=t.slice(0,i)),t}function f(e,t){var r=t.length<0?0:0|m(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function p(t,r,n,o){if(r.byteLength,n<0||r.byteLength<n)throw new RangeError("'offset' is out of bounds");if(r.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");return r=void 0===n&&void 0===o?new Uint8Array(r):void 0===o?new Uint8Array(r,n):new Uint8Array(r,n,o),e.TYPED_ARRAY_SUPPORT?(t=r,t.__proto__=e.prototype):t=f(t,r),t}function d(t,r){if(e.isBuffer(r)){var n=0|m(r.length);return t=s(t,n),0===t.length?t:(r.copy(t,0,0,n),t)}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||$(r.length)?s(t,0):f(t,r);if("Buffer"===r.type&&Z(r.data))return f(t,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function m(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function y(t){return+t!=t&&(t=0),e.alloc(+t)}function v(t,r){if(e.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return z(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(t).length;default:if(o)return z(t).length;r=(""+r).toLowerCase(),o=!0}}function g(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return F(this,t,r);case"utf8":case"utf-8":return R(this,t,r);case"ascii":return O(this,t,r);case"latin1":case"binary":return x(this,t,r);case"base64":return A(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function _(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function b(t,r,n,o,i){if(0===t.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof r&&(r=e.from(r,o)),e.isBuffer(r))return 0===r.length?-1:w(t,r,n,o,i);if("number"==typeof r)return r=255&r,e.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,r,n):Uint8Array.prototype.lastIndexOf.call(t,r,n):w(t,[r],n,o,i);throw new TypeError("val must be string, number or Buffer")}function w(e,t,r,n,o){function i(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,u=t.length;if(void 0!==n&&(n=String(n).toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}var c;if(o){var l=-1;for(c=r;c<a;c++)if(i(e,c)===i(t,l===-1?0:c-l)){if(l===-1&&(l=c),c-l+1===u)return l*s}else l!==-1&&(c-=c-l),l=-1}else for(r+u>a&&(r=a-u),c=r;c>=0;c--){for(var h=!0,f=0;f<u;f++)if(i(e,c+f)!==i(t,f)){h=!1;break}if(h)return c}return-1}function E(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?(n=Number(n),n>o&&(n=o)):n=o;var i=t.length;if(i%2!==0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function P(e,t,r,n){return K(z(t,e.length-r),e,r,n)}function T(e,t,r,n){return K(J(t),e,r,n)}function C(e,t,r,n){return T(e,t,r,n)}function S(e,t,r,n){return K(W(t),e,r,n)}function k(e,t,r,n){return K(Y(t,e.length-r),e,r,n)}function A(e,t,r){return 0===t&&r===e.length?Q.fromByteArray(e):Q.fromByteArray(e.slice(t,r))}function R(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i=e[o],s=null,a=i>239?4:i>223?3:i>191?2:1;if(o+a<=r){var u,c,l,h;switch(a){case 1:i<128&&(s=i);break;case 2:u=e[o+1],128===(192&u)&&(h=(31&i)<<6|63&u,h>127&&(s=h));break;case 3:u=e[o+1],c=e[o+2],128===(192&u)&&128===(192&c)&&(h=(15&i)<<12|(63&u)<<6|63&c,h>2047&&(h<55296||h>57343)&&(s=h));break;case 4:u=e[o+1],c=e[o+2],l=e[o+3],128===(192&u)&&128===(192&c)&&128===(192&l)&&(h=(15&i)<<18|(63&u)<<12|(63&c)<<6|63&l,h>65535&&h<1114112&&(s=h))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),o+=a}return j(n)}function j(e){var t=e.length;if(t<=ee)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=ee));return r}function O(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function x(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function F(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=t;i<r;++i)o+=G(e[i]);return o}function I(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function M(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(t,r,n,o,i,s){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<s)throw new RangeError('"value" argument is out of bounds');if(n+o>t.length)throw new RangeError("Index out of range")}function U(e,t,r,n){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-r,2);o<i;++o)e[r+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function L(e,t,r,n){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-r,4);o<i;++o)e[r+o]=t>>>8*(n?o:3-o)&255}function D(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(e,t,r,n,o){return o||D(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(e,t,r,n,23,4),r+4}function V(e,t,r,n,o){return o||D(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(e,t,r,n,52,8),r+8}function q(e){if(e=H(e).replace(te,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function H(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function G(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){t=t||1/0;for(var r,n=e.length,o=null,i=[],s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=(o-55296<<10|r-56320)+65536}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function J(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function Y(e,t){for(var r,n,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,o=r%256,i.push(o),i.push(n);return i}function W(e){return Q.toByteArray(q(e))}function K(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function $(e){return e!==e}var Q=r(19),X=r(20),Z=r(21);t.Buffer=e,t.SlowBuffer=y,t.INSPECT_MAX_BYTES=50,e.TYPED_ARRAY_SUPPORT=void 0!==n.TYPED_ARRAY_SUPPORT?n.TYPED_ARRAY_SUPPORT:o(),t.kMaxLength=i(),e.poolSize=8192,e._augment=function(t){return t.__proto__=e.prototype,t},e.from=function(e,t,r){return a(null,e,t,r)},e.TYPED_ARRAY_SUPPORT&&(e.prototype.__proto__=Uint8Array.prototype,e.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0})),e.alloc=function(e,t,r){return c(null,e,t,r)},e.allocUnsafe=function(e){return l(null,e)},e.allocUnsafeSlow=function(e){return l(null,e)},e.isBuffer=function(e){return!(null==e||!e._isBuffer)},e.compare=function(t,r){if(!e.isBuffer(t)||!e.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(t===r)return 0;for(var n=t.length,o=r.length,i=0,s=Math.min(n,o);i<s;++i)if(t[i]!==r[i]){n=t[i],o=r[i];break}return n<o?-1:o<n?1:0},e.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,r){if(!Z(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<t.length;++n)r+=t[n].length;var o=e.allocUnsafe(r),i=0;for(n=0;n<t.length;++n){var s=t[n];if(!e.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,i),i+=s.length}return o},e.byteLength=v,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)_(this,t,t+1);return this},e.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},e.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},e.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?R(this,0,e):g.apply(this,arguments)},e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},e.prototype.compare=function(t,r,n,o,i){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===n&&(n=t?t.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),r<0||n>t.length||o<0||i>this.length)throw new RangeError("out of range index");if(o>=i&&r>=n)return 0;if(o>=i)return-1;if(r>=n)return 1;if(r>>>=0,n>>>=0,o>>>=0,i>>>=0,this===t)return 0;for(var s=i-o,a=n-r,u=Math.min(s,a),c=this.slice(o,i),l=t.slice(r,n),h=0;h<u;++h)if(c[h]!==l[h]){s=c[h],a=l[h];break}return s<a?-1:a<s?1:0},e.prototype.includes=function(e,t,r){return this.indexOf(e,t,r)!==-1},e.prototype.indexOf=function(e,t,r){return b(this,e,t,r,!0)},e.prototype.lastIndexOf=function(e,t,r){return b(this,e,t,r,!1)},e.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t=0|t,isFinite(r)?(r=0|r,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return P(this,e,t,r);case"ascii":return T(this,e,t,r);case"latin1":case"binary":return C(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;e.prototype.slice=function(t,r){var n=this.length;t=~~t,r=void 0===r?n:~~r,t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),r<0?(r+=n,r<0&&(r=0)):r>n&&(r=n),r<t&&(r=t);var o;if(e.TYPED_ARRAY_SUPPORT)o=this.subarray(t,r),o.__proto__=e.prototype;else{var i=r-t;o=new e(i,void 0);for(var s=0;s<i;++s)o[s]=this[s+t]}return o},e.prototype.readUIntLE=function(e,t,r){e=0|e,t=0|t,r||M(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},e.prototype.readUIntBE=function(e,t,r){e=0|e,t=0|t,r||M(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},e.prototype.readUInt8=function(e,t){return t||M(e,1,this.length),this[e]},e.prototype.readUInt16LE=function(e,t){return t||M(e,2,this.length),this[e]|this[e+1]<<8},e.prototype.readUInt16BE=function(e,t){return t||M(e,2,this.length),this[e]<<8|this[e+1]},e.prototype.readUInt32LE=function(e,t){return t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},e.prototype.readUInt32BE=function(e,t){return t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},e.prototype.readIntLE=function(e,t,r){e=0|e,t=0|t,r||M(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return o*=128,n>=o&&(n-=Math.pow(2,8*t)),n},e.prototype.readIntBE=function(e,t,r){e=0|e,t=0|t,r||M(e,t,this.length);for(var n=t,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i},e.prototype.readInt8=function(e,t){return t||M(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},e.prototype.readInt16LE=function(e,t){t||M(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt16BE=function(e,t){t||M(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt32LE=function(e,t){return t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},e.prototype.readInt32BE=function(e,t){return t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},e.prototype.readFloatLE=function(e,t){return t||M(e,4,this.length),X.read(this,e,!0,23,4)},e.prototype.readFloatBE=function(e,t){return t||M(e,4,this.length),X.read(this,e,!1,23,4)},e.prototype.readDoubleLE=function(e,t){return t||M(e,8,this.length),X.read(this,e,!0,52,8)},e.prototype.readDoubleBE=function(e,t){return t||M(e,8,this.length),X.read(this,e,!1,52,8)},e.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t=0|t,r=0|r,!n){var o=Math.pow(2,8*r)-1;N(this,e,t,r,o,0)}var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},e.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t=0|t,r=0|r,!n){var o=Math.pow(2,8*r)-1;N(this,e,t,r,o,0)}var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},e.prototype.writeUInt8=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,1,255,0),e.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&t,r+1},e.prototype.writeUInt16LE=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,2,65535,0),e.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):U(this,t,r,!0),r+2},e.prototype.writeUInt16BE=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,2,65535,0),e.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):U(this,t,r,!1),r+2},e.prototype.writeUInt32LE=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,4,4294967295,0),e.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t):L(this,t,r,!0),r+4},e.prototype.writeUInt32BE=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,4,4294967295,0),e.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):L(this,t,r,!1),r+4},e.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t=0|t,!n){var o=Math.pow(2,8*r-1);N(this,e,t,r,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},e.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t=0|t,!n){var o=Math.pow(2,8*r-1);N(this,e,t,r,o-1,-o)}var i=r-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},e.prototype.writeInt8=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,1,127,-128),e.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[r]=255&t,r+1},e.prototype.writeInt16LE=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,2,32767,-32768),e.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):U(this,t,r,!0),r+2},e.prototype.writeInt16BE=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,2,32767,-32768),e.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):U(this,t,r,!1),r+2},e.prototype.writeInt32LE=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,4,2147483647,-2147483648),e.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):L(this,t,r,!0),r+4},e.prototype.writeInt32BE=function(t,r,n){return t=+t,r=0|r,n||N(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),e.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):L(this,t,r,!1),r+4},e.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},e.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},e.prototype.writeDoubleLE=function(e,t,r){return V(this,e,t,!0,r)},e.prototype.writeDoubleBE=function(e,t,r){return V(this,e,t,!1,r)},e.prototype.copy=function(t,r,n,o){if(n||(n=0),o||0===o||(o=this.length),r>=t.length&&(r=t.length),r||(r=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),t.length-r<o-n&&(o=t.length-r+n);var i,s=o-n;if(this===t&&n<r&&r<o)for(i=s-1;i>=0;--i)t[i+r]=this[i+n];else if(s<1e3||!e.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+r]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+s),r);return s},e.prototype.fill=function(t,r,n,o){if("string"==typeof t){if("string"==typeof r?(o=r,r=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!e.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof t&&(t=255&t);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;r>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0);var s;if("number"==typeof t)for(s=r;s<n;++s)this[s]=t;else{var a=e.isBuffer(t)?t:z(new e(t,o).toString()),u=a.length;for(s=0;s<n-r;++s)this[s+r]=a[s%u]}return this};var te=/[^+\/0-9A-Za-z-_]/g}).call(t,r(18).Buffer,function(){return this}())},function(e,t){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function n(e){return 3*e.length/4-r(e)}function o(e){var t,n,o,i,s,a,u=e.length;s=r(e),a=new l(3*u/4-s),o=s>0?u-4:u;var h=0;for(t=0,n=0;t<o;t+=4,n+=3)i=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],a[h++]=i>>16&255,a[h++]=i>>8&255,a[h++]=255&i;return 2===s?(i=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,a[h++]=255&i):1===s&&(i=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,a[h++]=i>>8&255,a[h++]=255&i),a}function i(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}function s(e,t,r){for(var n,o=[],s=t;s<r;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(i(n));return o.join("")}function a(e){for(var t,r=e.length,n=r%3,o="",i=[],a=16383,c=0,l=r-n;c<l;c+=a)i.push(s(e,c,c+a>l?l:c+a));return 1===n?(t=e[r-1],o+=u[t>>2],o+=u[t<<4&63],o+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],o+=u[t>>10],o+=u[t>>4&63],o+=u[t<<2&63],o+="="),i.push(o),i.join("")}t.byteLength=n,t.toByteArray=o,t.fromByteArray=a;for(var u=[],c=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,p=h.length;f<p;++f)u[f]=h[f],c[h.charCodeAt(f)]=f;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,o){var i,s,a=8*o-n-1,u=(1<<a)-1,c=u>>1,l=-7,h=r?o-1:0,f=r?-1:1,p=e[t+h];for(h+=f,i=p&(1<<-l)-1,p>>=-l,l+=a;l>0;i=256*i+e[t+h],h+=f,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=n;l>0;s=256*s+e[t+h],h+=f,l-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:(p?-1:1)*(1/0);s+=Math.pow(2,n),i-=c}return(p?-1:1)*s*Math.pow(2,i-n)},t.write=function(e,t,r,n,o,i){var s,a,u,c=8*i-o-1,l=(1<<c)-1,h=l>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,d=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),t+=s+h>=1?f/u:f*Math.pow(2,1-h),t*u>=2&&(s++,u/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(t*u-1)*Math.pow(2,o),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,o),s=0));o>=8;e[r+p]=255&a,p+=d,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[r+p]=255&s,p+=d,s/=256,c-=8);e[r+p-d]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";function n(e,t,r){return{action:e,path:t,promise:r}}function o(e){return e.remote&&e.remote.revision&&!e.remote.itemsMap&&!e.remote.body}function i(e){return e.common&&e.common.revision}function s(){function e(e){var r,n;r=t.getCurrentSyncInterval(),p.isBackground=!e,n=t.getCurrentSyncInterval(),t._emit("sync-interval-change",{oldValue:r,newValue:n})}var t=this;c.on("background",function(){e(!1)}),c.on("foreground",function(){e(!0)})}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=r(5),c=r(23),l=r(6),h=r(7),f=r(10),p=r(8),d=u.isFolder,m=u.isDocument,y=u.equal,v=u.deepClone,g=u.pathsFromRoot,_=function(e,t,r,n,o){this.remoteStorage=e,this.local=t,this.local.onDiff(function(e){this.addTask(e),this.doTasks()}.bind(this)),this.remote=r,this.access=n,this.caching=o,this._tasks={},this._running={},this._timeStarted={},l(this,"done","req-done"),this.caching.onActivate(function(e){this.addTask(e),this.doTasks()}.bind(this))};_.prototype={now:function(){return(new Date).getTime()},queueGetRequest:function(e){var t=Promise.defer();return this.remote.connected?this.remote.online?(this.addTask(e,function(){this.local.get(e).then(function(e){return t.resolve(e)})}.bind(this)),this.doTasks()):t.reject("cannot fulfill maxAge requirement - remote is not online"):t.reject("cannot fulfill maxAge requirement - remote is not connected"),t.promise},corruptServerItemsMap:function(e,t){if("object"!==("undefined"==typeof e?"undefined":a(e))||Array.isArray(e))return!0;for(var r in e){var n=e[r];if("object"!==("undefined"==typeof n?"undefined":a(n)))return!0;if("string"!=typeof n.ETag)return!0;if(d(r)){if(r.substring(0,r.length-1).indexOf("/")!==-1)return!0}else{if(r.indexOf("/")!==-1)return!0;if(t){if("string"!=typeof n["Content-Type"])return!0;if("number"!=typeof n["Content-Length"])return!0}}}return!1},corruptItemsMap:function(e){if("object"!==("undefined"==typeof e?"undefined":a(e))||Array.isArray(e))return!0;for(var t in e)if("boolean"!=typeof e[t])return!0;return!1},corruptRevision:function(e){return"object"!==("undefined"==typeof e?"undefined":a(e))||Array.isArray(e)||e.revision&&"string"!=typeof e.revision||e.body&&"string"!=typeof e.body&&"object"!==a(e.body)||e.contentType&&"string"!=typeof e.contentType||e.contentLength&&"number"!=typeof e.contentLength||e.timestamp&&"number"!=typeof e.timestamp||e.itemsMap&&this.corruptItemsMap(e.itemsMap)},isCorrupt:function(e){return"object"!==("undefined"==typeof e?"undefined":a(e))||Array.isArray(e)||"string"!=typeof e.path||this.corruptRevision(e.common)||e.local&&this.corruptRevision(e.local)||e.remote&&this.corruptRevision(e.remote)||e.push&&this.corruptRevision(e.push)},hasTasks:function(){return Object.getOwnPropertyNames(this._tasks).length>0},collectDiffTasks:function(){var e=0;return this.local.forAllNodes(function(t){e>100||(this.isCorrupt(t)?(h("[Sync] WARNING: corrupt node in local cache",t),"object"===("undefined"==typeof t?"undefined":a(t))&&t.path&&(this.addTask(t.path),e++)):this.needsFetch(t)&&this.access.checkPathPermission(t.path,"r")?(this.addTask(t.path),e++):m(t.path)&&this.needsPush(t)&&this.access.checkPathPermission(t.path,"rw")&&(this.addTask(t.path),e++))}.bind(this)).then(function(){return e},function(e){throw e})},inConflict:function(e){return e.local&&e.remote&&(void 0!==e.remote.body||e.remote.itemsMap)},needsRefresh:function(e){return!!e.common&&(!e.common.timestamp||this.now()-e.common.timestamp>p.syncInterval)},needsFetch:function(e){return!!this.inConflict(e)||(!(!e.common||void 0!==e.common.itemsMap||void 0!==e.common.body)||!(!e.remote||void 0!==e.remote.itemsMap||void 0!==e.remote.body))},needsPush:function(e){return!this.inConflict(e)&&(!(!e.local||e.push)||void 0)},needsRemotePut:function(e){return e.local&&e.local.body},needsRemoteDelete:function(e){return e.local&&e.local.body===!1},getParentPath:function(e){var t=e.match(/^(.*\/)([^\/]+\/?)$/);if(t)return t[1];throw new Error('Not a valid path: "'+e+'"')},deleteChildPathsFromTasks:function(){for(var e in this._tasks)for(var t=g(e),r=1;r<t.length;r++)this._tasks[t[r]]&&(Array.isArray(this._tasks[e])&&this._tasks[e].length&&Array.prototype.push.apply(this._tasks[t[r]],this._tasks[e]),delete this._tasks[e])},collectRefreshTasks:function(){return this.local.forAllNodes(function(e){var t;if(this.needsRefresh(e)){try{t=this.getParentPath(e.path)}catch(e){}t&&this.access.checkPathPermission(t,"r")?this.addTask(t):this.access.checkPathPermission(e.path,"r")&&this.addTask(e.path)}}.bind(this)).then(function(){this.deleteChildPathsFromTasks()}.bind(this),function(e){throw e})},flush:function(e){for(var t in e)"FLUSH"===this.caching.checkPath(t)&&e[t]&&!e[t].local&&(h("[Sync] Flushing",t),e[t]=void 0);return e},doTask:function(e){return this.local.getNodes([e]).then(function(t){var r=t[e];return"undefined"==typeof r?n("get",e,this.remote.get(e)):o(r)?n("get",e,this.remote.get(e)):this.needsRemotePut(r)?(r.push=v(r.local),r.push.timestamp=this.now(),this.local.setNodes(this.flush(t)).then(function(){var t;return t=i(r)?{ifMatch:r.common.revision}:{ifNoneMatch:"*"},n("put",e,this.remote.put(e,r.push.body,r.push.contentType,t))}.bind(this))):this.needsRemoteDelete(r)?(r.push={body:!1,timestamp:this.now()},this.local.setNodes(this.flush(t)).then(function(){return i(r)?n("delete",e,this.remote.delete(e,{ifMatch:r.common.revision})):n("get",e,this.remote.get(e))}.bind(this))):i(r)?n("get",e,this.remote.get(e,{ifNoneMatch:r.common.revision})):n("get",e,this.remote.get(e))}.bind(this))},autoMergeFolder:function(e){if(e.remote.itemsMap&&(e.common=e.remote,delete e.remote,e.common.itemsMap)){for(var t in e.common.itemsMap)e.local.itemsMap[t]||(e.local.itemsMap[t]=!1);y(e.local.itemsMap,e.common.itemsMap)&&delete e.local}return e},autoMergeDocument:function(e){return hasNoRemoteChanges=function(e){return(!e.remote||!e.remote.revision||e.remote.revision===e.common.revision)&&(void 0===e.common.body&&e.remote.body===!1||e.remote.body===e.common.body&&e.remote.contentType===e.common.contentType)},mergeMutualDeletion=function(e){return e.remote&&e.remote.body===!1&&e.local&&e.local.body===!1&&delete e.local,e},hasNoRemoteChanges(e)?(e=mergeMutualDeletion(e),delete e.remote):void 0!==e.remote.body&&(h("[Sync] Emitting keep/revert"),this.local._emitChange({origin:"conflict",path:e.path,oldValue:e.local.body,newValue:e.remote.body,lastCommonValue:e.common.body,oldContentType:e.local.contentType,newContentType:e.remote.contentType,lastCommonContentType:e.common.contentType}),e.remote.body?e.common=e.remote:e.common={},delete e.remote,delete e.local),e},autoMerge:function(e){if(!e.remote)return void(e.common.body&&this.local._emitChange({origin:"remote",path:e.path,oldValue:e.common.body,newValue:void 0,oldContentType:e.common.contentType,newContentType:void 0}));if(e.local)return d(e.path)?this.autoMergeFolder(e):this.autoMergeDocument(e);if(d(e.path))void 0!==e.remote.itemsMap&&(e.common=e.remote,delete e.remote);else if(void 0!==e.remote.body){var t={origin:"remote",path:e.path,oldValue:e.common.body===!1?void 0:e.common.body,newValue:e.remote.body===!1?void 0:e.remote.body,oldContentType:e.common.contentType,newContentType:e.remote.contentType};if((t.oldValue||t.newValue)&&this.local._emitChange(t),!e.remote.body)return;e.common=e.remote,delete e.remote}return e},updateCommonTimestamp:function(e,t){return this.local.getNodes([e]).then(function(r){return r[e]&&r[e].common&&r[e].common.revision===t&&(r[e].common.timestamp=this.now()),this.local.setNodes(this.flush(r))}.bind(this))},markChildren:function(e,t,r,n){var o=[],i={},s={};for(var a in t)o.push(e+a),i[e+a]=t[a];for(var u in n)o.push(e+u);return this.local.getNodes(o).then(function(t){var o,a,u=function(e,t){return e.common.revision!==t&&(!e.remote||e.remote.revision!==t)};for(var c in t)if(a=t[c],i[c])a&&a.common?u(a,i[c].ETag)&&(r[c]=v(a),r[c].remote={revision:i[c].ETag,timestamp:this.now()},r[c]=this.autoMerge(r[c])):(o=this.caching.checkPath(c),"ALL"===o&&(r[c]={path:c,common:{timestamp:this.now()},remote:{revision:i[c].ETag,timestamp:this.now()}})),r[c]&&i[c]["Content-Type"]&&(r[c].remote.contentType=i[c]["Content-Type"]),r[c]&&i[c]["Content-Length"]&&(r[c].remote.contentLength=i[c]["Content-Length"]);else if(n[c.substring(e.length)]&&a&&a.common){if(a.common.itemsMap)for(var l in a.common.itemsMap)s[c+l]=!0;if(a.local&&a.local.itemsMap)for(var h in a.local.itemsMap)s[c+h]=!0;if(a.remote||d(c))r[c]=void 0;else if(r[c]=this.autoMerge(a),"undefined"==typeof r[c]){var f=this.getParentPath(c),p=r[f],m=c.substring(e.length);p&&p.local&&(delete p.local.itemsMap[m],y(p.local.itemsMap,p.common.itemsMap)&&delete p.local)}}return this.deleteRemoteTrees(Object.keys(s),r).then(function(e){return this.local.setNodes(this.flush(e))}.bind(this))}.bind(this))},deleteRemoteTrees:function(e,t){return 0===e.length?Promise.resolve(t):this.local.getNodes(e).then(function(e){var r={};collectSubPaths=function(e,t){if(e&&e.itemsMap)for(var n in e.itemsMap)r[t+n]=!0};for(var n in e){var o=e[n];o&&(d(n)?(collectSubPaths(o.common,n),collectSubPaths(o.local,n)):o.common&&void 0!==a(o.common.body)&&(t[n]=v(o),t[n].remote={body:!1,timestamp:this.now()},t[n]=this.autoMerge(t[n])))}return this.deleteRemoteTrees(Object.keys(r),t).then(function(e){return this.local.setNodes(this.flush(e))}.bind(this))}.bind(this))},completeFetch:function(e,t,r,n){var o,i,s=g(e);return d(e)?o=[e]:(i=s[1],o=[e,i]),this.local.getNodes(o).then(function(o){var s,u,c={},l=o[e],h=function(e){if(e&&e.itemsMap)for(var r in e.itemsMap)t[r]||(c[r]=!0);
};if("object"===("undefined"==typeof l?"undefined":a(l))&&l.path===e&&"object"===a(l.common)||(l={path:e,common:{}},o[e]=l),l.remote={revision:n,timestamp:this.now()},d(e)){h(l.common),h(l.remote),l.remote.itemsMap={};for(s in t)l.remote.itemsMap[s]=!0}else l.remote.body=t,l.remote.contentType=r,u=o[i],u&&u.local&&u.local.itemsMap&&(s=e.substring(i.length),u.local.itemsMap[s]=!0,y(u.local.itemsMap,u.common.itemsMap)&&delete u.local);return o[e]=this.autoMerge(l),{toBeSaved:o,missingChildren:c}}.bind(this))},completePush:function(e,t,r,n){return this.local.getNodes([e]).then(function(o){var i=o[e];if(!i.push)throw this.stopped=!0,new Error("completePush called but no push version!");return r?(h("[Sync] We have a conflict"),i.remote&&i.remote.revision===n||(i.remote={revision:n||"conflict",timestamp:this.now()},delete i.push),o[e]=this.autoMerge(i)):(i.common={revision:n,timestamp:this.now()},"put"===t?(i.common.body=i.push.body,i.common.contentType=i.push.contentType,y(i.local.body,i.push.body)&&i.local.contentType===i.push.contentType&&delete i.local,delete i.push):"delete"===t&&(i.local.body===!1?o[e]=void 0:delete i.push)),this.local.setNodes(this.flush(o))}.bind(this))},dealWithFailure:function(e,t,r){return this.local.getNodes([e]).then(function(t){if(t[e])return delete t[e].push,this.local.setNodes(this.flush(t))}.bind(this))},interpretStatus:function(e){if("offline"===e||"timeout"===e)return{successful:!1,networkProblems:!0,statusCode:e};var t=Math.floor(e/100);return{successful:2===t||304===e||412===e||404===e,conflict:412===e,unAuth:401===e&&this.remote.token!==f.IMPLIED_FAKE_TOKEN||402===e||403===e,notFound:404===e,changed:304!==e,statusCode:e}},handleGetResponse:function(e,t,r,n,o){return t.notFound&&(r=!!d(e)&&{}),t.changed?this.completeFetch(e,r,n,o).then(function(t){return d(e)?this.corruptServerItemsMap(r)?(h("[Sync] WARNING: Discarding corrupt folder description from server for "+e),!1):this.markChildren(e,r,t.toBeSaved,t.missingChildren).then(function(){return!0}):this.local.setNodes(this.flush(t.toBeSaved)).then(function(){return!0})}.bind(this)):this.updateCommonTimestamp(e,o).then(function(){return!0})},handleResponse:function(e,t,r){var n=this.interpretStatus(r.statusCode);if(n.successful){if("get"===t)return this.handleGetResponse(e,n,r.body,r.contentType,r.revision);if("put"===t||"delete"===t)return this.completePush(e,t,n.conflict,r.revision).then(function(){return!0});throw new Error("cannot handle response for unknown action",t)}var o;return o=n.unAuth?new f.Unauthorized:n.networkProblems?new _.SyncError("Network request failed."):new Error("HTTP response code "+n.statusCode+" received."),this.dealWithFailure(e,t,n).then(function(){throw this.remoteStorage._emit("error",o),o})},numThreads:10,finishTask:function(e){if(void 0===e.action)return void delete this._running[e.path];var t=this;return e.promise.then(function(r){return t.handleResponse(e.path,e.action,r)},function(r){return h("[Sync] wireclient rejects its promise!",e.path,e.action,r),t.handleResponse(e.path,e.action,{statusCode:"offline"})}).then(function(r){if(delete t._timeStarted[e.path],delete t._running[e.path],r&&t._tasks[e.path]){for(var n=0;n<t._tasks[e.path].length;n++)t._tasks[e.path][n]();delete t._tasks[e.path]}t._emit("req-done"),t.collectTasks(!1).then(function(){!t.hasTasks()||t.stopped?(h("[Sync] Sync is done! Reschedule?",Object.getOwnPropertyNames(t._tasks).length,t.stopped),t.done||(t.done=!0,t._emit("done"))):setTimeout(function(){t.doTasks()},10)})},function(r){h("[Sync] Error",r),delete t._timeStarted[e.path],delete t._running[e.path],t._emit("req-done"),t.done||(t.done=!0,t._emit("done"))})},doTasks:function(){var e,t,r,n=0;if(e=this.remote.connected?this.remote.online?this.numThreads:1:0,t=e-Object.getOwnPropertyNames(this._running).length,t<=0)return!0;for(r in this._tasks)if(!this._running[r]&&(this._timeStarted[r]=this.now(),this._running[r]=this.doTask(r),this._running[r].then(this.finishTask.bind(this)),n++,n>=t))return!0;return n>=t},collectTasks:function(e){return this.hasTasks()||this.stopped?Promise.resolve():this.collectDiffTasks().then(function(t){return t||e===!1?Promise.resolve():this.collectRefreshTasks()}.bind(this),function(e){throw e})},addTask:function(e,t){this._tasks[e]||(this._tasks[e]=[]),"function"==typeof t&&this._tasks[e].push(t)},sync:function(){return this.done=!1,this.doTasks()?Promise.resolve():this.collectTasks().then(function(){try{this.doTasks()}catch(e){h("[Sync] doTasks error",e)}}.bind(this),function(e){throw h("[Sync] Sync error",e),new Error("Local cache unavailable")})}};var b,w;_._rs_init=function(e){b=function(){h("[Sync] syncCycleCb calling syncCycle"),c.isBrowser()&&s.bind(e)(),e.sync||(e.sync=new _(e,e.local,e.remote,e.access,e.caching),e.syncStopped&&(h("[Sync] Instantiating sync stopped"),e.sync.stopped=!0,delete e.syncStopped)),h("[Sync] syncCycleCb calling syncCycle"),e.syncCycle()},w=function(){e.removeEventListener("connected",w),e.startSync()},e.on("ready",b),e.on("connected",w)},_._rs_cleanup=function(e){e.stopSync(),e.removeEventListener("ready",b),e.removeEventListener("connected",w),e.sync=void 0,delete e.sync};var E=function(e){var t="Sync failed: ";t+="object"===("undefined"==typeof e?"undefined":a(e))&&"message"in e?e.message:e,this.originalError=e,this.message=t};E.prototype=new Error,E.prototype.constructor=E,_.SyncError=E,e.exports=_},function(e,t,r){"use strict";var n=r(6),o="undefined"!=typeof window?"browser":"node",i={},s=!1,a=function(){return i};a.isBrowser=function(){return"browser"===o},a.isNode=function(){return"node"===o},a.goBackground=function(){s=!0,a._emit("background")},a.goForeground=function(){s=!1,a._emit("foreground")},a._rs_init=function(e){function t(){document[i.hiddenProperty]?a.goBackground():a.goForeground()}n(a,"background","foreground"),"browser"===o&&("undefined"!=typeof document.hidden?(i.hiddenProperty="hidden",i.visibilityChangeEvent="visibilitychange"):"undefined"!=typeof document.mozHidden?(i.hiddenProperty="mozHidden",i.visibilityChangeEvent="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(i.hiddenProperty="msHidden",i.visibilityChangeEvent="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(i.hiddenProperty="webkitHidden",i.visibilityChangeEvent="webkitvisibilitychange"),document.addEventListener(i.visibilityChangeEvent,t,!1),t())},a._rs_cleanup=function(e){},e.exports=a},function(e,t,r){"use strict";function n(e){return"/"===e.substr(-1)&&(e=e.substr(0,e.length-1)),decodeURIComponent(e)}function o(e){return e.replace(/[^\/]+\/?$/,"")}function i(e){var t=e.split("/");return"/"===e.substr(-1)?t[t.length-2]+"/":t[t.length-1]}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(10),u=r(17),c=r(6),l=r(5),h="https://www.googleapis.com",f="https://accounts.google.com/o/oauth2/auth",p="https://www.googleapis.com/auth/drive",d="application/vnd.google-apps.folder",m="application/json; charset=UTF-8",y=l.isFolder,v=function(e){this.maxAge=e,this._items={}};v.prototype={get:function(e){var t=this._items[e],r=(new Date).getTime();return t&&t.t>=r-this.maxAge?t.v:void 0},set:function(e,t){this._items[e]={v:t,t:(new Date).getTime()}}};var g=function(e,t){c(this,"change","connected","wire-busy","wire-done","not-connected"),this.rs=e,this.clientId=t,this._fileIdCache=new v(300)};g.prototype={connected:!1,online:!0,configure:function(e){e.token?(localStorage["remotestorage:googledrive:token"]=e.token,this.token=e.token,this.connected=!0,this._emit("connected")):(this.connected=!1,delete this.token,delete localStorage["remotestorage:googledrive:token"])},connect:function(){this.rs.setBackend("googledrive"),a(this.rs,f,p,String(a.getLocation()),this.clientId)},stopWaitingForToken:function(){this.connected||this._emit("not-connected")},get:function(e,t){return"/"===e.substr(-1)?this._getFolder(e,t):this._getFile(e,t)},put:function(e,t,r,n){function o(e){if(e.status>=200&&e.status<300){var t=JSON.parse(e.responseText),r=t.etag.substring(1,t.etag.length-1);return Promise.resolve({statusCode:200,contentType:t.mimeType,revision:r})}return 412===e.status?Promise.resolve({statusCode:412,revision:"conflict"}):Promise.reject("PUT failed with status "+e.status+" ("+e.responseText+")")}var i=this;return i._getFileId(e).then(function(s){return s?n&&"*"===n.ifNoneMatch?o({status:412}):i._updateFile(s,e,t,r,n).then(o):i._createFile(e,t,r,n).then(o)})},delete:function(e,t){var r=this;return r._getFileId(e).then(function(e){return e?r._getMeta(e).then(function(n){var o;return"object"===("undefined"==typeof n?"undefined":s(n))&&"string"==typeof n.etag&&(o=n.etag.substring(1,n.etag.length-1)),t&&t.ifMatch&&t.ifMatch!==o?{statusCode:412,revision:o}:r._request("DELETE",h+"/drive/v2/files/"+e,{}).then(function(e){return 200===e.status||204===e.status?{statusCode:200}:Promise.reject("Delete failed: "+e.status+" ("+e.responseText+")")})}):Promise.resolve({statusCode:200})})},_updateFile:function(e,t,r,n,o){var i=this,s={mimeType:n},a={"Content-Type":"application/json; charset=UTF-8"};return o&&o.ifMatch&&(a["If-Match"]='"'+o.ifMatch+'"'),i._request("PUT",h+"/upload/drive/v2/files/"+e+"?uploadType=resumable",{body:JSON.stringify(s),headers:a}).then(function(e){return 412===e.status?e:i._request("PUT",e.getResponseHeader("Location"),{body:n.match(/^application\/json/)?JSON.stringify(r):r})})},_createFile:function(e,t,r,o){var s=this;return s._getParentId(e).then(function(o){var a=i(e),u={title:n(a),mimeType:r,parents:[{kind:"drive#fileLink",id:o}]};return s._request("POST",h+"/upload/drive/v2/files?uploadType=resumable",{body:JSON.stringify(u),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(e){return s._request("POST",e.getResponseHeader("Location"),{body:r.match(/^application\/json/)?JSON.stringify(t):t})})})},_getFile:function(e,t){var r=this;return r._getFileId(e).then(function(e){return r._getMeta(e).then(function(e){var n;if("object"===("undefined"==typeof e?"undefined":s(e))&&"string"==typeof e.etag&&(n=e.etag.substring(1,e.etag.length-1)),t&&t.ifNoneMatch&&n===t.ifNoneMatch)return Promise.resolve({statusCode:304});var o={};if(!e.downloadUrl){if(!e.exportLinks||!e.exportLinks["text/html"])return Promise.resolve({statusCode:200,body:"",contentType:e.mimeType,revision:n});e.mimeType+=";export=text/html",e.downloadUrl=e.exportLinks["text/html"]}return e.mimeType.match(/charset=binary/)&&(o.responseType="blob"),r._request("GET",e.downloadUrl,o).then(function(t){var r=t.response;if(e.mimeType.match(/^application\/json/))try{r=JSON.parse(r)}catch(e){}return Promise.resolve({statusCode:200,body:r,contentType:e.mimeType,revision:n})})})})},_getFolder:function(e,t){var r=this;return r._getFileId(e).then(function(t){var n,o,i,s,a;return t?(n="'"+t+"' in parents",o="items(downloadUrl,etag,fileSize,id,mimeType,title)",r._request("GET",h+"/drive/v2/files?q="+encodeURIComponent(n)+"&fields="+encodeURIComponent(o)+"&maxResults=1000",{}).then(function(t){if(200!==t.status)return Promise.reject("request failed or something: "+t.status);try{i=JSON.parse(t.responseText)}catch(e){return Promise.reject("non-JSON response from GoogleDrive")}a={};for(var n=0,o=i.items.length;n<o;n++)s=i.items[n].etag.substring(1,i.items[n].etag.length-1),i.items[n].mimeType===d?(r._fileIdCache.set(e+i.items[n].title+"/",i.items[n].id),a[i.items[n].title+"/"]={ETag:s}):(r._fileIdCache.set(e+i.items[n].title,i.items[n].id),a[i.items[n].title]={ETag:s,"Content-Type":i.items[n].mimeType,"Content-Length":i.items[n].fileSize});return Promise.resolve({statusCode:200,body:a,contentType:m,revision:void 0})})):Promise.resolve({statusCode:404})})},_getParentId:function(e){var t=o(e),r=this;return r._getFileId(t).then(function(e){return e?Promise.resolve(e):r._createFolder(t)})},_createFolder:function(e){var t=this;return t._getParentId(e).then(function(r){return t._request("POST",h+"/drive/v2/files",{body:JSON.stringify({title:n(i(e)),mimeType:d,parents:[{id:r}]}),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(e){var t=JSON.parse(e.responseText);return Promise.resolve(t.id)})})},_getFileId:function(e){var t,r=this;return"/"===e?Promise.resolve("root"):(t=this._fileIdCache.get(e))?Promise.resolve(t):r._getFolder(o(e)).then(function(){return t=r._fileIdCache.get(e),t?Promise.resolve(t):"/"===e.substr(-1)?r._createFolder(e).then(function(){return r._getFileId(e)}):Promise.resolve()})},_getMeta:function(e){return this._request("GET",h+"/drive/v2/files/"+e,{}).then(function(t){return 200===t.status?Promise.resolve(JSON.parse(t.responseText)):Promise.reject("request (getting metadata for "+e+") failed with status: "+t.status)})},info:function(){var e=h+"/drive/v2/about";return this._request("GET",e,{}).then(function(e){try{var t=JSON.parse(e.responseText);return Promise.resolve(t)}catch(e){return Promise.reject(e)}})},_request:function(e,t,r){var n=this;return r.headers||(r.headers={}),r.headers.Authorization="Bearer "+n.token,this._emit("wire-busy",{method:e,isFolder:y(t)}),u.request.call(this,e,t,r).then(function(r){return r&&401===r.status?void n.connect():(n.online||(n.online=!0,n.rs._emit("network-online")),n._emit("wire-done",{method:e,isFolder:y(t),success:!0}),Promise.resolve(r))},function(r){return n.online&&(n.online=!1,n.rs._emit("network-offline")),n._emit("wire-done",{method:e,isFolder:y(t),success:!1}),Promise.reject(r)})}},g._rs_init=function(e){var t=e.apiKeys.googledrive;t&&(e.googledrive=new g(e,t.clientId),"googledrive"===e.backend&&(e._origRemote=e.remote,e.remote=e.googledrive))},g._rs_supported=function(e){return!0},g._rs_cleanup=function(e){e.setBackend(void 0),e._origRemote&&(e.remote=e._origRemote,delete e._origRemote)},e.exports=g},function(e,t,r){"use strict";var n,o,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=r(7),a=r(5),u=r(26),c="remotestorage:discover",l={},h=function(e){if(e in l)return Promise.resolve(l[e]);var t=new u({tls_only:!1,uri_fallback:!0,request_timeout:5e3}),r=Promise.defer();return t.lookup(e,function(t,n){if(t)return r.reject(t);if("object"!==i(n.idx.links.remotestorage)||"number"!=typeof n.idx.links.remotestorage.length||n.idx.links.remotestorage.length<=0)return s("[Discover] WebFinger record for "+e+" does not have remotestorage defined in the links section ",JSON.stringify(n.json)),r.reject("WebFinger record for "+e+" does not have remotestorage defined in the links section.");var a=n.idx.links.remotestorage[0],u=a.properties["http://tools.ietf.org/html/rfc6749#section-4.2"]||a.properties["auth-endpoint"],h=a.properties["http://remotestorage.io/spec/version"]||a.type;return l[e]={href:a.href,storageType:h,authURL:u,properties:a.properties},o&&(localStorage[c]=JSON.stringify({cache:l})),r.resolve(l[e])}),r.promise};h.DiscoveryError=function(e){Error.apply(this,arguments),this.message=e},h.DiscoveryError.prototype=Object.create(Error.prototype),h._rs_init=function(e){if(o=a.localStorageAvailable()){var t;try{t=JSON.parse(localStorage[c])}catch(e){}t&&(l=t.cache)}},h._rs_supported=function(){return n=!!a.globalContext.XMLHttpRequest},h._rs_cleanup=function(){o&&delete localStorage[c]},e.exports=h},function(e,t,r){var n,o;/*!
	 * webfinger.js
	 *   version 2.6.0
	 *   http://github.com/silverbucket/webfinger.js
	 *
	 * Developed and Maintained by:
	 *   Nick Jennings <nick@silverbucket.net> 2012 - 2016
	 *
	 * webfinger.js is released under the AGPL (see LICENSE).
	 *
	 * You don't have to do anything special to choose one license or the other and you don't
	 * have to notify anyone which license you are using.
	 * Please see the corresponding license file for details of these licenses.
	 * You are free to use, modify and distribute this software, but all copyright
	 * information must remain.
	 *
	 */
"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=r(27).XMLHttpRequest),function(r){function i(e){return e.toString=function(){return this.message},e}function s(e){if("string"!=typeof e)return!1;var t=e.split("://");return"https"===t[0]}function a(e){"object"!=typeof e&&(e={}),this.config={tls_only:"undefined"==typeof e.tls_only||e.tls_only,webfist_fallback:"undefined"!=typeof e.webfist_fallback&&e.webfist_fallback,uri_fallback:"undefined"!=typeof e.uri_fallback&&e.uri_fallback,request_timeout:"undefined"!=typeof e.request_timeout?e.request_timeout:1e4}}var u={"http://webfist.org/spec/rel":"webfist","http://webfinger.net/rel/avatar":"avatar",remotestorage:"remotestorage","http://tools.ietf.org/id/draft-dejong-remotestorage":"remotestorage",remoteStorage:"remotestorage","http://www.packetizer.com/rel/share":"share","http://webfinger.net/rel/profile-page":"profile",me:"profile",vcard:"vcard",blog:"blog","http://packetizer.com/rel/blog":"blog","http://schemas.google.com/g/2010#updates-from":"updates","https://camlistore.org/rel/server":"camilstore"},c={avatar:[],remotestorage:[],blog:[],vcard:[],updates:[],share:[],profile:[],webfist:[],camlistore:[]},l=["webfinger","host-meta","host-meta.json"];a.prototype.__fetchJRD=function(e,t,r){function n(){if(200===u.status)return a.__isValidJSON(u.responseText)?r(u.responseText):t(i({message:"invalid json",url:e,status:u.status}));if(404===u.status)return t(i({message:"resource not found",url:e,status:u.status}));if(u.status>=301&&u.status<=302){var n=u.getResponseHeader("Location");return s(n)?o(n):t(i({message:"no redirect URL found",url:e,status:u.status}))}return t(i({message:"error during request",url:e,status:u.status}))}function o(){u.onreadystatechange=function(){4===u.readyState&&n()},u.onload=function(){n()},u.ontimeout=function(){return t(i({message:"request timed out",url:e,status:u.status}))},u.open("GET",e,!0),u.setRequestHeader("Accept","application/jrd+json, application/json"),u.send()}var a=this,u=new XMLHttpRequest;return u.timeout=this.config.request_timeout,o()},a.prototype.__isValidJSON=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},a.prototype.__isLocalhost=function(e){var t=/^localhost(\.localdomain)?(\:[0-9]+)?$/;return t.test(e)},a.prototype.__processJRD=function(e,t,r,n){var o=JSON.parse(t);if("object"!=typeof o||"object"!=typeof o.links)return r("undefined"!=typeof o.error?i({message:o.error,request:e}):i({message:"unknown response from server",request:e}));var s=o.links,a={object:o,json:t,idx:{}};a.idx.properties={name:void 0},a.idx.links=JSON.parse(JSON.stringify(c)),s.map(function(e,t){if(u.hasOwnProperty(e.rel)&&a.idx.links[u[e.rel]]){var r={};Object.keys(e).map(function(t,n){r[t]=e[t]}),a.idx.links[u[e.rel]].push(r)}});var l=JSON.parse(t).properties;for(var h in l)l.hasOwnProperty(h)&&"http://packetizer.com/ns/name"===h&&(a.idx.properties.name=l[h]);return n(a)},a.prototype.lookup=function(e,t){function r(){var t="";return e.split("://")[1]||(t="acct:"),u+"://"+s+"/.well-known/"+l[a]+"?resource="+t+e}function n(e){if(i.config.uri_fallback&&"webfist.org"!==s&&a!==l.length-1)return a+=1,o();if(!i.config.tls_only&&"https"===u)return a=0,u="http",o();if(!i.config.webfist_fallback||"webfist.org"===s)return t(e);a=0,u="http",s="webfist.org";var n=r();i.__fetchJRD(n,t,function(e){i.__processJRD(n,e,t,function(e){"object"==typeof e.idx.links.webfist&&"string"==typeof e.idx.links.webfist[0].href&&i.__fetchJRD(e.idx.links.webfist[0].href,t,function(e){i.__processJRD(n,e,t,function(e){return t(null,t)})})})})}function o(){var e=r();i.__fetchJRD(e,n,function(r){i.__processJRD(e,r,t,function(e){t(null,e)})})}if("string"!=typeof e)throw new Error("first parameter must be a user address");if("function"!=typeof t)throw new Error("second parameter must be a callback");var i=this,s="";s=e.indexOf("://")>-1?e.replace(/ /g,"").split("://")[1]:e.replace(/ /g,"").split("@")[1];var a=0,u="https";return i.__isLocalhost(s)&&(u="http"),setTimeout(o,0)},a.prototype.lookupLink=function(e,t,r){return c.hasOwnProperty(t)?void this.lookup(e,function(e,n){var o=n.idx.links[t];return e?r(e):0===o.length?r('no links found with rel="'+t+'"'):r(null,o[0])}):r("unsupported rel "+t)},n=[],o=function(){return a}.apply(t,n),!(void 0!==o&&(e.exports=o))}(this)},function(t,r){t.exports=e},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(){var e=this;this.featuresDone=0,this.features=[],this.readyFired=!1,this.featureModules={WireClient:r(17),Dropbox:r(9),GoogleDrive:r(24),Access:r(30),Discover:r(25),Authorize:r(10),BaseClient:r(11),Env:r(23)},w.cache&&g.extend(this.featureModules,{Caching:r(31),IndexedDB:r(32),LocalStorage:r(34),InMemoryStorage:r(35),Sync:r(22)}),w.disableFeatures.forEach(function(t){e.featureModules[t]&&delete e.featureModules[t]}),this._allLoaded=!1;for(var t in this.featureModules)this.loadFeature(t)}function i(e){for(var t=this.features.length-1;t>=0;t--)if(this.features[t].name===e)return this.features[t].supported;return!1}function s(e){var t=this,r=this.featureModules[e],n=!r._rs_supported||r._rs_supported();_("[RemoteStorage] [FEATURE "+e+"] initializing ..."),"object"===("undefined"==typeof n?"undefined":v(n))?n.then(function(){t.featureSupported(e,!0),t.initFeature(e)},function(){t.featureSupported(e,!1)}):"boolean"==typeof n?(this.featureSupported(e,n),n&&this.initFeature(e)):this.featureSupported(e,!1)}function a(e){var t=this,r=this.featureModules[e],n=void 0;try{n=r._rs_init(this)}catch(t){return void this.featureFailed(e,t)}"object"===("undefined"==typeof n?"undefined":v(n))&&"function"==typeof n.then?n.then(function(){t.featureInitialized(e)},function(r){t.featureFailed(e,r)}):this.featureInitialized(e)}function u(e,t){_("[RemoteStorage] [FEATURE "+e+"] initialization failed ("+t+")"),this.featureDone()}function c(e,t){_("[RemoteStorage] [FEATURE "+e+"]  "+(t?"":" not")+" supported"),t||this.featureDone()}function l(e){_("[RemoteStorage] [FEATURE "+e+"] initialized."),this.features.push({name:e,init:this.featureModules[e]._rs_init,supported:!0,cleanup:this.featureModules[e]._rs_cleanup}),this.featureDone()}function h(){this.featuresDone++,this.featuresDone===Object.keys(this.featureModules).length&&setTimeout(this.featuresLoaded.bind(this),0)}function f(){var e=this,t=["IndexedDB","LocalStorage","InMemoryStorage"];t.some(function(t){if(e.features.some(function(e){return e.name===t}))return e.features.local=e.featureModules[t],!0})}function p(){try{this.readyFired||(this._emit("ready"),this.readyFired=!0)}catch(e){console.error("'ready' failed: ",e,e.stack),this._emit("error",e)}}function d(){var e=this;_("[REMOTESTORAGE] All features loaded !"),this._setCachingModule(),this.local=w.cache&&this.features.local&&new this.features.local,this.local&&this.remote?(this._setGPD(b,this),this._bindChange(this.local)):this.remote&&this._setGPD(this.remote,this.remote),this.remote&&(this.remote.on("connected",function(){e._fireReady(),e._emit("connected")}),this.remote.on("not-connected",function(){e._fireReady(),e._emit("not-connected")}),this.remote.connected&&(this._fireReady(),this._emit("connected")),this.hasFeature("Authorize")||this.remote.stopWaitingForToken()),this._collectCleanupFunctions();try{this._allLoaded=!0,this._emit("features-loaded")}catch(e){g.logError(e),this._emit("error",e)}this._processPending()}function m(){this._cleanups=[];for(var e=0;e<this.features.length;e++){var t=this.features[e].cleanup;"function"==typeof t&&this._cleanups.push(t)}}var y,v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=r(5),_=r(7),b=r(29),w=r(8),E=[],P=0;e.exports=(y={features:E,loadFeature:s,initFeature:a,loadFeatures:o,featureSupported:c,featuresDone:P,featureDone:h,featuresLoaded:d,featureInitialized:l,featureFailed:u},n(y,"featureSupported",c),n(y,"hasFeature",i),n(y,"_setCachingModule",f),n(y,"_collectCleanupFunctions",m),n(y,"_fireReady",p),y)},function(e,t,r){"use strict";function n(e){return"dropbox"===this.backend&&e.match(/^\/public\/.*[^\/]$/)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(7),s={get:function(e,t){if(this.local){void 0===t&&("object"===o(this.remote)&&this.remote.connected&&this.remote.online?t=2*this.getSyncInterval():(i("Not setting default maxAge, because remote is offline or not connected"),t=!1));var r=function(e){return e!==!1&&"number"!=typeof e};return r(t)?Promise.reject("Argument 'maxAge' must be false or a number"):this.local.get(e,t,this.sync.queueGetRequest.bind(this.sync))}return this.remote.get(e)},put:function(e,t,r){return n.bind(this)(e)?s._wrapBusyDone.call(this,this.remote.put(e,t,r)):this.local?this.local.put(e,t,r):s._wrapBusyDone.call(this,this.remote.put(e,t,r))},delete:function(e){return this.local?this.local.delete(e):s._wrapBusyDone.call(this,this.remote.delete(e))},_wrapBusyDone:function(e){var t=this;return this._emit("wire-busy"),e.then(function(e){return t._emit("wire-done",{success:!0}),Promise.resolve(e)},function(e){return t._emit("wire-done",{success:!1}),Promise.reject(e)})}};e.exports=s},function(e,t){"use strict";var r=function(){this.reset()};r.prototype={claim:function(e,t){if("string"!=typeof e||e.indexOf("/")!==-1||0===e.length)throw new Error("Scope should be a non-empty string without forward slashes");if(!t.match(/^rw?$/))throw new Error("Mode should be either 'r' or 'rw'");this._adjustRootPaths(e),this.scopeModeMap[e]=t},get:function(e){return this.scopeModeMap[e]},remove:function(e){var t,r={};for(t in this.scopeModeMap)r[t]=this.scopeModeMap[t];this.reset(),delete r[e];for(t in r)this.set(t,r[t])},checkPermission:function(e,t){var r=this.get(e);return r&&("r"===t||"rw"===r)},checkPathPermission:function(e,t){return!!this.checkPermission("*",t)||!!this.checkPermission(this._getModuleName(e),t)},reset:function(){this.rootPaths=[],this.scopeModeMap={}},_getModuleName:function(e){if("/"!==e[0])throw new Error("Path should start with a slash");var t=e.replace(/^\/public/,"").match(/^\/([^\/]*)\//);return t?t[1]:"*"},_adjustRootPaths:function(e){"*"in this.scopeModeMap||"*"===e?this.rootPaths=["/"]:e in this.scopeModeMap||(this.rootPaths.push("/"+e+"/"),this.rootPaths.push("/public/"+e+"/"))},_scopeNameForParameter:function(e){if("*"===e.name&&this.storageType){if("2012.04"===this.storageType)return"";if(this.storageType.match(/remotestorage-0[01]/))return"root"}return e.name},setStorageType:function(e){this.storageType=e}},Object.defineProperty(r.prototype,"scopes",{get:function(){return Object.keys(this.scopeModeMap).map(function(e){return{name:e,mode:this.scopeModeMap[e]}}.bind(this))}}),Object.defineProperty(r.prototype,"scopeParameter",{get:function(){return this.scopes.map(function(e){return this._scopeNameForParameter(e)+":"+e.mode}.bind(this)).join(" ")}}),r._rs_init=function(){},e.exports=r},function(e,t,r){"use strict";var n=r(5),o=r(7),i=n.containingFolder,s=function(){this.reset()};s.prototype={pendingActivations:[],set:function(e,t){if("string"!=typeof e)throw new Error("path should be a string");if(!n.isFolder(e))throw new Error("path should be a folder");if(this._remoteStorage&&this._remoteStorage.access&&!this._remoteStorage.access.checkPathPermission(e,"r"))throw new Error('No access to path "'+e+'". You have to claim access to it first.');if(!t.match(/^(FLUSH|SEEN|ALL)$/))throw new Error("strategy should be 'FLUSH', 'SEEN', or 'ALL'");this._rootPaths[e]=t,"ALL"===t&&(this.activateHandler?this.activateHandler(e):this.pendingActivations.push(e))},enable:function(e){this.set(e,"ALL")},disable:function(e){this.set(e,"FLUSH")},onActivate:function(e){var t;for(o("[Caching] Setting activate handler",e,this.pendingActivations),this.activateHandler=e,t=0;t<this.pendingActivations.length;t++)e(this.pendingActivations[t]);delete this.pendingActivations},checkPath:function(e){return void 0!==this._rootPaths[e]?this._rootPaths[e]:"/"===e?"SEEN":this.checkPath(i(e))},reset:function(){this._rootPaths={},this._remoteStorage=null}},s._rs_init=function(e){this._remoteStorage=e},e.exports=s},function(e,t,r){"use strict";var n,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(7),s=r(33),a=r(6),u=r(5),c=2,l="remotestorage",h=function(e){return this.db=e||n,this.db?(s(this),a(this,"change","local-events-done"),this.getsRunning=0,this.putsRunning=0,this.changesQueued={},void(this.changesRunning={})):void i("[IndexedDB] Failed to open DB")};h.prototype={getNodes:function(e){for(var t=[],r={},n=0,o=e.length;n<o;n++)void 0!==this.changesQueued[e[n]]?r[e[n]]=u.deepClone(this.changesQueued[e[n]]||void 0):void 0!==this.changesRunning[e[n]]?r[e[n]]=u.deepClone(this.changesRunning[e[n]]||void 0):t.push(e[n]);return t.length>0?this.getNodesFromDb(t).then(function(e){for(var t in r)e[t]=r[t];return e}):Promise.resolve(r)},setNodes:function(e){for(var t in e)this.changesQueued[t]=e[t]||!1;return this.maybeFlush(),Promise.resolve()},maybeFlush:function(){0===this.putsRunning?this.flushChangesQueued():this.commitSlownessWarning||(this.commitSlownessWarning=setInterval(function(){console.log("WARNING: waited more than 10 seconds for previous commit to finish")},1e4))},flushChangesQueued:function(){this.commitSlownessWarning&&(clearInterval(this.commitSlownessWarning),this.commitSlownessWarning=null),Object.keys(this.changesQueued).length>0&&(this.changesRunning=this.changesQueued,this.changesQueued={},this.setNodesInDb(this.changesRunning).then(this.flushChangesQueued.bind(this)))},getNodesFromDb:function(e){var t=Promise.defer(),r=this.db.transaction(["nodes"],"readonly"),n=r.objectStore("nodes"),o={};(new Date).getTime();return this.getsRunning++,e.map(function(e,t){n.get(e).onsuccess=function(t){o[e]=t.target.result}}),r.oncomplete=function(){t.resolve(o),this.getsRunning--}.bind(this),r.onerror=r.onabort=function(){t.reject("get transaction error/abort"),this.getsRunning--}.bind(this),t.promise},setNodesInDb:function(e){var t=Promise.defer(),r=this.db.transaction(["nodes"],"readwrite"),n=r.objectStore("nodes"),s=(new Date).getTime();this.putsRunning++,i("[IndexedDB] Starting put",e,this.putsRunning);for(var a in e){var u=e[a];if("object"===("undefined"==typeof u?"undefined":o(u)))try{n.put(u)}catch(e){throw i("[IndexedDB] Error while putting",u,e),e}else try{n.delete(a)}catch(e){throw i("[IndexedDB] Error while removing",n,u,e),e}}return r.oncomplete=function(){this.putsRunning--,i("[IndexedDB] Finished put",e,this.putsRunning,(new Date).getTime()-s+"ms"),t.resolve()}.bind(this),r.onerror=function(){this.putsRunning--,t.reject("transaction error")}.bind(this),r.onabort=function(){t.reject("transaction abort"),this.putsRunning--}.bind(this),t.promise},reset:function(e){var t=this.db.name,r=this;this.db.close(),h.clean(this.db.name,function(){h.open(t,function(t,n){t?i("[IndexedDB] Error while resetting local storage",t):r.db=n,"function"==typeof e&&e(r)})})},forAllNodes:function(e){var t=Promise.defer(),r=this.db.transaction(["nodes"],"readonly"),n=r.objectStore("nodes").openCursor();return n.onsuccess=function(r){var n=r.target.result;n?(e(this.migrate(n.value)),n.continue()):t.resolve()}.bind(this),t.promise},closeDB:function(){this.db.close()}},h.open=function(e,t){var r=setTimeout(function(){t("timeout trying to open db")},1e4);try{var n=indexedDB.open(e,c);n.onerror=function(){i("[IndexedDB] Opening DB failed",n),clearTimeout(r),t(n.error)},n.onupgradeneeded=function(e){var t=n.result;i("[IndexedDB] Upgrade: from ",e.oldVersion," to ",e.newVersion),1!==e.oldVersion&&(i("[IndexedDB] Creating object store: nodes"),t.createObjectStore("nodes",{keyPath:"path"})),i("[IndexedDB] Creating object store: changes"),t.createObjectStore("changes",{keyPath:"path"})},n.onsuccess=function(){clearTimeout(r);var o=n.result;return o.objectStoreNames.contains("nodes")&&o.objectStoreNames.contains("changes")?void t(null,n.result):(i("[IndexedDB] Missing object store. Resetting the database."),void h.clean(e,function(){h.open(e,t)}))}}catch(n){i("[IndexedDB] Failed to open database: "+n),i("[IndexedDB] Resetting database and trying again."),clearTimeout(r),h.clean(e,function(){h.open(e,t)})}},h.clean=function(e,t){var r=indexedDB.deleteDatabase(e);r.onsuccess=function(){i("[IndexedDB] Done removing DB"),t()},r.onerror=r.onabort=function(t){console.error('Failed to remove database "'+e+'"',t)}},h._rs_init=function(e){var t=Promise.defer();return h.open(l,function(r,o){r?t.reject(r):(n=o,o.onerror=function(){e._emit("error",r)},t.resolve())}),t.promise},h._rs_supported=function(){var e=Promise.defer(),t=u.getGlobalContext(),r=!1;if("undefined"!=typeof navigator&&navigator.userAgent.match(/Android (2|3|4\.[0-3])/)&&(navigator.userAgent.match(/Chrome|Firefox/)||(r=!0)),"indexedDB"in t&&!r)try{var n=indexedDB.open("rs-check");n.onerror=function(t){e.reject()},n.onsuccess=function(t){n.result.close(),indexedDB.deleteDatabase("rs-check"),e.resolve()}}catch(t){e.reject()}else e.reject();return e.promise},h._rs_cleanup=function(e){var t=Promise.defer();return e.local&&e.local.closeDB(),h.clean(l,function(){t.resolve()}),t.promise},e.exports=h},function(e,t,r){"use strict";function n(e){if("object"===("undefined"==typeof e?"undefined":a(e))&&"string"==typeof e.path)if(l(e.path)){if(e.local&&e.local.itemsMap)return e.local;if(e.common&&e.common.itemsMap)return e.common}else{if(e.local&&e.local.body&&e.local.contentType)return e.local;if(e.common&&e.common.body&&e.common.contentType)return e.common;if(e.body&&e.contentType)return{body:e.body,contentType:e.contentType}}}function o(e,t){var r;for(r in e){if(e[r]&&e[r].remote)return!0;var o=n(e[r]);if(o&&o.timestamp&&(new Date).getTime()-o.timestamp<=t)return!1;if(!o)return!0}return!0}function i(e){var t={path:e,common:{}};return l(e)&&(t.common.itemsMap={}),t}function s(e,t){return e.common||(e.common={itemsMap:{}}),e.common.itemsMap||(e.common.itemsMap={}),e.local||(e.local=f(e.common)),e.local.itemsMap||(e.local.itemsMap=e.common.itemsMap),e.local.itemsMap[t]=!0,e}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=r(5),c=r(8),l=u.isFolder,h=u.isDocument,f=u.deepClone,p=(u.equal,u.pathsFromRoot),d={get:function(e,t,r){var i=this;return"number"==typeof t?i.getNodes(p(e)).then(function(i){var s=n(i[e]);return o(i,t)?r(e):s?{statusCode:200,body:s.body||s.itemsMap,contentType:s.contentType}:{statusCode:404}}):i.getNodes([e]).then(function(t){var r=n(t[e]);if(r){if(l(e))for(var o in r.itemsMap)r.itemsMap.hasOwnProperty(o)&&r.itemsMap[o]===!1&&delete r.itemsMap[o];return{statusCode:200,body:r.body||r.itemsMap,contentType:r.contentType}}return{statusCode:404}})},put:function(e,t,r){function o(e,o){try{for(var a=0,u=e.length;a<u;a++){var c,l=e[a],h=o[l];if(h||(o[l]=h=i(l)),0===a)c=n(h),h.local={body:t,contentType:r,previousBody:c?c.body:void 0,previousContentType:c?c.contentType:void 0};else{var f=e[a-1].substring(l.length);h=s(h,f)}}return o}catch(e){throw log("[Cachinglayer] Error during PUT",o,a,e),e}}var a=p(e);return this._updateNodes(a,o)},delete:function(e){var t=p(e);return this._updateNodes(t,function(e,t){for(var r=0,o=e.length;r<o;r++){var i=e[r],s=t[i];if(!s)throw new Error("Cannot delete non-existing node "+i);if(0===r)previous=n(s),s.local={body:!1,previousBody:previous?previous.body:void 0,previousContentType:previous?previous.contentType:void 0};else{s.local||(s.local=f(s.common));var a=e[r-1].substring(i.length);if(delete s.local.itemsMap[a],Object.getOwnPropertyNames(s.local.itemsMap).length>0)break}}return t})},flush:function(e){var t=this;return t._getAllDescendentPaths(e).then(function(e){return t.getNodes(e)}).then(function(e){for(var r in e){var n=e[r];n&&n.common&&n.local&&t._emitChange({path:n.path,origin:"local",oldValue:n.local.body===!1?void 0:n.local.body,newValue:n.common.body===!1?void 0:n.common.body}),e[r]=void 0}return t.setNodes(e)})},_emitChange:function(e){c.changeEvents[e.origin]&&this._emit("change",e)},fireInitial:function(){if(c.changeEvents.local){var e=this;e.forAllNodes(function(t){var r;h(t.path)&&(r=n(t),r&&e._emitChange({path:t.path,origin:"local",oldValue:void 0,oldContentType:void 0,newValue:r.body,newContentType:r.contentType}))}).then(function(){e._emit("local-events-done")})}},onDiff:function(e){this.diffHandler=e},migrate:function(e){return"object"!==("undefined"==typeof e?"undefined":a(e))||e.common||(e.common={},"string"==typeof e.path?"/"===e.path.substr(-1)&&"object"===a(e.body)&&(e.common.itemsMap=e.body):(e.local||(e.local={}),e.local.body=e.body,e.local.contentType=e.contentType)),e},_updateNodesRunning:!1,_updateNodesQueued:[],_updateNodes:function(e,t){var r=Promise.defer();return this._doUpdateNodes(e,t,r),r.promise},_doUpdateNodes:function(e,t,r){var n=this;return n._updateNodesRunning?void n._updateNodesQueued.push({paths:e,cb:t,promise:r}):(n._updateNodesRunning=!0,void n.getNodes(e).then(function(o){var i,s=f(o),a=[],c=u.equal;o=t(e,o);for(var l in o)i=o[l],c(i,s[l])?delete o[l]:h(l)&&(c(i.local.body,i.local.previousBody)&&i.local.contentType===i.local.previousContentType||a.push({path:l,origin:"window",oldValue:i.local.previousBody,newValue:i.local.body===!1?void 0:i.local.body,oldContentType:i.local.previousContentType,newContentType:i.local.contentType}),delete i.local.previousBody,delete i.local.previousContentType);n.setNodes(o).then(function(){n._emitChangeEvents(a),r.resolve({statusCode:200})})}).then(function(){return Promise.resolve()},function(e){r.reject(e)}).then(function(){n._updateNodesRunning=!1;var e=n._updateNodesQueued.shift();e&&n._doUpdateNodes(e.paths,e.cb,e.promise)}))},_emitChangeEvents:function(e){for(var t=0,r=e.length;t<r;t++)this._emitChange(e[t]),this.diffHandler&&this.diffHandler(e[t].path)},_getAllDescendentPaths:function(e){var t=this;return l(e)?t.getNodes([e]).then(function(r){var o=[e],i=n(r[e]),s=Object.keys(i.itemsMap),a=s.map(function(r){return t._getAllDescendentPaths(e+r).then(function(e){for(var t=0,r=e.length;t<r;t++)o.push(e[t])})});return Promise.all(a).then(function(){return o})}):Promise.resolve([e])},_getInternals:function(){return{getLatest:n,makeNode:i,isOutdated:o}}},m=function(e){for(var t in d)e[t]=d[t]};e.exports=m},function(e,t,r){"use strict";function n(e){return e.substr(0,c.length)===c||e.substr(0,l.length)===l}function o(e){return e.substr(0,c.length)===c}var i=r(33),s=r(7),a=r(6),u=r(5),c="remotestorage:cache:nodes:",l="remotestorage:cache:changes:",h=function(){i(this),s("[LocalStorage] Registering events"),a(this,"change","local-events-done")};h.prototype={getNodes:function(e){for(var t={},r=0,n=e.length;r<n;r++)try{t[e[r]]=JSON.parse(localStorage[c+e[r]])}catch(n){t[e[r]]=void 0}return Promise.resolve(t)},setNodes:function(e){for(var t in e)localStorage[c+t]=JSON.stringify(e[t]);return Promise.resolve()},forAllNodes:function(e){for(var t,r=0,n=localStorage.length;r<n;r++)if(o(localStorage.key(r))){try{t=this.migrate(JSON.parse(localStorage[localStorage.key(r)]))}catch(e){t=void 0}t&&e(t)}return Promise.resolve()}},h._rs_init=function(){},h._rs_supported=function(){return u.localStorageAvailable()},h._rs_cleanup=function(){for(var e=[],t=0,r=localStorage.length;t<r;t++){var o=localStorage.key(t);n(o)&&e.push(o)}e.forEach(function(e){s("[LocalStorage] Removing",e),delete localStorage[e]})},e.exports=h},function(e,t,r){"use strict";var n=r(6),o=r(7),i=r(33),s=function(){i(this),o("[InMemoryStorage] Registering events"),n(this,"change","local-events-done"),this._storage={}};s.prototype={getNodes:function(e){for(var t={},r=0,n=e.length;r<n;r++)t[e[r]]=this._storage[e[r]];return Promise.resolve(t)},setNodes:function(e){for(var t in e)void 0===e[t]?delete this._storage[t]:this._storage[t]=e[t];return Promise.resolve()},forAllNodes:function(e){for(var t in this._storage)e(this.migrate(this._storage[t]));return Promise.resolve()}},s._rs_init=function(){},s._rs_supported=function(){return!0},s._rs_cleanup=function(){},e.exports=s},function(e,t,r){"use strict";var n=r(11),o=r(4);o.MODULES={},o.defineModule=function(e,t){if(o.MODULES[e]=t,Object.defineProperty(o.prototype,e,{configurable:!0,get:function(){var t=this._loadModule(e);return Object.defineProperty(this,e,{value:t}),t}}),e.indexOf("-")!==-1){var r=e.replace(/\-[a-z]/g,function(e){return e[1].toUpperCase()});Object.defineProperty(o.prototype,r,{get:function(){return this[e]}})}},o.prototype._loadModule=function(e){var t=o.MODULES[e];if(t){var r=t(new n(this,"/"+e+"/"),new n(this,"/public/"+e+"/"));return r.exports}throw"Unknown module: "+e},o.prototype.defineModule=function(e){console.log("remoteStorage.defineModule is deprecated, use RemoteStorage.defineModule instead!"),o.defineModule.apply(o,arguments)}}])});
//# sourceMappingURL=remotestorage.js.map
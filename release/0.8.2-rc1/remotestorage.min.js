/** remotestorage.js 0.8.2-rc1 remotestorage.io, MIT-licensed **/
/** remotestorage.js 0.8.2-rc1 remotestorage.io, MIT-licensed **//** FILE: lib/promising.js **/(function(e){function t(e){function o(e){if(i){var t;if(e.fulfilled)try{t=[e.fulfilled.apply(null,s)]}catch(n){e.promise.reject(n);return}else t=s;t[0]&&typeof t[0].then=="function"?t[0].then(e.promise.fulfill,e.promise.reject):e.promise.fulfill.apply(null,t)}else if(e.rejected){var r;try{r=e.rejected.apply(null,s)}catch(n){e.promise.reject(n);return}r&&typeof r.then=="function"?r.then(e.promise.fulfill,e.promise.reject):e.promise.fulfill(r)}else e.promise.reject.apply(null,s)}function u(e,t){if(s){console.error("WARNING: Can't resolve promise, already resolved!");return}i=e,s=Array.prototype.slice.call(t),setTimeout(function(){var e=r.length;e===0&&!i&&console.error("Possibly uncaught error: ",s,s[0]&&s[0].stack);for(var t=0;t<e;t++)o(r[t]);r=undefined},0)}var n;typeof e=="function"&&setTimeout(function(){try{e(n)}catch(t){n.reject(t)}},0);var r=[],i,s;return n={then:function(e,n){var i={fulfilled:typeof e=="function"?e:undefined,rejected:typeof n=="function"?n:undefined,promise:t()};return s?setTimeout(function(){o(i)},0):r.push(i),i.promise},fulfill:function(){return u(!0,arguments),this},reject:function(){return u(!1,arguments),this}},n}e.promising=t})(typeof window!="undefined"?window:global),function(e){function t(e){(e==403||e==401)&&this._emit("error",new i.Unauthorized);var t=promising();return t.fulfill.apply(t,arguments)}var n={get:function(e){return this.caching.cachePath(e)?this.local.get(e):this.remote.get(e)},put:function(e,t,r){return this.caching.cachePath(e)?this.local.put(e,t,r):n._wrapBusyDone.call(this,this.remote.put(e,t,r))},"delete":function(e){return this.caching.cachePath(e)?this.local.delete(e):n._wrapBusyDone.call(this,this.remote.delete(e))},_wrapBusyDone:function(e){return this._emit("sync-busy"),e.then(function(){var e=promising();return this._emit("sync-done"),e.fulfill.apply(e,arguments)}.bind(this),function(e){throw e})}},r="localStorage"in e,i=function(){i.eventHandling(this,"ready","disconnected","disconnect","conflict","error","features-loaded","connecting","authing","sync-busy","sync-done"),this._pending=[],this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),"delete":this._pendingGPD("delete")}),this._cleanups=[],this._pathHandlers={change:{},conflict:{}},this.apiKeys={};if(r){try{this.apiKeys=JSON.parse(localStorage["remotestorage:api-keys"])}catch(e){}this.setBackend(localStorage["remotestorage:backend"]||"remotestorage")}var t=this.on;this.on=function(e,n){return e=="ready"&&this.remote.connected&&this._allLoaded?setTimeout(n,0):e=="features-loaded"&&this._allLoaded&&setTimeout(n,0),t.call(this,e,n)},this._init(),this.on("ready",function(){this.local&&setTimeout(this.local.fireInitial.bind(this.local),0)}.bind(this))};i.DiscoveryError=function(e){Error.apply(this,arguments),this.message=e},i.DiscoveryError.prototype=Object.create(Error.prototype),i.Unauthorized=function(){Error.apply(this,arguments)},i.Unauthorized.prototype=Object.create(Error.prototype),i.log=function(){i._log&&console.log.apply(console,arguments)},i.prototype={connect:function(e){if(e.indexOf("@")<0){this._emit("error",new i.DiscoveryError("user adress doesn't contain an @"));return}this._emit("connecting"),this.remote.configure(e),i.Discover(e,function(t,n,r){if(!t){this._emit("error",new i.DiscoveryError("failed to contact storage server"));return}this._emit("authing"),this.remote.configure(e,t,n),this.remote.connected||this.authorize(r)}.bind(this))},disconnect:function(){this.remote&&this.remote.configure(null,null,null,null),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),"delete":this._pendingGPD("delete")});var e=this._cleanups.length,t=0,n=function(){t++,t==e&&(this._init(),this._emit("disconnected"),this._emit("disconnect"))}.bind(this);this._cleanups.forEach(function(e){var t=e(this);typeof e=="object"&&typeof e.then=="function"?t.then(n):n()}.bind(this))},setBackend:function(e){this.backend=e,r&&(e?localStorage["remotestorage:backend"]=e:delete localStorage["remotestorage:backend"])},onChange:function(e,t){this._pathHandlers.change[e]||(this._pathHandlers.change[e]=[]),this._pathHandlers.change[e].push(t)},onConflict:function(e,t){this._conflictBound||(this.on("features-loaded",function(){this.local&&this.local.on("conflict",this._dispatchEvent.bind(this,"conflict"))}.bind(this)),this._conflictBound=!0),this._pathHandlers.conflict[e]||(this._pathHandlers.conflict[e]=[]),this._pathHandlers.conflict[e].push(t)},enableLog:function(){i._log=!0},disableLog:function(){i._log=!1},log:function(){i.log.apply(i,arguments)},setApiKeys:function(e,t){t?this.apiKeys[e]=t:delete this.apiKeys[e],r&&(localStorage["remotestorage:api-keys"]=JSON.stringify(this.apiKeys))},_init:function(){this._loadFeatures(function(e){this.log("all features loaded"),this.local=e.local&&new e.local,this.local&&this.remote?(this._setGPD(n,this),this._bindChange(this.local)):this.remote&&this._setGPD(this.remote,this.remote);if(this.remote){this.remote.on("connected",function(){try{this._emit("ready")}catch(e){console.error("'ready' failed: ",e,e.stack),this._emit("error",e)}}.bind(this));if(this.remote.connected)try{this._emit("ready")}catch(t){console.error("'ready' failed: ",t,t.stack),this._emit("error",t)}}var r=e.length;for(var i=0;i<r;i++){var s=e[i].cleanup;s&&this._cleanups.push(s)}try{this._allLoaded=!0,this._emit("features-loaded")}catch(o){console.error("remoteStorage#ready block failed: "),typeof o=="string"?console.error(o):console.error(o.message,o.stack),this._emit("error",o)}this._processPending()})},_detectFeatures:function(){var e=["WireClient","Dropbox","GoogleDrive","Access","Caching","Discover","Authorize","Widget","IndexedDB","LocalStorage","Sync","BaseClient"].map(function(e){var t=i[e];return{name:e,init:t&&t._rs_init,supported:t&&(t._rs_supported?t._rs_supported():!0),cleanup:t&&t._rs_cleanup}}).filter(function(e){var t=!!e.init&&!!e.supported;return this.log("[FEATURE "+e.name+"] "+(t?"":"not ")+"supported."),t}.bind(this));return e.forEach(function(t){t.name=="IndexedDB"?e.local=i.IndexedDB:t.name=="LocalStorage"&&!e.local&&(e.local=i.LocalStorage)}),e.caching=!!i.Caching,e.sync=!!i.Sync,this.features=e,e},_loadFeatures:function(e){function s(s){return function(){r++,i.log("[FEATURE "+s+"] initialized. ("+r+"/"+n+")"),r==n&&setTimeout(function(){e.apply(i,[t])},0)}}var t=this._detectFeatures(),n=t.length,r=0,i=this;t.forEach(function(e){i.log("[FEATURE "+e.name+"] initializing...");var t=e.init(i),n=s(e.name);typeof t=="object"&&typeof t.then=="function"?t.then(n):n()}),t.length==0&&(i.log("[NO FEATURES DETECTED] done"),e.apply(i,[[]]))},_setGPD:function(e,n){function r(e){return function(){return e.apply(n,arguments).then(t.bind(this))}}this.get=r(e.get),this.put=r(e.put),this.delete=r(e.delete)},_pendingGPD:function(e){return function(){var t=promising();return this._pending.push({method:e,args:Array.prototype.slice.call(arguments),promise:t}),t}.bind(this)},_processPending:function(){this._pending.forEach(function(e){try{this[e.method].apply(this,e.args).then(e.promise.fulfill,e.promise.reject)}catch(t){e.promise.reject(t)}}.bind(this)),this._pending=[]},_bindChange:function(e){e.on("change",this._dispatchEvent.bind(this,"change"))},_dispatchEvent:function(e,t){for(var n in this._pathHandlers[e]){var r=n.length;this._pathHandlers[e][n].forEach(function(e){if(t.path.substr(0,r)==n){var i={};for(var s in t)i[s]=t[s];i.relativePath=t.path.replace(new RegExp("^"+n),"");try{e(i)}catch(o){console.error("'change' handler failed: ",o,o.stack),this._emit("error",o)}}}.bind(this))}}},Object.defineProperty(i.prototype,"connected",{get:function(){return this.remote.connected}}),e.RemoteStorage=i}(typeof window!="undefined"?window:global),function(e){var t={addEventListener:function(e,t){this._validateEvent(e),this._handlers[e].push(t)},removeEventListener:function(e,t){this._validateEvent(e);var n=this._handlers[e].length;for(var r=0;r<n;r++)if(this._handlers[e][r]===t){this._handlers[e].splice(r,1);return}},_emit:function(e){this._validateEvent(e);var t=Array.prototype.slice.call(arguments,1);this._handlers[e].forEach(function(e){e.apply(this,t)})},_validateEvent:function(e){if(!(e in this._handlers))throw new Error("Unknown event: "+e)},_delegateEvent:function(e,t){t.on(e,function(t){this._emit(e,t)}.bind(this))},_addEvent:function(e){this._handlers[e]=[]}};t.on=t.addEventListener,RemoteStorage.eventHandling=function(e){var n=Array.prototype.slice.call(arguments,1);for(var r in t)e[r]=t[r];e._handlers={},n.forEach(function(t){e._addEvent(t)})}}(typeof window!="undefined"?window:global),function(e){function c(e,n,r,i,s,o,u){if(e!="PUT"&&e!="DELETE"||n[n.length-1]!="/"){var a=promising();return i.Authorization="Bearer "+r,t.WireClient.request(e,n,{body:s,headers:i},function(e,t){if(e)a.reject(e);else if(t.status==404)a.fulfill(404);else{var n=t.getResponseHeader("Content-Type"),r,i=o?t.getResponseHeader("ETag"):t.status==200?u:undefined;if(!n||n.match(/charset=binary/)){var s=new Blob([t.response],{type:n}),f=new FileReader;f.addEventListener("loadend",function(){a.fulfill(t.status,f.result,n,i)}),f.readAsArrayBuffer(s)}else r=n&&n.match(/^application\/json/)?JSON.parse(t.responseText):t.responseText,a.fulfill(t.status,r,n,i)}}),a}throw"Don't "+e+" on directories!"}function h(e){return e.replace(/\/+/g,"/").split("/").map(encodeURIComponent).join("/")}var t=RemoteStorage,n,r="remotestorage:wireclient",i=1,s=2,o=3,u=4,a={"draft-dejong-remotestorage-00":s,"draft-dejong-remotestorage-01":o,"https://www.w3.org/community/rww/wiki/read-write-web-00#simple":i},f;if(typeof ArrayBufferView=="function")f=function(e){return e&&e instanceof ArrayBufferView};else{var l=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];f=function(e){for(var t=0;t<8;t++)if(e instanceof l[t])return!0;return!1}}t.WireClient=function(e){this.connected=!1,t.eventHandling(this,"change","connected"),e.on("error",function(e){e instanceof RemoteStorage.Unauthorized&&this.configure(undefined,undefined,undefined,null)}.bind(this));if(n){var i;try{i=JSON.parse(localStorage[r])}catch(s){}i&&setTimeout(function(){this.configure(i.userAddress,i.href,i.storageApi,i.token)}.bind(this),0)}this._revisionCache={},this.connected&&setTimeout(this._emit.bind(this),0,"connected")},t.WireClient.REQUEST_TIMEOUT=3e4,t.WireClient.prototype={configure:function(e,i,o,f){typeof e!="undefined"&&(this.userAddress=e),typeof i!="undefined"&&(this.href=i),typeof o!="undefined"&&(this.storageApi=o),typeof f!="undefined"&&(this.token=f),typeof this.storageApi!="undefined"&&(this._storageApi=a[this.storageApi]||u,this.supportsRevs=this._storageApi>=s),this.href&&this.token?(this.connected=!0,this._emit("connected")):this.connected=!1,n&&(localStorage[r]=JSON.stringify({userAddress:this.userAddress,href:this.href,token:this.token,storageApi:this.storageApi})),console.log("calling "+t.WireClient.configureHooks.length+" hooks"),t.WireClient.configureHooks.forEach(function(e){e.call(this)}.bind(this))},get:function(e,t){if(!this.connected)throw new Error("not connected (path: "+e+")");t||(t={});var n={};if(this.supportsRevs)n["If-None-Match"]=t.ifNoneMatch||"";else if(t.ifNoneMatch){var r=this._revisionCache[e];r===t.ifNoneMatch}var i=c("GET",this.href+h(e),this.token,n,undefined,this.supportsRevs,this._revisionCache[e]);return this.supportsRevs||e.substr(-1)!="/"?i:i.then(function(t,n,r,i){if(t==200&&typeof n=="object")if(Object.keys(n).length===0)t=404;else for(var s in n)this._revisionCache[e+s]=n[s];return promising().fulfill(t,n,r,i)}.bind(this))},put:function(e,t,n,r){if(!this.connected)throw new Error("not connected (path: "+e+")");r||(r={}),n.match(/charset=/)||(n+="; charset="+(t instanceof ArrayBuffer||f(t)?"binary":"utf-8"));var i={"Content-Type":n};return this.supportsRevs&&(i["If-Match"]=r.ifMatch,i["If-None-Match"]=r.ifNoneMatch),c("PUT",this.href+h(e),this.token,i,t,this.supportsRevs)},"delete":function(e,t){if(!this.connected)throw new Error("not connected (path: "+e+")");return t||(t={}),c("DELETE",this.href+h(e),this.token,this.supportsRevs?{"If-Match":t.ifMatch}:{},undefined,this.supportsRevs)}},t.WireClient.isArrayBufferView=f,t.WireClient.request=function(e,n,r,i){RemoteStorage.log(e,n),i=i.bind(this);var s=!1,o=setTimeout(function(){s=!0,i("timeout")},t.WireClient.REQUEST_TIMEOUT),u=new XMLHttpRequest;u.open(e,n,!0),r.responseType&&(u.responseType=r.responseType);if(r.headers)for(var a in r.headers)u.setRequestHeader(a,r.headers[a]);u.onload=function(){if(s)return;clearTimeout(o),i(null,u)},u.onerror=function(e){if(s)return;clearTimeout(o),i(e)};var l=r.body;typeof l=="object"&&(f(l)||(l instanceof ArrayBuffer?l=new Uint8Array(l):l=JSON.stringify(l))),u.send(l)},t.WireClient.configureHooks=[],t.WireClient._rs_init=function(e){e.remote=new t.WireClient(e)},t.WireClient._rs_supported=function(){return n="localStorage"in e,!!e.XMLHttpRequest},t.WireClient._rs_cleanup=function(){n&&delete localStorage[r]}}(typeof window!="undefined"?window:global),function(e){var t,n,r="remotestorage:discover",i={};RemoteStorage.Discover=function(e,t){function f(){var s=new XMLHttpRequest,o=a.shift();if(!o)return t();RemoteStorage.log("try url",o),s.open("GET",o,!0),s.onabort=s.onerror=function(){console.error("webfinger error",arguments,"(",o,")"),f()},s.onload=function(){if(s.status!=200)return f();var o;try{o=JSON.parse(s.responseText)}catch(u){RemoteStorage.log("Failed to parse profile ",s.responseText,u),f();return}if(!o.links){RemoteStorage.log("profile has no links section ",JSON.stringify(o)),f();return}var a;o.links.forEach(function(e){e.rel=="remotestorage"?a=e:e.rel=="remoteStorage"&&!a&&(a=e)}),RemoteStorage.log("got profile",o,"and link",a);if(a){var l=a.properties["auth-endpoint"]||a.properties["http://tools.ietf.org/html/rfc6749#section-4.2"];i[e]={href:a.href,type:a.type,authURL:l},n&&(localStorage[r]=JSON.stringify({cache:i})),t(a.href,a.type,l)}else f()},s.send()}if(e in i){var s=i[e];t(s.href,s.type,s.authURL);return}var o=e.split("@")[1],u="?resource="+encodeURIComponent("acct:"+e),a=["https://"+o+"/.well-known/webfinger"+u,"https://"+o+"/.well-known/host-meta.json"+u,"http://"+o+"/.well-known/webfinger"+u,"http://"+o+"/.well-known/host-meta.json"+u];f()},RemoteStorage.Discover._rs_init=function(e){if(n){var t;try{t=JSON.parse(localStorage[r])}catch(s){}t&&(i=t.cache)}},RemoteStorage.Discover._rs_supported=function(){return n=!!e.localStorage,t=!!e.XMLHttpRequest,t},RemoteStorage.Discover._rs_cleanup=function(){n&&delete localStorage[r]}}(typeof window!="undefined"?window:global),function(){function e(){var e=document.location.href.indexOf("#");if(e==-1)return;var t=document.location.href.substring(e+1);return t.split("&").reduce(function(e,t){var n=t.split("=");return e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]),e},{})}RemoteStorage.Authorize=function(e,t,n,r){RemoteStorage.log("Authorize authURL = ",e);var i=e;i+=e.indexOf("?")>0?"&":"?",i+="redirect_uri="+encodeURIComponent(n.replace(/#.*$/,"")),i+="&scope="+encodeURIComponent(t),i+="&client_id="+encodeURIComponent(r),i+="&response_type=token",document.location=i},RemoteStorage.prototype.authorize=function(e){var t=this.access.scopeModeMap,n=[];for(var r in t){var i=t[r];r=="root"&&(this.remote.storageApi.match(/^draft-dejong-remotestorage-/)||(r="")),n.push(r+":"+i)}n=n.join(" ");var s=String(document.location),o=s.match(/^(https?:\/\/[^\/]+)/)[0];RemoteStorage.Authorize(e,n,s,o)},RemoteStorage.Authorize._rs_supported=function(e){return typeof document!="undefined"},RemoteStorage.Authorize._rs_init=function(t){var n=e();n&&(document.location.hash=""),t.on("features-loaded",function(){if(n){if(n.error)throw"Authorization server errored: "+n.error;n.access_token&&t.remote.configure(undefined,undefined,undefined,n.access_token),n.remotestorage&&t.connect(n.remotestorage)}})}}(),function(e){function r(e,t){t=="root"||t===""?e.caching.set("/",{data:!0}):(e.caching.set("/"+t+"/",{data:!0}),e.caching.set("/public/"+t+"/",{data:!0}))}var t="localStorage"in e,n="remotestorage:access";RemoteStorage.Access=function(){this.reset();if(t){var e=localStorage[n];if(e){var r=JSON.parse(e);for(var i in r)this.set(i,r[i])}}},RemoteStorage.Access.prototype={claim:function(){this.set.apply(this,arguments)},set:function(e,t){this._adjustRootPaths(e),this.scopeModeMap[e]=t,this._persist()},get:function(e){return this.scopeModeMap[e]},remove:function(e){var t={};for(var n in this.scopeModeMap)t[n]=this.scopeModeMap[n];this.reset(),delete t[e];for(var n in t)this.set(n,t[n]);this._persist()},check:function(e,t){var n=this.get(e);return n&&(t==="r"||n==="rw")},reset:function(){this.rootPaths=[],this.scopeModeMap={}},_adjustRootPaths:function(e){"root"in this.scopeModeMap||e==="root"?this.rootPaths=["/"]:e in this.scopeModeMap||(this.rootPaths.push("/"+e+"/"),this.rootPaths.push("/public/"+e+"/"))},_persist:function(){t&&(localStorage[n]=JSON.stringify(this.scopeModeMap))},setStorageType:function(e){this.storageType=e}},Object.defineProperty(RemoteStorage.Access.prototype,"scopes",{get:function(){return Object.keys(this.scopeModeMap).map(function(e){return{name:e,mode:this.scopeModeMap[e]}}.bind(this))}}),Object.defineProperty(RemoteStorage.Access.prototype,"scopeParameter",{get:function(){return this.scopes.map(function(e){return(e.name==="root"&&this.storageType==="2012.04"?"":e.name)+":"+e.mode}.bind(this)).join(" ")}}),Object.defineProperty(RemoteStorage.prototype,"access",{get:function(){var e=new RemoteStorage.Access;return Object.defineProperty(this,"access",{value:e}),e},configurable:!0}),RemoteStorage.prototype.claimAccess=function(e){if(typeof e=="object")for(var t in e)this.access.claim(t,e[t]);else this.access.claim(arguments[0],arguments[1])},RemoteStorage.Access._rs_init=function(){}}(typeof window!="undefined"?window:global),RemoteStorage.Assets={connectIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMTAzNi40KSI+CiAgPHBhdGggZD0ibTEgMTA0Ny40di02aDd2LTRsNyA3LTcgN3YtNHoiIGZpbGw9IiNmZmYiLz4KIDwvZz4KPC9zdmc+Cg==",disconnectIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIgdmVyc2lvbj0iMS4wIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxwYXRoIHN0eWxlPSJibG9jay1wcm9ncmVzc2lvbjp0Yjt0ZXh0LWluZGVudDowO2NvbG9yOiMwMDAwMDA7dGV4dC10cmFuc2Zvcm06bm9uZSIgZD0ibTguMDAwMSAwYy0wLjQ3MTQgMC0wLjk2MTAzIDAuNTQxOS0wLjk1IDF2NmMtMC4wMDc0NyAwLjUyODMxIDAuNDIxNjMgMSAwLjk1IDFzMC45NTc0Ny0wLjQ3MTY5IDAuOTUtMXYtNmMwLjAxNDYyMi0wLjYwNTEtMC40Nzg2LTEtMC45NS0xem0tMy4zNDM4IDIuNWMtMC4wODcxODYgMC4wMTkyOTQtMC4xNzE2MyAwLjA1MDk1OS0wLjI1IDAuMDkzNzUtMi45OTk1IDEuNTcxNS0zLjkxODQgNC43OTc5LTMuMTI1IDcuNDY4OCAwLjc5MzQgMi42NyAzLjI3OTkgNC45MzcgNi42ODc1IDQuOTM3IDMuMzU5MiAwIDUuODc3Mi0yLjE0OSA2LjcxOTItNC43ODEgMC44NDEtMi42MzIxLTAuMDU4LTUuODIzNC0zLjEyNS03LjU5NC0wLjQzNC0wLjI1MzYtMS4wNTktMC4wODk5LTEuMzEzIDAuMzQzNy0wLjI1MzYgMC40MzM2LTAuMDkgMS4wNTg5IDAuMzQ0IDEuMzEyNSAyLjM5MDggMS4zNzk4IDIuODgyNSAzLjQ5NDQgMi4yODEyIDUuMzc1LTAuNjAxMiAxLjg4MDYtMi4zNDQgMy40Mzc1LTQuOTA2MiAzLjQzNzUtMi41NzU5IDAtNC4yOTc2LTEuNjUwMi00Ljg3NS0zLjU5MzgtMC41Nzc2LTEuOTQzNS0wLjA0Ny00LjA0OCAyLjE4NzMtNS4yMTg3IDAuMzc4Ny0wLjIwNjMgMC41NzkxLTAuNjkyNSAwLjQ1NTgtMS4xMDU3LTAuMTIzMi0wLjQxMzMtMC41NTcyLTAuNzEwMy0wLjk4Ny0wLjY3NTUtMC4wMzEzLTAuMDAxNS0wLjA2MjYtMC4wMDE1LTAuMDkzOCAweiIgZmlsbD0iI2ZmZiIvPgo8L3N2Zz4K",dropbox:"data:image/png;base64,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",googledrive:"data:image/png;base64,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",remoteStorageIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iI2ZmNGEwNCIgc3RvcC1vcGFjaXR5PSIuNzYxNTQiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZmY0YTA0IiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",remoteStorageIconError:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iI2U5MDAwMCIgc3RvcC1vcGFjaXR5PSIuNzYwNzgiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZTkwMDAwIiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",remoteStorageIconOffline:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iIzY5Njk2OSIgc3RvcC1vcGFjaXR5PSIuNzYxNTQiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjNjc2NzY3IiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",syncIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDg3LjUgMTAwIiB4bWw6c3BhY2U9InByZXNlcnZlIiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTUuOTk5OTk5IDE2IiB3aWR0aD0iMTYiIHZlcnNpb249IjEuMSIgeT0iMHB4IiB4PSIwcHgiIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyI+CjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01LjUxMTIgLTc2LjUyNSkiIGRpc3BsYXk9Im5vbmUiPgoJPHBhdGggZGlzcGxheT0iaW5saW5lIiBkPSJtNTEuNDczIDQyLjI1NS0yLjIwNSAyLjIxMmMxLjQ3OCAxLjQ3NyAyLjI5NSAzLjQ0MiAyLjI5NSA1LjUzMyAwIDQuMzA5LTMuNTA0IDcuODEyLTcuODEyIDcuODEydi0xLjU2MmwtMy4xMjUgMy4xMjUgMy4xMjQgMy4xMjV2LTEuNTYyYzYuMDI5IDAgMTAuOTM4LTQuOTA2IDEwLjkzOC0xMC45MzggMC0yLjkyNy0xLjE0MS01LjY3Ni0zLjIxNS03Ljc0NXoiLz4KCTxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0ibTQ2Ljg3NSA0MC42MjUtMy4xMjUtMy4xMjV2MS41NjJjLTYuMDMgMC0xMC45MzggNC45MDctMTAuOTM4IDEwLjkzOCAwIDIuOTI3IDEuMTQxIDUuNjc2IDMuMjE3IDcuNzQ1bDIuMjAzLTIuMjEyYy0xLjQ3Ny0xLjQ3OS0yLjI5NC0zLjQ0Mi0yLjI5NC01LjUzMyAwLTQuMzA5IDMuNTA0LTcuODEyIDcuODEyLTcuODEydjEuNTYybDMuMTI1LTMuMTI1eiIvPgo8L2c+CjxwYXRoIGZpbGw9IiNmZmYiIGQ9Im0xMCAwbC0wLjc1IDEuOTA2MmMtMS4wMDc4LTAuMjk0Mi0zLjQ1ODYtMC43NzA4LTUuNjU2MiAwLjkzNzYgMC0wLjAwMDItMy45MzAyIDIuNTk0MS0yLjA5MzggNy41OTQybDEuNjU2Mi0wLjcxOTJzLTEuNTM5OS0zLjExMjIgMS42ODc2LTUuNTMxM2MwIDAgMS42OTU3LTEuMTMzOSAzLjY4NzQtMC41OTM3bC0wLjcxODcgMS44MTI0IDMuODEyNS0xLjYyNS0xLjYyNS0zLjc4MTJ6Ii8+PHBhdGggZmlsbD0iI2ZmZiIgZD0ibTE0IDUuNTYyNWwtMS42NTYgMC43MTg3czEuNTQxIDMuMTEzNS0xLjY4OCA1LjUzMDhjMCAwLTEuNzI3MiAxLjEzNS0zLjcxODUgMC41OTRsMC43NS0xLjgxMi0zLjgxMjUgMS41OTQgMS41OTM4IDMuODEyIDAuNzgxMi0xLjkwNmMxLjAxMTMgMC4yOTUgMy40NjE1IDAuNzY2IDUuNjU2LTAuOTM4IDAgMCAzLjkyOC0yLjU5NCAyLjA5NC03LjU5MzV6Ii8+Cjwvc3ZnPgo=",widget:' <div class="rs-bubble rs-hidden">   <div class="rs-bubble-text remotestorage-initial remotestorage-error remotestorage-authing remotestorage-offline">     <span class="rs-status-text">       Connect <strong>remote Storage</strong>     </span>   </div>   <div class="rs-bubble-expandable">     <!-- error -->     <div class="remotestorage-error">       <pre class="rs-status-text rs-error-msg">ERROR</pre>          <button class="remotestorage-reset">get me out of here</button>     <p class="rs-centered-text"> If this problem persists, please <a href="http://remotestorage.io/community/" target="_blank">let us know</a>!</p>     </div>     <!-- connected -->     <div class="rs-bubble-text remotestorage-connected">       <strong class="userAddress"> User Name </strong>       <span class="remotestorage-unauthorized">         <br/>Unauthorized! Click to reconnect.<br/>       </span>     </div>     <div class="content remotestorage-connected">       <button class="rs-sync" title="sync">  <img>  </button>       <button class="rs-disconnect" title="disconnect">  <img>  </button>     </div>     <!-- initial -->     <form novalidate class="remotestorage-initial">       <input  type="email" placeholder="user@host" name="userAddress" novalidate>       <button class="connect" name="connect" title="connect" disabled="disabled">         <img>       </button>     </form>     <div class="rs-info-msg remotestorage-initial">       This app allows you to use your own storage! Find more info on       <a href="http://remotestorage.io/" target="_blank">remotestorage.io</a>     </div>      </div> </div>  <img class="rs-dropbox rs-backends rs-action" alt="Connect to Dropbox"> <img class="rs-googledrive rs-backends rs-action" alt="Connect to Google Drive">  <img class="rs-cube rs-action"> ',widgetCss:'/** encoding:utf-8 **/ /* RESET */ #remotestorage-widget{text-align:left;}#remotestorage-widget input, #remotestorage-widget button{font-size:11px;}#remotestorage-widget form input[type=email]{margin-bottom:0;/* HTML5 Boilerplate */}#remotestorage-widget form input[type=submit]{margin-top:0;/* HTML5 Boilerplate */}/* /RESET */ #remotestorage-widget, #remotestorage-widget *{-moz-box-sizing:border-box;box-sizing:border-box;}#remotestorage-widget{position:absolute;right:10px;top:10px;font:normal 16px/100% sans-serif !important;user-select:none;-webkit-user-select:none;-moz-user-select:-moz-none;cursor:default;z-index:10000;}#remotestorage-widget .rs-bubble{background:rgba(80, 80, 80, .7);border-radius:5px 15px 5px 5px;color:white;font-size:0.8em;padding:5px;position:absolute;right:3px;top:9px;min-height:24px;white-space:nowrap;text-decoration:none;}#remotestorage-widget .rs-bubble-text{padding-right:105px;/* make sure the bubble doesn\'t "jump" when initially opening. */ min-width:182px;}#remotestorage-widget .rs-action{cursor:pointer;}/* less obtrusive cube when connected */ #remotestorage-widget.remotestorage-state-connected .rs-cube, #remotestorage-widget.remotestorage-state-busy .rs-cube{opacity:.3;-webkit-transition:opacity .3s ease;-moz-transition:opacity .3s ease;-ms-transition:opacity .3s ease;-o-transition:opacity .3s ease;transition:opacity .3s ease;}#remotestorage-widget.remotestorage-state-connected:hover .rs-cube, #remotestorage-widget.remotestorage-state-busy:hover .rs-cube, #remotestorage-widget.remotestorage-state-connected .rs-bubble:not(.rs-hidden) + .rs-cube{opacity:1 !important;}#remotestorage-widget .rs-backends{position:relative;top:5px;right:0;}#remotestorage-widget .rs-cube{position:relative;top:5px;right:0;}/* pulsing animation for cube when loading */ #remotestorage-widget .rs-cube.remotestorage-loading{-webkit-animation:remotestorage-loading .5s ease-in-out infinite alternate;-moz-animation:remotestorage-loading .5s ease-in-out infinite alternate;-o-animation:remotestorage-loading .5s ease-in-out infinite alternate;-ms-animation:remotestorage-loading .5s ease-in-out infinite alternate;animation:remotestorage-loading .5s ease-in-out infinite alternate;}@-webkit-keyframes remotestorage-loading{to{opacity:.7}}@-moz-keyframes remotestorage-loading{to{opacity:.7}}@-o-keyframes remotestorage-loading{to{opacity:.7}}@-ms-keyframes remotestorage-loading{to{opacity:.7}}@keyframes remotestorage-loading{to{opacity:.7}}#remotestorage-widget a{text-decoration:underline;color:inherit;}#remotestorage-widget form{margin-top:.7em;position:relative;}#remotestorage-widget form input{display:table-cell;vertical-align:top;border:none;border-radius:6px;font-weight:bold;color:white;outline:none;line-height:1.5em;height:2em;}#remotestorage-widget form input:disabled{color:#999;background:#444 !important;cursor:default !important;}#remotestorage-widget form input[type=email]:focus{background:#223;}#remotestorage-widget form input[type=email]{background:#000;width:100%;height:26px;padding:0 30px 0 5px;border-top:1px solid #111;border-bottom:1px solid #999;}#remotestorage-widget button:focus, #remotestorage-widget input:focus{box-shadow:0 0 4px #ccc;}#remotestorage-widget form input[type=email]::-webkit-input-placeholder{color:#999;}#remotestorage-widget form input[type=email]:-moz-placeholder{color:#999;}#remotestorage-widget form input[type=email]::-moz-placeholder{color:#999;}#remotestorage-widget form input[type=email]:-ms-input-placeholder{color:#999;}#remotestorage-widget form input[type=submit]{background:#000;cursor:pointer;padding:0 5px;}#remotestorage-widget form input[type=submit]:hover{background:#333;}#remotestorage-widget .rs-info-msg{font-size:10px;color:#eee;margin-top:0.7em;white-space:normal;}#remotestorage-widget .rs-info-msg.last-synced-message{display:inline;white-space:nowrap;margin-bottom:.7em}#remotestorage-widget .rs-info-msg a:hover, #remotestorage-widget .rs-info-msg a:active{color:#fff;}#remotestorage-widget button img{vertical-align:baseline;}#remotestorage-widget button{border:none;border-radius:6px;font-weight:bold;color:white;outline:none;line-height:1.5em;height:26px;width:26px;background:#000;cursor:pointer;margin:0;padding:5px;}#remotestorage-widget button:hover{background:#333;}#remotestorage-widget .rs-bubble button.connect{display:block;background:none;position:absolute;right:0;top:0;opacity:1;/* increase clickable area of connect button */ margin:-5px;padding:10px;width:36px;height:36px;}#remotestorage-widget .rs-bubble button.connect:not([disabled]):hover{background:rgba(150,150,150,.5);}#remotestorage-widget .rs-bubble button.connect[disabled]{opacity:.5;cursor:default !important;}#remotestorage-widget .rs-bubble button.rs-sync{position:relative;left:-5px;bottom:-5px;padding:4px 4px 0 4px;background:#555;}#remotestorage-widget .rs-bubble button.rs-sync:hover{background:#444;}#remotestorage-widget .rs-bubble button.rs-disconnect{background:#721;position:absolute;right:0;bottom:0;padding:4px 4px 0 4px;}#remotestorage-widget .rs-bubble button.rs-disconnect:hover{background:#921;}#remotestorage-widget .remotestorage-error-info{color:#f92;}#remotestorage-widget .remotestorage-reset{width:100%;background:#721;}#remotestorage-widget .remotestorage-reset:hover{background:#921;}#remotestorage-widget .rs-bubble .content{margin-top:7px;}#remotestorage-widget pre{user-select:initial;-webkit-user-select:initial;-moz-user-select:text;max-width:27em;margin-top:1em;overflow:auto;}#remotestorage-widget .rs-centered-text{text-align:center;}#remotestorage-widget .rs-bubble.rs-hidden{padding-bottom:2px;border-radius:5px 15px 15px 5px;}#remotestorage-widget .rs-error-msg{min-height:5em;}.rs-bubble.rs-hidden .rs-bubble-expandable{display:none;}.remotestorage-state-connected .rs-bubble.rs-hidden{display:none;}.remotestorage-connected{display:none;}.remotestorage-state-connected .remotestorage-connected{display:block;}.remotestorage-initial{display:none;}.remotestorage-state-initial .remotestorage-initial{display:block;}.remotestorage-error{display:none;}.remotestorage-state-error .remotestorage-error{display:block;}.remotestorage-state-authing .remotestorage-authing{display:block;}.remotestorage-state-offline .remotestorage-connected, .remotestorage-state-offline .remotestorage-offline{display:block;}.remotestorage-unauthorized{display:none;}.remotestorage-state-unauthorized .rs-bubble.rs-hidden{display:none;}.remotestorage-state-unauthorized .remotestorage-connected, .remotestorage-state-unauthorized .remotestorage-unauthorized{display:block;}.remotestorage-state-unauthorized .rs-sync{display:none;}.remotestorage-state-busy .rs-bubble.rs-hidden{display:none;}.remotestorage-state-busy .rs-bubble{display:block;}.remotestorage-state-busy .remotestorage-connected{display:block;}.remotestorage-state-authing .rs-bubble-expandable{display:none;}'
},function(e){function i(e,r){return function(){t&&(localStorage[n]=r),e.view?(e.rs.remote&&e.view.setUserAddress(e.rs.remote.userAddress),e.view.setState(r,arguments)):e._rememberedState=r}}function s(e){return function(t){t instanceof RemoteStorage.DiscoveryError?(console.error("discovery failed",t,'"'+t.message+'"'),e.view.setState("initial",[t.message])):t instanceof RemoteStorage.SyncError?e.view.setState("offline",[]):t instanceof RemoteStorage.Unauthorized?e.view.setState("unauthorized"):e.view.setState("error",[t])}}var t,n="remotestorage:widget:state",r={initial:!0,connected:!0,offline:!0};RemoteStorage.Widget=function(e){this.rs=e,this.rs.on("ready",i(this,"connected")),this.rs.on("disconnected",i(this,"initial")),this.rs.on("connecting",i(this,"authing")),this.rs.on("authing",i(this,"authing")),this.rs.on("sync-busy",i(this,"busy")),this.rs.on("sync-done",i(this,"connected")),this.rs.on("error",s(this));if(t){var o=localStorage[n];o&&r[o]&&(this._rememberedState=o,o=="connected"&&!e.connected&&(this._rememberedState="initial"))}},RemoteStorage.Widget.prototype={display:function(e){return this.view||this.setView(new RemoteStorage.Widget.View(this.rs)),this.view.display.apply(this.view,arguments),this},setView:function(e){this.view=e,this.view.on("connect",function(e){typeof e=="string"?this.rs.connect(e):e.special&&this.rs[e.special].connect(e)}.bind(this)),this.view.on("disconnect",this.rs.disconnect.bind(this.rs)),this.rs.sync&&this.view.on("sync",this.rs.sync.bind(this.rs));try{this.view.on("reset",function(){this.rs.on("disconnected",document.location.reload.bind(document.location)),this.rs.disconnect()}.bind(this))}catch(t){if(!t.message||!t.message.match(/Unknown event/))throw t}this._rememberedState&&(setTimeout(i(this,this._rememberedState),0),delete this._rememberedState)}},RemoteStorage.prototype.displayWidget=function(e){this.widget.display(e)},RemoteStorage.Widget._rs_init=function(e){e.widget||(e.widget=new RemoteStorage.Widget(e))},RemoteStorage.Widget._rs_supported=function(n){return t="localStorage"in e,typeof document!="undefined"}}(typeof window!="undefined"?window:global),function(e){function n(e,t){return e.getElementsByClassName(t)[0]}function r(e,t){return e.getElementsByTagName(t)[0]}function i(e,t){return e.classList.remove(t)}function s(e,t){return e.classList.add(t)}function o(e){typeof e.stopPropagation=="function"?e.stopPropagation():e.cancelBubble=!0}var t=document.createElement.bind(document);RemoteStorage.Widget.View=function(e){this.rs=e;if(typeof document=="undefined")throw"Widget not supported";RemoteStorage.eventHandling(this,"connect","disconnect","sync","display","reset");for(var u in this.events)this.events[u]=this.events[u].bind(this);this.toggle_bubble=function(e){this.bubble.className.search("rs-hidden")<0?this.hide_bubble(e):this.show_bubble(e)}.bind(this),this.hide_bubble=function(){s(this.bubble,"rs-hidden"),document.body.removeEventListener("click",a)}.bind(this);var a=function(e){for(var t=e.target;t!=document.body;t=t.parentElement)if(t.id=="remotestorage-widget")return;this.hide_bubble()}.bind(this);this.show_bubble=function(e){i(this.bubble,"rs-hidden"),typeof e!="undefined"&&o(e),document.body.addEventListener("click",a),r(this.bubble,"form").userAddress.focus()}.bind(this),this.display=function(e){if(typeof this.div!="undefined")return this.div;var i=t("div"),s=t("style");s.innerHTML=RemoteStorage.Assets.widgetCss,i.id="remotestorage-widget",i.innerHTML=RemoteStorage.Assets.widget,i.appendChild(s);if(e){var o=document.getElementById(e);if(!o)throw'Failed to find target DOM element with id="'+e+'"';o.appendChild(i)}else document.body.appendChild(i);var u;u=n(i,"rs-sync"),r(u,"img").src=RemoteStorage.Assets.syncIcon,u.addEventListener("click",this.events.sync),u=n(i,"rs-disconnect"),r(u,"img").src=RemoteStorage.Assets.disconnectIcon,u.addEventListener("click",this.events.disconnect);var u=n(i,"remotestorage-reset").addEventListener("click",this.events.reset),a=n(i,"connect");r(a,"img").src=RemoteStorage.Assets.connectIcon,a.addEventListener("click",this.events.connect),this.form=r(i,"form"),u=this.form.userAddress,u.addEventListener("keyup",function(e){e.target.value?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled")}),this.userAddress&&(u.value=this.userAddress),u=n(i,"rs-cube"),u.src=RemoteStorage.Assets.remoteStorageIcon,u.addEventListener("click",this.toggle_bubble),this.cube=u,u=n(i,"rs-dropbox"),u.src=RemoteStorage.Assets.dropbox,u.addEventListener("click",this.connectDropbox.bind(this)),this.rs.apiKeys.dropbox||(u.style.display="none"),u=n(i,"rs-googledrive"),u.src=RemoteStorage.Assets.googledrive,u.addEventListener("click",this.connectGdrive.bind(this)),this.rs.apiKeys.googledrive||(u.style.display="none"),this.bubble=n(i,"rs-bubble");var f={INPUT:!0,BUTTON:!0,IMG:!0};return this.bubble.addEventListener("click",function(e){!f[e.target.tagName]&&!this.div.classList.contains("remotestorage-state-unauthorized")&&this.show_bubble(e)}.bind(this)),this.hide_bubble(),this.div=i,this.states.initial.call(this),this.events.display.call(this),this.div}},RemoteStorage.Widget.View.prototype={connectGdrive:function(){this._emit("connect",{special:"googledrive"})},connectDropbox:function(){this._emit("connect",{special:"dropbox"})},setState:function(e,t){RemoteStorage.log("widget.view.setState(",e,",",t,");");var n=this.states[e];if(typeof n=="undefined")throw new Error("Bad State assigned to view: "+e);n.apply(this,t)},setUserAddress:function(e){this.userAddress=e||"";var t;this.div&&(t=r(this.div,"form").userAddress)&&(t.value=this.userAddress)},states:{initial:function(e){var t=this.cube,r=e||'This app allows you to use your own storage! Find more info on <a href="http://remotestorage.io/" target="_blank">remotestorage.io';e?(t.src=RemoteStorage.Assets.remoteStorageIconError,i(this.cube,"remotestorage-loading"),this.show_bubble(),setTimeout(function(){t.src=RemoteStorage.Assets.remoteStorageIcon},5e3)):this.hide_bubble(),this.div.className="remotestorage-state-initial",n(this.div,"rs-status-text").innerHTML="<strong>Connect</strong> remote storage";var s=n(this.div,"connect");this.form.userAddress.value&&s.removeAttribute("disabled");var o=n(this.div,"rs-info-msg");o.innerHTML=r,e?o.classList.add("remotestorage-error-info"):o.classList.remove("remotestorage-error-info")},authing:function(){this.div.removeEventListener("click",this.events.connect),this.div.className="remotestorage-state-authing",n(this.div,"rs-status-text").innerHTML="Connecting <strong>"+this.userAddress+"</strong>",s(this.cube,"remotestorage-loading")},connected:function(){this.div.className="remotestorage-state-connected",n(this.div,"userAddress").innerHTML=this.userAddress,this.cube.src=RemoteStorage.Assets.remoteStorageIcon,i(this.cube,"remotestorage-loading");var e={googledrive:n(this.div,"rs-googledrive"),dropbox:n(this.div,"rs-dropbox")};e.googledrive.style.display=e.dropbox.style.display="none",e[this.rs.backend]&&(e[this.rs.backend].style.display="inline-block")},busy:function(){this.div.className="remotestorage-state-busy",s(this.cube,"remotestorage-loading"),this.hide_bubble()},offline:function(){this.div.className="remotestorage-state-offline",this.cube.src=RemoteStorage.Assets.remoteStorageIconOffline,n(this.div,"rs-status-text").innerHTML="Offline"},error:function(e){var t=e;this.div.className="remotestorage-state-error",n(this.div,"rs-bubble-text").innerHTML="<strong> Sorry! An error occured.</strong>",e instanceof Error&&(t=e.message+"\n\n"+e.stack),n(this.div,"rs-error-msg").textContent=t,this.cube.src=RemoteStorage.Assets.remoteStorageIconError,this.show_bubble()},unauthorized:function(){this.div.className="remotestorage-state-unauthorized",this.cube.src=RemoteStorage.Assets.remoteStorageIconError,this.show_bubble(),this.div.addEventListener("click",this.events.connect)}},events:{connect:function(e){o(e),e.preventDefault(),this._emit("connect",r(this.div,"form").userAddress.value)},sync:function(e){o(e),e.preventDefault(),this._emit("sync")},disconnect:function(e){o(e),e.preventDefault(),this._emit("disconnect")},reset:function(t){t.preventDefault();var n=e.confirm("Are you sure you want to reset everything? That will probably make the error go away, but also clear your entire localStorage and reload the page. Please make sure you know what you are doing, before clicking 'yes' :-)");n&&this._emit("reset")},display:function(e){e&&e.preventDefault(),this._emit("display")}}}}(typeof window!="undefined"?window:global),function(e){function n(e,t){if(e===t)return!0;if(typeof e=="object"&&typeof t=="object"){if(Array.isArray(e)!=Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1}else{for(var i in e)if(t[i]===undefined&&e[i]!==undefined)return!1;for(var i in t)if(e[i]===undefined&&t[i]!==undefined)return!1;for(var i in e)if(!n(e[i],t[i]))return!1}return!0}return!1}function r(e){var t=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return t?{href:t[0]||"",protocol:t[1]||"",authority:t[2]||"",host:t[3]||"",hostname:t[4]||"",port:t[5]||"",pathname:t[6]||"",search:t[7]||"",hash:t[8]||""}:null}function i(e,t){function n(e){var t=[];return e.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){e==="/.."?t.pop():t.push(e)}),t.join("").replace(/^\//,e.charAt(0)==="/"?"/":"")}return t=r(t||""),e=r(e||""),!t||!e?null:(t.protocol||e.protocol)+(t.protocol||t.authority?t.authority:e.authority)+n(t.protocol||t.authority||t.pathname.charAt(0)==="/"?t.pathname:t.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+t.pathname:e.pathname)+(t.protocol||t.authority||t.pathname?t.search:t.search||e.search)+t.hash}function s(e,t){t==undefined?t=e.id:typeof e.id=="string"&&(t=i(t,e.id),e.id=t);if(typeof e=="object")if(Array.isArray(e))for(var n=0;n<e.length;n++)s(e[n],t);else if(typeof e["$ref"]=="string")e.$ref=i(t,e.$ref);else for(var r in e)r!="enum"&&s(e[r],t)}function u(e,t,n,r,i){if(e==undefined)throw new Error("No code supplied for error: "+t);this.code=e,this.message=t,this.dataPath=n?n:"",this.schemaPath=r?r:"",this.subErrors=i?i:null}function a(e,t,n){if(typeof t.id=="string"&&t.id.substring(0,n.length)==n){var r=t.id.substring(n.length);(n.length>0&&n.charAt(n.length-1)=="/"||r.charAt(0)=="#"||r.charAt(0)=="?")&&e[t.id]==undefined&&(e[t.id]=t)}if(typeof t=="object")for(var i in t)i!="enum"&&typeof t[i]=="object"&&a(e,t[i],n);return e}var t=function(e,t){this.missing=[],this.schemas=e?Object.create(e.schemas):{},this.collectMultiple=t,this.errors=[],this.handleError=t?this.collectError:this.returnError};t.prototype.returnError=function(e){return e},t.prototype.collectError=function(e){return e&&this.errors.push(e),null},t.prototype.prefixErrors=function(e,t,n){for(var r=e;r<this.errors.length;r++)this.errors[r]=this.errors[r].prefixWith(t,n);return this},t.prototype.getSchema=function(e){if(this.schemas[e]!=undefined){var t=this.schemas[e];return t}var n=e,r="";e.indexOf("#")!=-1&&(r=e.substring(e.indexOf("#")+1),n=e.substring(0,e.indexOf("#")));if(this.schemas[n]!=undefined){var t=this.schemas[n],i=decodeURIComponent(r);if(i=="")return t;if(i.charAt(0)!="/")return undefined;var s=i.split("/").slice(1);for(var o=0;o<s.length;o++){var u=s[o].replace("~1","/").replace("~0","~");if(t[u]==undefined){t=undefined;break}t=t[u]}if(t!=undefined)return t}this.missing[n]==undefined&&(this.missing.push(n),this.missing[n]=n)},t.prototype.addSchema=function(e,t){var n={};n[e]=t,s(t,e),a(n,t,e);for(var r in n)this.schemas[r]=n[r];return n},t.prototype.validateAll=function(t,n,r,i){if(n["$ref"]!=undefined){n=this.getSchema(n.$ref);if(!n)return null}var s=this.errors.length,o=this.validateBasic(t,n)||this.validateNumeric(t,n)||this.validateString(t,n)||this.validateArray(t,n)||this.validateObject(t,n)||this.validateCombinations(t,n)||null;if(o||s!=this.errors.length)while(r&&r.length||i&&i.length){var u=r&&r.length?""+r.pop():null,a=i&&i.length?""+i.pop():null;o&&(o=o.prefixWith(u,a)),this.prefixErrors(s,u,a)}return this.handleError(o)},t.prototype.validateBasic=function(t,n){var r;return(r=this.validateType(t,n))?r.prefixWith(null,"type"):(r=this.validateEnum(t,n))?r.prefixWith(null,"type"):null},t.prototype.validateType=function(t,n){if(n.type==undefined)return null;var r=typeof t;t==null?r="null":Array.isArray(t)&&(r="array");var i=n.type;typeof i!="object"&&(i=[i]);for(var s=0;s<i.length;s++){var a=i[s];if(a==r||a=="integer"&&r=="number"&&t%1==0)return null}return new u(o.INVALID_TYPE,"invalid data type: "+r)},t.prototype.validateEnum=function(t,r){if(r["enum"]==undefined)return null;for(var i=0;i<r["enum"].length;i++){var s=r["enum"][i];if(n(t,s))return null}return new u(o.ENUM_MISMATCH,"No enum match for: "+JSON.stringify(t))},t.prototype.validateNumeric=function(t,n){return this.validateMultipleOf(t,n)||this.validateMinMax(t,n)||null},t.prototype.validateMultipleOf=function(t,n){var r=n.multipleOf||n.divisibleBy;return r==undefined?null:typeof t=="number"&&t%r!=0?new u(o.NUMBER_MULTIPLE_OF,"Value "+t+" is not a multiple of "+r):null},t.prototype.validateMinMax=function(t,n){if(typeof t!="number")return null;if(n.minimum!=undefined){if(t<n.minimum)return(new u(o.NUMBER_MINIMUM,"Value "+t+" is less than minimum "+n.minimum)).prefixWith(null,"minimum");if(n.exclusiveMinimum&&t==n.minimum)return(new u(o.NUMBER_MINIMUM_EXCLUSIVE,"Value "+t+" is equal to exclusive minimum "+n.minimum)).prefixWith(null,"exclusiveMinimum")}if(n.maximum!=undefined){if(t>n.maximum)return(new u(o.NUMBER_MAXIMUM,"Value "+t+" is greater than maximum "+n.maximum)).prefixWith(null,"maximum");if(n.exclusiveMaximum&&t==n.maximum)return(new u(o.NUMBER_MAXIMUM_EXCLUSIVE,"Value "+t+" is equal to exclusive maximum "+n.maximum)).prefixWith(null,"exclusiveMaximum")}return null},t.prototype.validateString=function(t,n){return this.validateStringLength(t,n)||this.validateStringPattern(t,n)||null},t.prototype.validateStringLength=function(t,n){return typeof t!="string"?null:n.minLength!=undefined&&t.length<n.minLength?(new u(o.STRING_LENGTH_SHORT,"String is too short ("+t.length+" chars), minimum "+n.minLength)).prefixWith(null,"minLength"):n.maxLength!=undefined&&t.length>n.maxLength?(new u(o.STRING_LENGTH_LONG,"String is too long ("+t.length+" chars), maximum "+n.maxLength)).prefixWith(null,"maxLength"):null},t.prototype.validateStringPattern=function(t,n){if(typeof t!="string"||n.pattern==undefined)return null;var r=new RegExp(n.pattern);return r.test(t)?null:(new u(o.STRING_PATTERN,"String does not match pattern")).prefixWith(null,"pattern")},t.prototype.validateArray=function(t,n){return Array.isArray(t)?this.validateArrayLength(t,n)||this.validateArrayUniqueItems(t,n)||this.validateArrayItems(t,n)||null:null},t.prototype.validateArrayLength=function(t,n){if(n.minItems!=undefined&&t.length<n.minItems){var r=(new u(o.ARRAY_LENGTH_SHORT,"Array is too short ("+t.length+"), minimum "+n.minItems)).prefixWith(null,"minItems");if(this.handleError(r))return r}if(n.maxItems!=undefined&&t.length>n.maxItems){var r=(new u(o.ARRAY_LENGTH_LONG,"Array is too long ("+t.length+" chars), maximum "+n.maxItems)).prefixWith(null,"maxItems");if(this.handleError(r))return r}return null},t.prototype.validateArrayUniqueItems=function(t,r){if(r.uniqueItems)for(var i=0;i<t.length;i++)for(var s=i+1;s<t.length;s++)if(n(t[i],t[s])){var a=(new u(o.ARRAY_UNIQUE,"Array items are not unique (indices "+i+" and "+s+")")).prefixWith(null,"uniqueItems");if(this.handleError(a))return a}return null},t.prototype.validateArrayItems=function(t,n){if(n.items==undefined)return null;var r;if(Array.isArray(n.items)){for(var i=0;i<t.length;i++)if(i<n.items.length){if(r=this.validateAll(t[i],n.items[i],[i],["items",i]))return r}else if(n.additionalItems!=undefined)if(typeof n.additionalItems=="boolean"){if(!n.additionalItems){r=(new u(o.ARRAY_ADDITIONAL_ITEMS,"Additional items not allowed")).prefixWith(""+i,"additionalItems");if(this.handleError(r))return r}}else if(r=this.validateAll(t[i],n.additionalItems,[i],["additionalItems"]))return r}else for(var i=0;i<t.length;i++)if(r=this.validateAll(t[i],n.items,[i],["items"]))return r;return null},t.prototype.validateObject=function(t,n){return typeof t!="object"||t==null||Array.isArray(t)?null:this.validateObjectMinMaxProperties(t,n)||this.validateObjectRequiredProperties(t,n)||this.validateObjectProperties(t,n)||this.validateObjectDependencies(t,n)||null},t.prototype.validateObjectMinMaxProperties=function(t,n){var r=Object.keys(t);if(n.minProperties!=undefined&&r.length<n.minProperties){var i=(new u(o.OBJECT_PROPERTIES_MINIMUM,"Too few properties defined ("+r.length+"), minimum "+n.minProperties)).prefixWith(null,"minProperties");if(this.handleError(i))return i}if(n.maxProperties!=undefined&&r.length>n.maxProperties){var i=(new u(o.OBJECT_PROPERTIES_MAXIMUM,"Too many properties defined ("+r.length+"), maximum "+n.maxProperties)).prefixWith(null,"maxProperties");if(this.handleError(i))return i}return null},t.prototype.validateObjectRequiredProperties=function(t,n){if(n.required!=undefined)for(var r=0;r<n.required.length;r++){var i=n.required[r];if(t[i]===undefined){var s=(new u(o.OBJECT_REQUIRED,"Missing required property: "+i)).prefixWith(null,""+r).prefixWith(null,"required");if(this.handleError(s))return s}}return null},t.prototype.validateObjectProperties=function(t,n){var r;for(var i in t){var s=!1;if(n.properties!=undefined&&n.properties[i]!=undefined){s=!0;if(r=this.validateAll(t[i],n.properties[i],[i],["properties",i]))return r}if(n.patternProperties!=undefined)for(var a in n.patternProperties){var f=new RegExp(a);if(f.test(i)){s=!0;if(r=this.validateAll(t[i],n.patternProperties[a],[i],["patternProperties",a]))return r}}if(!s&&n.additionalProperties!=undefined)if(typeof n.additionalProperties=="boolean"){if(!n.additionalProperties){r=(new u(o.OBJECT_ADDITIONAL_PROPERTIES,"Additional properties not allowed")).prefixWith(i,"additionalProperties");if(this.handleError(r))return r}}else if(r=this.validateAll(t[i],n.additionalProperties,[i],["additionalProperties"]))return r}return null},t.prototype.validateObjectDependencies=function(t,n){var r;if(n.dependencies!=undefined)for(var i in n.dependencies)if(t[i]!==undefined){var s=n.dependencies[i];if(typeof s=="string"){if(t[s]===undefined){r=(new u(o.OBJECT_DEPENDENCY_KEY,"Dependency failed - key must exist: "+s)).prefixWith(null,i).prefixWith(null,"dependencies");if(this.handleError(r))return r}}else if(Array.isArray(s))for(var a=0;a<s.length;a++){var f=s[a];if(t[f]===undefined){r=(new u(o.OBJECT_DEPENDENCY_KEY,"Dependency failed - key must exist: "+f)).prefixWith(null,""+a).prefixWith(null,i).prefixWith(null,"dependencies");if(this.handleError(r))return r}}else if(r=this.validateAll(t,s,[],["dependencies",i]))return r}return null},t.prototype.validateCombinations=function(t,n){var r;return this.validateAllOf(t,n)||this.validateAnyOf(t,n)||this.validateOneOf(t,n)||this.validateNot(t,n)||null},t.prototype.validateAllOf=function(t,n){if(n.allOf==undefined)return null;var r;for(var i=0;i<n.allOf.length;i++){var s=n.allOf[i];if(r=this.validateAll(t,s,[],["allOf",i]))return r}return null},t.prototype.validateAnyOf=function(t,n){if(n.anyOf==undefined)return null;var r=[],i=this.errors.length;for(var s=0;s<n.anyOf.length;s++){var a=n.anyOf[s],f=this.errors.length,l=this.validateAll(t,a,[],["anyOf",s]);if(l==null&&f==this.errors.length)return this.errors=this.errors.slice(0,i),null;l&&r.push(l.prefixWith(null,""+s).prefixWith(null,"anyOf"))}return r=r.concat(this.errors.slice(i)),this.errors=this.errors.slice(0,i),new u(o.ANY_OF_MISSING,'Data does not match any schemas from "anyOf"',"","/anyOf",r)},t.prototype.validateOneOf=function(t,n){if(n.oneOf==undefined)return null;var r=null,i=[],s=this.errors.length;for(var a=0;a<n.oneOf.length;a++){var f=n.oneOf[a],l=this.errors.length,c=this.validateAll(t,f,[],["oneOf",a]);if(c==null&&l==this.errors.length){if(r!=null)return this.errors=this.errors.slice(0,s),new u(o.ONE_OF_MULTIPLE,'Data is valid against more than one schema from "oneOf": indices '+r+" and "+a,"","/oneOf");r=a}else c&&i.push(c.prefixWith(null,""+a).prefixWith(null,"oneOf"))}return r==null?(i=i.concat(this.errors.slice(s)),this.errors=this.errors.slice(0,s),new u(o.ONE_OF_MISSING,'Data does not match any schemas from "oneOf"',"","/oneOf",i)):(this.errors=this.errors.slice(0,s),null)},t.prototype.validateNot=function(t,n){if(n.not==undefined)return null;var r=this.errors.length,i=this.validateAll(t,n.not),s=this.errors.slice(r);return this.errors=this.errors.slice(0,r),i==null&&s.length==0?new u(o.NOT_PASSED,'Data matches schema from "not"',"","/not"):null};var o={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403};u.prototype={prefixWith:function(e,t){e!=null&&(e=e.replace("~","~0").replace("/","~1"),this.dataPath="/"+e+this.dataPath),t!=null&&(t=t.replace("~","~0").replace("/","~1"),this.schemaPath="/"+t+this.schemaPath);if(this.subErrors!=null)for(var n=0;n<this.subErrors.length;n++)this.subErrors[n].prefixWith(e,t);return this}};var f=new t,l={validate:function(e,n){var r=new t(f);typeof n=="string"&&(n={$ref:n});var i=r.addSchema("",n),s=r.validateAll(e,n);return this.error=s,this.missing=r.missing,this.valid=s==null,this.valid},validateResult:function(){var e={};return this.validate.apply(e,arguments),e},validateMultiple:function(e,n){var r=new t(f,!0);typeof n=="string"&&(n={$ref:n}),r.addSchema("",n),r.validateAll(e,n);var i={};return i.errors=r.errors,i.missing=r.missing,i.valid=i.errors.length==0,i},addSchema:function(e,t){return f.addSchema(e,t)},getSchema:function(e){return f.getSchema(e)},missing:[],error:null,normSchema:s,resolveUrl:i,errorCodes:o};e.tv4=l}(typeof window!="undefined"?window:global);var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(e,t){var n=CHARS,r=[],i;t=t||n.length;if(e)for(i=0;i<e;i++)r[i]=n[0|Math.random()*t];else{var s;r[8]=r[13]=r[18]=r[23]="-",r[14]="4";for(i=0;i<36;i++)r[i]||(s=0|Math.random()*16,r[i]=n[i==19?s&3|8:s])}return r.join("")},function(e){function t(e,t){console.log("WARNING: "+e+" is deprecated. Use "+t+" instead.")}var n=RemoteStorage;n.BaseClient=function(e,t){if(t[t.length-1]!="/")throw"Not a directory: "+t;t=="/"&&(this.makePath=function(e){return(e[0]=="/"?"":"/")+e}),this.storage=e,this.base=t;var r=this.base.split("/");r.length>2?this.moduleName=r[1]:this.moduleName="root",n.eventHandling(this,"change","conflict"),this.on=this.on.bind(this),e.onChange(this.base,this._fireChange.bind(this)),e.onConflict(this.base,this._fireConflict.bind(this))},n.BaseClient.prototype={use:function(e){return t("BaseClient#use(path)","BaseClient#cache(path)"),this.cache(e)},release:function(e){return t("BaseClient#release(path)","BaseClient#cache(path, false)"),this.cache(e,!1)},extend:function(e){for(var t in e)this[t]=e[t];return this},scope:function(e){return new n.BaseClient(this.storage,this.makePath(e))},getListing:function(e){if(typeof e=="undefined")e="";else if(e.length>0&&e[e.length-1]!="/")throw"Not a directory: "+e;return this.storage.get(this.makePath(e)).then(function(e,t){if(e==404)return;return typeof t=="object"?Object.keys(t):undefined})},getAll:function(e){if(typeof e=="undefined")e="";else if(e.length>0&&e[e.length-1]!="/")throw"Not a directory: "+e;return this.storage.get(this.makePath(e)).then(function(t,n){if(t==404)return;if(typeof n=="object"){var r=promising(),i=Object.keys(n).length,s=0;if(i==0)return;for(var o in n)this.storage.get(this.makePath(e+o)).then(function(e,t){n[this.key]=t,s++,s==i&&r.fulfill(n)}.bind({key:o}));return r}}.bind(this))},getFile:function(e){return this.storage.get(this.makePath(e)).then(function(e,t,n,r){return{data:t,mimeType:n,revision:r}})},storeFile:function(e,t,n){return this.storage.put(this.makePath(t),n,e).then(function(e,n,r,i){if(e==200||e==201)return i;throw"Request (PUT "+this.makePath(t)+") failed with status: "+e})},getObject:function(e){return this.storage.get(this.makePath(e)).then(function(t,n,r,i){if(typeof n=="object")return n;if(typeof n!="undefined"&&t==200)throw"Not an object: "+this.makePath(e)})},storeObject:function(e,t,r){this._attachType(r,e);try{var i=this.validate(r);if(!i.valid)return promising(function(e){e.reject(i)})}catch(s){if(!(s instanceof n.BaseClient.Types.SchemaNotFound))return promising().reject(s)}return this.storage.put(this.makePath(t),r,"application/json; charset=UTF-8").then(function(e,n,r,i){if(e==200||e==201)return i;throw"Request (PUT "+this.makePath(t)+") failed with status: "+e}.bind(this))},remove:function(e){return this.storage.delete(this.makePath(e))},cache:function(e,t){return this.storage.caching[t!==!1?"enable":"disable"](this.makePath(e)),this},makePath:function(e){var t=e.split("/");for(var n=0;n<t.length;n++)t[n]=encodeURIComponent(t[n]);return this.base+(t.join("/")||"")},_fireChange:function(e){this._emit("change",e)},_fireConflict:function(e){this._handlers.conflict.length>0?this._emit("conflict",e):e.resolve("remote")},getItemURL:function(e){return this.storage.connected?this.storage.remote.href+this.makePath(e):undefined},uuid:function(){return Math.uuid()}},n.BaseClient._rs_init=function(){n.prototype.scope=function(e){return new n.BaseClient(this,e)}}}(typeof window!="undefined"?window:global),function(e){RemoteStorage.BaseClient.Types={uris:{},schemas:{},aliases:{},declare:function(e,t,n,r){var i=e+"/"+t;if(r.extends){var s,o=r.extends.split("/");o.length===1?s=e+"/"+o.shift():s=o.join("/");var u=this.uris[s];if(!u)throw"Type '"+i+"' tries to extend unknown schema '"+s+"'";r.extends=this.schemas[u]}this.uris[i]=n,this.aliases[n]=i,this.schemas[n]=r},resolveAlias:function(e){return this.uris[e]},getSchema:function(e){return this.schemas[e]},inScope:function(e){var t=e.length,n={};for(var r in this.uris)if(r.substr(0,t+1)==e+"/"){var i=this.uris[r];n[i]=this.schemas[i]}return n}};var t=function(e){var t=Error("Schema not found: "+e);return t.name="SchemaNotFound",t};t.prototype=Error.prototype,RemoteStorage.BaseClient.Types.SchemaNotFound=t,RemoteStorage.BaseClient.prototype.extend({validate:function(e){var n=RemoteStorage.BaseClient.Types.getSchema(e["@context"]);if(n)return tv4.validateResult(e,n);throw new t(e["@context"])},declareType:function(e,t,n){n||(n=t,t=this._defaultTypeURI(e)),RemoteStorage.BaseClient.Types.declare(this.moduleName,e,t,n)},_defaultTypeURI:function(e){return"http://remotestoragejs.com/spec/modules/"+this.moduleName+"/"+e},_attachType:function(e,t){e["@context"]=RemoteStorage.BaseClient.Types.resolveAlias(t)||this._defaultTypeURI(t)}}),Object.defineProperty(RemoteStorage.BaseClient.prototype,"schemas",{configurable:!0,get:function(){return RemoteStorage.BaseClient.Types.inScope(this.moduleName)}})}(typeof window!="undefined"?window:global),function(e){function r(e){if(e==="")return"/";if(!e)throw"Path not given!";return e.replace(/\/+/g,"/").replace(/[^\/]+\/?$/,"")}function i(e){return e.substr(-1)=="/"}function s(e,t){return e.slice(0,t.length)===t}var t="localStorage"in e,n="remotestorage:caching";RemoteStorage.Caching=function(){this.reset();if(t){var e=localStorage[n];e&&(this._pathSettingsMap=JSON.parse(e),this._updateRoots())}},RemoteStorage.Caching.prototype={enable:function(e){this.set(e,{data:!0})},disable:function(e){this.remove(e)},get:function(e){return this._validateDirPath(e),this._pathSettingsMap[e]},set:function(e,t){this._validateDirPath(e);if(typeof t!="object")throw new Error("settings is required");this._pathSettingsMap[e]=t,this._updateRoots()},remove:function(e){this._validateDirPath(e),delete this._pathSettingsMap[e],this._updateRoots()},reset:function(){this.rootPaths=[],this._pathSettingsMap={}},descendIntoPath:function(e){return this._validateDirPath(e),!!this._query(e)},cachePath:function(e){this._validatePath(e);var t=this._query(e);return t&&(i(e)||t.data)},_query:function(e){return this._pathSettingsMap[e]||e!=="/"&&this._query(r(e))},_validatePath:function(e){if(typeof e!="string")throw new Error("path is required")},_validateDirPath:function(e){this._validatePath(e);if(!i(e))throw new Error("not a directory path: "+e);if(e[0]!=="/")throw new Error("path not absolute: "+e)},_updateRoots:function(){var e={};for(var r in this._pathSettingsMap){if(e[r])continue;var i=!1;for(var o in this._pathSettingsMap)if(s(r,o)){e[o]=!0,i=!0;break}i||(e[r]=!0)}this.rootPaths=Object.keys(e),t&&(localStorage[n]=JSON.stringify(this._pathSettingsMap))}},Object.defineProperty(RemoteStorage.Caching.prototype,"list",{get:function(){var e=[];for(var t in this._pathSettingsMap)e.push({path:t,settings:this._pathSettingsMap[t]});return e}}),Object.defineProperty(RemoteStorage.prototype,"caching",{configurable:!0,get:function(){var e=new RemoteStorage.Caching;return Object.defineProperty(this,"caching",{value:e}),e}}),RemoteStorage.Caching._rs_init=function(){}}(typeof window!="undefined"?window:global),function(e){function n(e){return e[e.length-1]=="/"}function r(e,t,n,r,i){function u(){o++,o==s&&i.fulfill()}var s=r.length,o=0;s==0&&i.fulfill(),r.forEach(function(r){a(e,t,n+r).then(u)})}function i(e,t,i,s,o,u,a){n(i)?r(e,t,i,Object.keys(s),a):t.put(i,s,o,!0).then(function(){return t.setRevision(i,u)}).then(function(){a.fulfill()})}function s(e,t){var n={};for(var r in e)n[r]=!0;for(var i in t)n[i]=!0;return Object.keys(n)}function o(e,t){var n=promising();return u(e,t,n),n}function u(e,t,r){n(t)?e.get(t).then(function(n,i,s,u){function h(){c++,c==l&&!f&&r.fulfill()}function p(e){f||(f=!0,r.reject(e))}var a=[],f=!1;for(item in i)a.push(item);var l=a.length,c=0;l==0&&r.fulfill(),a.forEach(function(n){o(e,t+n).then(h,p)})}):e.delete(t,!0).then(r.fulfill,r.reject)}function a(e,t,o,a){var f=promising();return t.get(o).then(function(a,l,c,h){e.get(o,{ifNoneMatch:h}).then(function(c,h,p,d){if(c==401||c==403)throw new RemoteStorage.Unauthorized;c==412||c==304?f.fulfill():a==404&&c==200?i(e,t,o,h,p,d,f):a==200&&c==404?u(t,o,f):a==200&&c==200?n(o)?t.setRevision(o,d).then(function(){r(e,t,o,s(l,h),f)}):i(e,t,o,h,p,d,f):f.fulfill()}).then(undefined,f.reject)}).then(undefined,f.reject),f}function f(e,t,n){e.setConflict(t,n)}function l(e,t,n){return t.changesBelow(n).then(function(n){function o(e){function n(){i++,i==r&&s.fulfill()}e?t.clearChange(e).then(n):n()}var r=n.length,i=0,s=promising();if(r>0){function u(e){console.error("pushChanges aborted due to error: ",e,e.stack),s.reject(e)}return n.forEach(function(n){if(n.conflict){var r=n.conflict.resolution;if(!r)return RemoteStorage.log("conflict pending for ",n.path),o();RemoteStorage.log("about to resolve",r),n.action=r=="remote"?n.remoteAction:n.localAction,n.force=!0}switch(n.action){case"PUT":var i={};n.force||(n.revision?i.ifMatch=n.revision:i.ifNoneMatch="*"),t.get(n.path).then(function(t,r,s){return t==200?e.put(n.path,r,s,i):200}).then(function(e){e==412?(f(t,n.path,{localAction:"PUT",remoteAction:"PUT"}),o()):o(n.path)}).then(undefined,u);break;case"DELETE":e.delete(n.path,{ifMatch:n.force?undefined:n.revision}).then(function(e){e==412?(f(t,n.path,{remoteAction:"PUT",localAction:"DELETE"}),o()):o(n.path)}).then(undefined,u)}}),s}})}var t=1e4;RemoteStorage.Sync={sync:function(e,t,n){return l(e,t,n).then(function(){return a(e,t,n)})},syncTree:function(e,t,n){return a(e,t,n,{data:!1})}};var c=function(e){var t="Sync failed: ";typeof e=="object"&&"message"in e?t+=e.message:t+=e,this.originalError=e,Error.apply(this,[t])};c.prototype=Object.create(Error.prototype),RemoteStorage.prototype.sync=function(){if(!this.local||!this.caching)throw"Sync requires 'local' and 'caching'!";if(!this.remote.connected)return promising().fulfill();var e=this.caching.rootPaths.slice(0),t=e.length,n=0,r=!1,i=this;return promising(function(s){if(t==0)return i._emit("sync-busy"),i._emit("sync-done"),s.fulfill();i._emit("sync-busy");var o;while(o=e.shift())(function(e){RemoteStorage.Sync.sync(i.remote,i.local,e,i.caching.get(e)).then(function(){if(r)return;n++,t==n&&(i._emit("sync-done"),s.fulfill())},function(t){console.error("syncing",e,"failed:",t);if(r)return;r=!0,i._emit("sync-done"),t instanceof RemoteStorage
.Unauthorized?i._emit("error",t):i._emit("error",new c(t)),s.reject(t)})})(o)})},RemoteStorage.SyncError=c,RemoteStorage.prototype.syncCycle=function(){this.sync().then(function(){this.stopSync(),this._syncTimer=setTimeout(this.syncCycle.bind(this),t)}.bind(this),function(e){console.log("sync error, retrying"),this.stopSync(),this._syncTimer=setTimeout(this.syncCycle.bind(this),t)}.bind(this))},RemoteStorage.prototype.stopSync=function(){this._syncTimer&&(clearTimeout(this._syncTimer),delete this._syncTimer)},RemoteStorage.Sync._rs_init=function(e){e.on("ready",function(){e.syncCycle()})},RemoteStorage.Sync._rs_cleanup=function(e){e.stopSync()}}(typeof window!="undefined"?window:global),function(e){function i(e){return Object.keys(e.body).length>0||Object.keys(e.cached).length>0}function s(e,t,n){var r=t.match(/^(.*\/)([^\/]+\/?)$/);if(r){var o=r[1],u=r[2];e.get(o).onsuccess=function(t){var r=t.target.result;if(!r)return;delete r[n][u],i(r)?e.put(r):e.delete(r.path).onsuccess=function(){o!="/"&&s(e,o,n)}}}}function o(e){var t={path:e};return e[e.length-1]=="/"&&(t.body={},t.cached={},t.contentType="application/json"),t}function u(e,t,n){var r=t.match(/^(.*\/)([^\/]+\/?)$/);if(r){var i=r[1],s=r[2];e.get(i).onsuccess=function(t){var r=t.target.result||o(i);r[n][s]=!0,e.put(r).onsuccess=function(){i!="/"&&u(e,i,n)}}}}var t=RemoteStorage,n="remotestorage",r;t.IndexedDB=function(e){this.db=e||r;if(!this.db){if(RemoteStorage.LocalStorage)return RemoteStorage.log("Failed to open indexedDB, falling back to localStorage"),new RemoteStorage.LocalStorage;throw"Failed to open indexedDB and localStorage fallback not available!"}t.eventHandling(this,"change","conflict")},t.IndexedDB.prototype={get:function(e){var t=promising(),n=this.db.transaction(["nodes"],"readonly"),r=n.objectStore("nodes"),i=r.get(e),s;return i.onsuccess=function(){s=i.result},n.oncomplete=function(){s?t.fulfill(200,s.body,s.contentType,s.revision):t.fulfill(404)},n.onerror=n.onabort=t.reject,t},put:function(e,t,n,r){var i=promising();if(e[e.length-1]=="/")throw"Bad: don't PUT folders";var s=this.db.transaction(["nodes"],"readwrite"),o=s.objectStore("nodes"),a,f;return o.get(e).onsuccess=function(r){try{a=r.target.result;var s={path:e,contentType:n,body:t};o.put(s).onsuccess=function(){try{u(o,e,"body")}catch(t){typeof f=="undefined"&&(f=!0,i.reject(t))}}}catch(l){typeof f=="undefined"&&(f=!0,i.reject(l))}},s.oncomplete=function(){this._emit("change",{path:e,origin:r?"remote":"window",oldValue:a?a.body:undefined,newValue:t}),r||this._recordChange(e,{action:"PUT",revision:a?a.revision:undefined}),typeof f=="undefined"&&(f=!0,i.fulfill(200))}.bind(this),s.onerror=s.onabort=i.reject,i},"delete":function(e,t){var n=promising();if(e[e.length-1]=="/")throw"Bad: don't DELETE folders";var r=this.db.transaction(["nodes"],"readwrite"),i=r.objectStore("nodes"),o;return i.get(e).onsuccess=function(n){o=n.target.result,i.delete(e).onsuccess=function(){s(i,e,"body",t)}},r.oncomplete=function(){o&&this._emit("change",{path:e,origin:t?"remote":"window",oldValue:o.body,newValue:undefined}),t||this._recordChange(e,{action:"DELETE",revision:o?o.revision:undefined}),n.fulfill(200)}.bind(this),r.onerror=r.onabort=n.reject,n},setRevision:function(e,t){return this.setRevisions([[e,t]])},setRevisions:function(e){var t=promising(),n=this.db.transaction(["nodes"],"readwrite");return e.forEach(function(e){var t=n.objectStore("nodes");t.get(e[0]).onsuccess=function(n){var r=n.target.result||o(e[0]);r.revision=e[1],t.put(r).onsuccess=function(){u(t,e[0],"cached")}}}),n.oncomplete=function(){t.fulfill()},n.onerror=n.onabort=t.reject,t},getRevision:function(e){var t=promising(),n=this.db.transaction(["nodes"],"readonly"),r;return n.objectStore("nodes").get(e).onsuccess=function(e){e.target.result&&(r=e.target.result.revision)},n.oncomplete=function(){t.fulfill(r)},n.onerror=n.onabort=t.reject,t},getCached:function(e){if(e[e.length-1]!="/")return this.get(e);var t=promising(),n=this.db.transaction(["nodes"],"readonly"),r=n.objectStore("nodes");return r.get(e).onsuccess=function(e){var n=e.target.result||{};t.fulfill(200,n.cached,n.contentType,n.revision)},t},reset:function(e){var n=this.db.name;this.db.close();var r=this;t.IndexedDB.clean(this.db.name,function(){t.IndexedDB.open(n,function(t){r.db=t.db,e(r)})})},fireInitial:function(){var e=this.db.transaction(["nodes"],"readonly"),t=e.objectStore("nodes").openCursor();t.onsuccess=function(e){var t=e.target.result;if(t){var n=t.key;n.substr(-1)!="/"&&this._emit("change",{path:n,origin:"remote",oldValue:undefined,newValue:t.value.body}),t.continue()}}.bind(this)},_recordChange:function(e,t){var n=promising(),r=this.db.transaction(["changes"],"readwrite"),i=r.objectStore("changes"),s;return i.get(e).onsuccess=function(n){s=n.target.result||{},s.path=e;for(var r in t)s[r]=t[r];i.put(s)},r.oncomplete=n.fulfill,r.onerror=r.onabort=n.reject,n},clearChange:function(e){var t=promising(),n=this.db.transaction(["changes"],"readwrite"),r=n.objectStore("changes");return r.delete(e),n.oncomplete=function(){t.fulfill()},t},changesBelow:function(e){var t=promising(),n=this.db.transaction(["changes"],"readonly"),r=n.objectStore("changes").openCursor(IDBKeyRange.lowerBound(e)),i=e.length,s=[];return r.onsuccess=function(){var t=r.result;t&&t.key.substr(0,i)==e&&(s.push(t.value),t.continue())},n.oncomplete=function(){t.fulfill(s)},t},setConflict:function(e,t){var n={path:e};for(var r in t)n[r]=t[r];this._recordChange(e,{conflict:t}).then(function(){this._handlers.conflict.length>0?this._emit("conflict",n):setTimeout(function(){n.resolve("remote")},0)}.bind(this)),n.resolve=function(n){if(n!="remote"&&n!="local")throw"Invalid resolution: "+n;t.resolution=n,this._recordChange(e,{conflict:t})}.bind(this)},closeDB:function(){this.db.close()}};var a=2;t.IndexedDB.open=function(e,t){var n=setTimeout(function(){t("timeout trying to open db")},3500),r=indexedDB.open(e,a);r.onerror=function(){console.error("opening db failed",r),clearTimeout(n),t(r.error)},r.onupgradeneeded=function(e){RemoteStorage.log("[IndexedDB] Upgrade: from ",e.oldVersion," to ",e.newVersion);var t=r.result;e.oldVersion!=1&&(RemoteStorage.log("[IndexedDB] Creating object store: nodes"),t.createObjectStore("nodes",{keyPath:"path"})),RemoteStorage.log("[IndexedDB] Creating object store: changes"),t.createObjectStore("changes",{keyPath:"path"})},r.onsuccess=function(){clearTimeout(n),t(null,r.result)}},t.IndexedDB.clean=function(e,t){var n=indexedDB.deleteDatabase(e);n.onsuccess=function(){RemoteStorage.log("done removing db"),t()},n.onerror=n.onabort=function(t){console.error('failed to remove database "'+e+'"',t)}},t.IndexedDB._rs_init=function(e){var i=promising();return t.IndexedDB.open(n,function(t,n){if(t){if(t.name=="InvalidStateError"){var t=new Error("IndexedDB couldn't be opened.");t.stack="If you are using Firefox, please disable\nprivate browsing mode.\n\nOtherwise please report your problem\nusing the link below",e._emit("error",t)}}else r=n,n.onerror=function(){e._emit("error",t)},i.fulfill()}),i},t.IndexedDB._rs_supported=function(){return"indexedDB"in e},t.IndexedDB._rs_cleanup=function(e){e.local&&e.local.closeDB();var r=promising();return t.IndexedDB.clean(n,function(){r.fulfill()}),r}}(typeof window!="undefined"?window:global),function(e){function r(e){var t={path:e};return e[e.length-1]=="/"&&(t.body={},t.cached={},t.contentType="application/json"),t}function i(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:e===43?62:e===47?63:0}function s(e,t){var n=e.replace(/[^A-Za-z0-9\+\/]/g,""),r=n.length,s=t?Math.ceil((r*3+1>>2)/t)*t:r*3+1>>2,o=new Uint8Array(s);for(var u,a,f=0,l=0,c=0;c<r;c++){a=c&3,f|=i(n.charCodeAt(c))<<18-6*a;if(a===3||r-c===1){for(u=0;u<3&&l<s;u++,l++)o[l]=f>>>(16>>>u&24)&255;f=0}}return o}function o(e){return e.match(/charset=binary/)}var t="remotestorage:cache:nodes:",n="remotestorage:cache:changes:";RemoteStorage.LocalStorage=function(){RemoteStorage.eventHandling(this,"change","conflict")},RemoteStorage.LocalStorage.prototype={toBase64:function(e){var t=new Uint8Array(e),n="";for(var r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return btoa(n)},toArrayBuffer:s,get:function(e){var t=this._get(e);return t?(o(t.contentType)&&(t.body=this.toArrayBuffer(t.body)),promising().fulfill(200,t.body,t.contentType,t.revision)):promising().fulfill(404)},put:function(e,n,r,i){var s=this._get(e);o(r)&&(n=this.toBase64(n));var u={path:e,contentType:r,body:n};return localStorage[t+e]=JSON.stringify(u),this._addToParent(e),this._emit("change",{path:e,origin:i?"remote":"window",oldValue:s?s.body:undefined,newValue:n}),i||this._recordChange(e,{action:"PUT"}),promising().fulfill(200)},"delete":function(e,n){var r=this._get(e);return delete localStorage[t+e],this._removeFromParent(e),r&&this._emit("change",{path:e,origin:n?"remote":"window",oldValue:r.body,newValue:undefined}),n||this._recordChange(e,{action:"DELETE"}),promising().fulfill(200)},setRevision:function(e,n){var i=this._get(e)||r(e);return i.revision=n,localStorage[t+e]=JSON.stringify(i),promising().fulfill()},getRevision:function(e){var t=this._get(e);return promising.fulfill(t?t.revision:undefined)},_get:function(e){var n;try{n=JSON.parse(localStorage[t+e])}catch(r){}return n},_recordChange:function(e,t){var r;try{r=JSON.parse(localStorage[n+e])}catch(i){r={}}for(var s in t)r[s]=t[s];r.path=e,localStorage[n+e]=JSON.stringify(r)},clearChange:function(e){return delete localStorage[n+e],promising().fulfill()},changesBelow:function(e){var t=[],r=localStorage.length,i=n+e,s=i.length;for(var o=0;o<r;o++){var u=localStorage.key(o);u.substr(0,s)==i&&t.push(JSON.parse(localStorage[u]))}return promising().fulfill(t)},setConflict:function(e,t){var n={path:e};for(var r in t)n[r]=t[r];this._recordChange(e,{conflict:t}),n.resolve=function(n){if(n!="remote"&&n!="local")throw"Invalid resolution: "+n;t.resolution=n,this._recordChange(e,{conflict:t})}.bind(this),this._emit("conflict",n)},_addToParent:function(e){var n=e.match(/^(.*\/)([^\/]+\/?)$/);if(n){var i=n[1],s=n[2],o=this._get(i)||r(i);o.body[s]=!0,localStorage[t+i]=JSON.stringify(o),i!="/"&&this._addToParent(i)}},_removeFromParent:function(e){var n=e.match(/^(.*\/)([^\/]+\/?)$/);if(n){var r=n[1],i=n[2],s=this._get(r);s&&(delete s.body[i],Object.keys(s.body).length>0?localStorage[t+r]=JSON.stringify(s):(delete localStorage[t+r],r!="/"&&this._removeFromParent(r)))}},fireInitial:function(){var e=localStorage.length,n=t.length;for(var r=0;r<e;r++){var i=localStorage.key(r);if(i.substr(0,n)==t){var s=i.substr(n),o=this._get(s);this._emit("change",{path:s,origin:"remote",oldValue:undefined,newValue:o.body})}}}},RemoteStorage.LocalStorage._rs_init=function(){},RemoteStorage.LocalStorage._rs_supported=function(){return"localStorage"in e},RemoteStorage.LocalStorage._rs_cleanup=function(){var e=localStorage.length,r=t.length,i=n.length,s=[];for(var o=0;o<e;o++){var u=localStorage.key(o);(u.substr(0,r)==t||u.substr(0,i)==n)&&s.push(u)}s.forEach(function(e){console.log("removing",e),delete localStorage[e]})}}(typeof window!="undefined"?window:global),function(){RemoteStorage.MODULES={},RemoteStorage.defineModule=function(e,t){RemoteStorage.MODULES[e]=t,Object.defineProperty(RemoteStorage.prototype,e,{configurable:!0,get:function(){var t=this._loadModule(e);return Object.defineProperty(this,e,{value:t}),t}});if(e.indexOf("-")!=-1){var n=e.replace(/\-[a-z]/g,function(e){return e[1].toUpperCase()});Object.defineProperty(RemoteStorage.prototype,n,{get:function(){return this[e]}})}},RemoteStorage.prototype._loadModule=function(e){var t=RemoteStorage.MODULES[e];if(t){var n=t(new RemoteStorage.BaseClient(this,"/"+e+"/"),new RemoteStorage.BaseClient(this,"/public/"+e+"/"));return n.exports}throw"Unknown module: "+e},RemoteStorage.prototype.defineModule=function(e){console.log("remoteStorage.defineModule is deprecated, use RemoteStorage.defineModule instead!"),RemoteStorage.defineModule.apply(RemoteStorage,arguments)}}(),function(){function e(e,t,n){function o(e,t,n,r){[t,n,r].forEach(function(t){var n=document.createElement("td");n.textContent=t||"",e.appendChild(n)})}function u(e){function n(t,n,r,i){if(t==200){var a=document.createElement("tr");s.appendChild(a),o(a,e,r,i);if(e[e.length-1]=="/")for(var f in n)u(e+f)}}if(t.connected===!1)return;t.get(e).then(n)}e.setAttribute("border","1"),e.style.margin="8px",e.innerHTML="";var r=document.createElement("thead");e.appendChild(r);var i=document.createElement("tr");r.appendChild(i),["Path","Content-Type","Revision"].forEach(function(e){var t=document.createElement("th");t.textContent=e,r.appendChild(t)});var s=document.createElement("tbody");e.appendChild(s),n.forEach(u)}function t(t,n,r,i){var s=document.createElement("div"),o=document.createElement("h2");o.textContent=t,s.appendChild(o);var u=document.createElement("button");u.textContent="Refresh",u.onclick=function(){e(n,r,i)},s.appendChild(u);if(r.reset){var a=document.createElement("button");a.textContent="Reset",a.onclick=function(){r.reset(function(t){r=t,e(n,r,i)})},s.appendChild(a)}return s.appendChild(n),e(n,r,i),s}function n(e){function s(){e.changesBelow("/").then(function(e){i.innerHTML="",e.forEach(function(e){var t=document.createElement("li");t.textContent=JSON.stringify(e),i.appendChild(t)})})}var t=document.createElement("div"),n=document.createElement("h2");n.textContent="Outgoing changes",t.appendChild(n);var r=document.createElement("button");r.textContent="Refresh",t.appendChild(r);var i=document.createElement("ul");return i.style.fontFamily="courier",t.appendChild(i),r.onclick=s,s(),t}RemoteStorage.prototype.inspect=function(){var r=document.createElement("div");r.id="remotestorage-inspect",r.style.position="absolute",r.style.top=0,r.style.left=0,r.style.background="black",r.style.color="white",r.style.border="groove 5px #ccc";var i=document.createElement("div");i.style.position="absolute",i.style.top=0,i.style.left=0;var s=document.createElement("strong");s.textContent=" remotestorage.js inspector ",i.appendChild(s);if(this.local){var o=document.createElement("button");o.textContent="Synchronize",i.appendChild(o)}var u=document.createElement("button");u.textContent="Close",u.onclick=function(){document.body.removeChild(r)},i.appendChild(u),r.appendChild(i);var a=document.createElement("table"),f=document.createElement("table");r.appendChild(t("Remote",a,this.remote,this.caching.rootPaths)),this.local&&(r.appendChild(t("Local",f,this.local,["/"])),r.appendChild(n(this.local)),o.onclick=function(){this.log("sync clicked"),this.sync().then(function(){this.log("SYNC FINISHED"),e(f,this.local,["/"])}.bind(this),function(e){console.error("SYNC FAILED",e,e.stack)})}.bind(this)),document.body.appendChild(r)}}(),function(){var e={getEventEmitter:function(){var e={},t=Array.prototype.slice.call(arguments);return t.unshift(e),RemoteStorage.eventHandling.apply(RemoteStorage,t),e.emit=e._emit,e},extend:function(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){for(var n in t)e[n]=t[n]}),e},asyncEach:function(e,t){return this.asyncMap(e,t).then(function(){return e})},asyncMap:function(e,t){function u(){i++,i==r&&n.fulfill(s,o)}var n=promising(),r=e.length,i=0,s=[],o=[];return e.forEach(function(e,n){try{var r=t(e)}catch(i){u(),o[n]=i}typeof r=="object"&&typeof r.then=="function"?r.then(function(e){s[n]=e,u()},function(e){o[n]=res,u()}):(u(),s[n]=r)}),n},containingDir:function(e){var t=e.replace(/[^\/]+\/?$/,"");return t==e?null:t},isDir:function(e){return e.substr(-1)=="/"},baseName:function(t){var n=t.split("/");return e.isDir(t)?n[n.length-2]+"/":n[n.length-1]},bindAll:function(e){for(var t in this)typeof e[t]=="function"&&(e[t]=e[t].bind(e))}};Object.defineProperty(RemoteStorage.prototype,"util",{get:function(){return console.log("DEPRECATION WARNING: remoteStorage.util is deprecated and will be removed with the next major release."),e}})}(),function(e){function u(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function a(e){return encodeURIComponent(e.title)+(e.mimeType==s?"/":"")}function f(e){return e.substr(-1)=="/"&&(e=e.substr(0,e.length-1)),decodeURIComponent(e)}function l(e){return e.replace(/[^\/]+\/?$/,"")}function c(e){var t=e.split("/");return e.substr(-1)=="/"?t[t.length-2]+"/":t[t.length-1]}var t=RemoteStorage,n="https://www.googleapis.com",r="https://accounts.google.com/o/oauth2/auth",i="https://www.googleapis.com/auth/drive",s="application/vnd.google-apps.folder",o="application/json; charset=UTF-8",h=function(e){this.maxAge=e,this._items={}};h.prototype={get:function(e){var t=this._items[e],n=(new Date).getTime();return t&&t.t>=n-this.maxAge?t.v:undefined},set:function(e,t){this._items[e]={v:t,t:(new Date).getTime()}}},t.GoogleDrive=function(e,n){t.eventHandling(this,"connected"),this.rs=e,this.clientId=n,this._fileIdCache=new h(300),setTimeout(function(){this.configure(undefined,undefined,undefined,localStorage["remotestorage:googledrive:token"])}.bind(this),0)},t.GoogleDrive.prototype={configure:function(e,t,n,r){r?(localStorage["remotestorage:googledrive:token"]=r,this.token=r,this.connected=!0,this._emit("connected")):(this.connected=!1,delete this.token,delete localStorage["remotestorage:googledrive:token"])},connect:function(){this.rs.setBackend("googledrive"),t.Authorize(r,i,String(document.location),this.clientId)},get:function(e,t){return e.substr(-1)=="/"?this._getDir(e,t):this._getFile(e,t)},put:function(e,t,n,r){function s(e,t){if(e)i.reject(e);else if(t.status>=200&&t.status<300){var n=JSON.parse(t.responseText);i.fulfill(200,undefined,n.mimeType,n.etag)}else i.reject("PUT failed with status "+t.status+" ("+t.responseText+")")}var i=promising();return this._getFileId(e,function(o,u){if(o){i.reject(o);return}u?this._updateFile(u,e,t,n,r,s):this._createFile(e,t,n,r,s)}),i},"delete":function(e,t){var r=promising();return this._getFileId(e,function(e,t){e?r.reject(e):t?this._request("DELETE",n+"/drive/v2/files/"+t,{},function(e,t){e?r.reject(e):t.status==200||t.status==204?r.fulfill(200):r.reject("Delete failed: "+t.status+" ("+t.responseText+")")}):r.fulfill(200)}),r},_updateFile:function(e,t,r,i,s,o){o=o.bind(this);var u={mimeType:i};this._request("PUT",n+"/upload/drive/v2/files/"+e+"?uploadType=resumable",{body:JSON.stringify(u),headers:{"Content-Type":"application/json; charset=UTF-8"}},function(e,t){e?o(e):this._request("PUT",t.getResponseHeader("Location"),{body:i.match(/^application\/json/)?JSON.stringify(r):r},o)})},_createFile:function(e,t,r,i,s){s=s.bind(this),this._getParentId(e,function(i,o){if(i){s(i);return}var u=c(e),a={title:f(u),mimeType:r,parents:[{kind:"drive#fileLink",id:o}]};this._request("POST",n+"/upload/drive/v2/files?uploadType=resumable",{body:JSON.stringify(a),headers:{"Content-Type":"application/json; charset=UTF-8"}},function(e,n){e?s(e):this._request("POST",n.getResponseHeader("Location"),{body:r.match(/^application\/json/)?JSON.stringify(t):t},s)})})},_getFile:function(e,t){var n=promising();return this._getFileId(e,function(e,t){e?n.reject(e):this._getMeta(t,function(e,t){if(e)n.reject(e);else if(t.downloadUrl){var r={};t.mimeType.match(/charset=binary/)&&(r.responseType="blob"),this._request("GET",t.downloadUrl,r,function(e,r){if(e)n.reject(e);else{var i=r.response;if(t.mimeType.match(/^application\/json/))try{i=JSON.parse(i)}catch(s){}n.fulfill(200,i,t.mimeType,t.etag)}})}else n.fulfill(200,"",t.mimeType,t.etag)})}),n},_getDir:function(e,t){var r=promising();return this._getFileId(e,function(t,i){t?r.reject(t):i?this._request("GET",n+"/drive/v2/files/"+i+"/children",{},function(t,n){if(t)r.reject(t);else if(n.status==200){var i=JSON.parse(n.responseText),s=i.items.length,u=0;if(s==0){r.fulfill(200,{},o,undefined);return}var f={},l={},c=function(t,n){if(t)console.error("getting meta stuff failed: ",t);else{var i=a(n);f[i]=n.etag,this._fileIdCache.set(e+i,n.id)}u++,u==s&&r.fulfill(200,f,o,undefined)}.bind(this);i.items.forEach(function(e){this._getMeta(e.id,c)}.bind(this))}else r.reject("request failed or something: "+n.status)}):r.fulfill(404)}),r},_getParentId:function(e,t){t=t.bind(this);var n=l(e);this._getFileId(n,function(e,r){e?t(e):r?t(null,r):this._createDir(n,t)})},_createDir:function(e,t){t=t.bind(this),this._getParentId(e,function(r,i){r?t(r):this._request("POST",n+"/drive/v2/files",{body:JSON.stringify({title:f(c(e)),mimeType:s,parents:[{id:i}]}),headers:{"Content-Type":"application/json; charset=UTF-8"}},function(e,n){if(e)t(e);else{var r=JSON.parse(n.responseText);t(null,r.id)}})})},_getFileId:function(e,t){t=t.bind(this);var n;e=="/"?t(null,"root"):(n=this._fileIdCache.get(e))?t(null,n):this._getDir(l(e)).then(function(){t(null,this._fileIdCache.get(e))}.bind(this),t)},_getMeta:function(e,t){t=t.bind(this),this._request("GET",n+"/drive/v2/files/"+e,{},function(n,r){n?t(n):r.status==200?t(null,JSON.parse(r.responseText)):t("request (getting metadata for "+e+") failed with status: "+r.status)})},_request:function(e,n,r,i){i=i.bind(this),r.headers||(r.headers={}),r.headers.Authorization="Bearer "+this.token,t.WireClient.request.call(this,e,n,r,function(e,t){if(t.status==401){this.connect();return}i(e,t)})}},t.GoogleDrive._rs_init=function(e){var n=e.apiKeys.googledrive;n&&(e.googledrive=new t.GoogleDrive(e,n.client_id),e.backend=="googledrive"&&(e._origRemote=e.remote,e.remote=e.googledrive))},t.GoogleDrive._rs_supported=function(e){return!0},t.GoogleDrive._rs_cleanup=function(e){e.setBackend(undefined),e._origRemote&&(e.remote=e._origRemote,delete e._origRemote)}}(this),function(e){function s(e){this.defaultValue=e?e:"rev",this._storage={},this.set=this.justSet}function o(e){if(e._dropboxOrigSync)return;e._dropboxOrigSync=e.sync.bind(e),e.sync=function(){return this.dropbox.fetchDelta.apply(this.dropbox,arguments).then(e._dropboxOrigSync,function(t){e._emit("error",new e.SyncError(t))})}}function u(e){if(!e._dropboxOrigSync)return;e.sync=e._dropboxOrigSync,delete e._dropboxOrigSync}function a(e){e._origBaseClientGetItemURL&&retrun,e._origBaseClientGetItemURL=t.BaseClient.prototype.getItemURL,t.BaseClient.prototype.getItemURL=function(t){var n=e.dropbox._itemRefs[t];return n?n:""}}function f(e){if(!e._origBaseClieNtGetItemURL)return;t.BaseClient.prototype.getItemURL=e._origBaseClietGetItemURL,delete e._origBaseClietGetItemURL}var t=RemoteStorage,n,r="https://www.dropbox.com/1/oauth2/authorize",i="remotestorage:dropbox";s.prototype={get:function(e){e=e.toLowerCase();var t=this._storage[e];return t||(t=this.defaultValue,this._storage[e]=t),t},propagateSet:function(e,t){return e=e.toLowerCase(),this._storage[e]==t?t:(this._propagate(e,t),this._storage[e]=t)},_activatePropagation:function(){this.set=this.propagateSet},justSet:function(e,t){return e=e.toLowerCase(),this._storage[e]=t,t},"delete":function(e){e=e.toLowerCase(),this._propagate(e),delete this._storage[e]},_propagate:function(e,t){var n=e.split("/").slice(0,-1),r=n.length,i="";for(var s=0;s<r;s++)i+=n[s]+"/",t||(t=this._storage[i]+1),this._storage[i]=t}},t.Dropbox=function(e){this.rs=e,this.connected=!1,this.rs=e,t.eventHandling(this,"change","connected"),e.on("error",function(e){e instanceof RemoteStorage.Unauthorized&&this.configure(null,null,null,null)}.bind(this)),this.clientId=e.apiKeys.dropbox.api_key,this._revCache=new s,this._itemRefs={};if(n){var r;try{r=JSON.parse(localStorage[i])}catch(o){}r&&this.configure(r.userAddress,undefined,undefined,r.token);try{this._itemRefs=JSON.parse(localStorage[i+":shares"])}catch(o){}}this.connected&&setTimeout(this._emit.bind(this),0,"connected")},t.Dropbox.prototype={connect:function(){this.rs.setBackend("dropbox"),t.Authorize(r,"",String(document.location),this.clientId)},configure:function(e,t,r,s){console.log("dropbox configure",arguments),typeof s!="undefined"&&(this.token=s),typeof useradress!="undefined"&&(this.userAddress=e),this.token?(this.connected=!0,this.useradress||this.info().then(function(e){this.userAddress=e.display_name}.bind(this)),this._emit("connected")):this.connected=!1,n&&(localStorage[i]=JSON.stringify({token:this.token,userAddress:this.userAddress}))},_getDir:function(e,t){var n="https://api.dropbox.com/1/metadata/auto"+e,r=promising(),i=this._revCache;return this._request("GET",n,{},function(t,n){if(t)r.reject(t);else{var s=n.status;if(s==304){r.fulfill(s);return}var o,u,a,f;try{u=JSON.parse(n.responseText)}catch(l){r.reject(l);return}f=this._revCache.get(e),a="application/json; charset=UTF-8",u.contents&&(o=u.contents.reduce(function(t,n){var r=n.path.split("/").slice(-1)[0]+(n.is_dir?"/":"");return n.is_dir?t[r]=i.get(e+r):t[r]=n.rev,t},{})),r.fulfill(s,o,a,f)}}),r},get:function(e,t){console.log("dropbox.get",arguments);var n="https://api-content.dropbox.com/1/files/auto"+e,r=promising().then(function(){return this.share(e),arguments}.bind(this)),i=this._revCache.get(e);return i===null?(console.log(e," deleted 404"),r.fulfill(404),r):t&&t.ifNoneMatch&&i&&i==t.ifNoneMatch?(console.log("nothing changed for",e,i,t.ifNoneMatch),r.fulfill(304),r):e.substr(-1)=="/"?this._getDir(e,t):(this._request("GET",n,{},function(t,n){if(t)r.reject(t);else{var i=n.status,s,o,u,a;if(i==200){o=n.responseText;try{s=JSON.parse(n.getResponseHeader("x-dropbox-metadata"))}catch(f){r.reject(f);return}u=s.mime_type,a=s.rev;if(u.search("application/json")>=0||!0)try{o=JSON.parse(o)}catch(f){this.rs.log("Failed parsing Json, assume it is something else then",f,f.stack,f.body)}this._revCache.set(e,a)}r.fulfill(i,o,u,a)}}),r)},put:function(e,n,r,i){if(!this.connected)throw new Error("not connected (path: "+e+")");var s=promising().then(function(){return this.share(e),arguments}.bind(this)),o=this._revCache.get(e);if(i&&i.ifMatch&&o&&o!=i.ifMatch)return s.fulfill(412),s;r.match(/charset=/)||(r+="; charset="+(n instanceof ArrayBuffer||t.WireClient.isArrayBufferView(n)?"binary":"utf-8"));var u="https://api-content.dropbox.com/1/files_put/auto/"+e+"?";return i.ifMatch&&(u+="parent_rev="+encodeURIComponent(i.ifMatch)),n.length>157286400||this._request("PUT",u,{body:n,headers:{"Content-Type":r}},function(t,n){if(t)s.reject(t);else{var r=JSON.parse(n.responseText);r.path!=e?(s.fulfill(412),rs.log("Dropbox created conflicting File ",r.path)):this._revCache.set(e,r.rev),s.fulfill(n.status)}}),s},"delete":function(e,t){console.log("dropbox.delete ",arguments);var n=promising(),r=this._revCache.get(e);if(t.ifMatch&&r&&t.ifMatch!=r)return n.fulfill(412),n;var i="https://api.dropbox.com/1/fileops/delete?root=auto&path="+encodeURIComponent(e);return this._request("POST",i,{},function(t,r){t?n.reject(error):(n.fulfill(r.status),this._revCache.delete(e))}),n.then(function(){return delete this._itemRefs[e],arguments}.bind(this))},share:function(e){var t="https://api.dropbox.com/1/media/auto"+e,r=promising();return!e.match(/^\/public\//)&&typeof this._itemRefs[e]!="undefined"?(console.log("not public or already in store",e),r.fulfill(this._itemRefs[e])):(this._request("POST",t,{},function(s,o){if(s)console.log(s),s.message='Shareing Dropbox Thingie("'+e+'") failed'+s.message,r.reject(s);else try{r.fulfill(JSON.parse(o.responseText).url),this._itemRefs[e]=t,n&&(localStorage[i+":shares"]=JSON.stringify(this._itemRefs)),console.log(o)}catch(u){s.message+="share error",r.reject(s)}}),r)},info:function(){var e="https://api.dropbox.com/1/account/info",t=promising();return this._request("GET",e,{},function(e,n){if(e)t.reject(e);else try{var r=JSON.parse(n.responseText);t.fulfill(r)}catch(i){t.reject(e)}}),t},_request:function(e,n,r,i){i=i.bind(this),r.headers||(r.headers={}),r.headers.Authorization="Bearer "+this.token,t.WireClient.request.call(this,e,n,r,function(e,t){i(e,t)}.bind(this))},fetchDelta:function(){var e=Array.prototype.slice.call(arguments),t=promising();return this._request("POST","https://api.dropbox.com/1/delta",{body:this._deltaCursor?"cursor="+encodeURIComponent(this._deltaCursor):"",headers:{"Content-Type":"application/x-www-form-urlencoded"}},function(n,r){if(n)this.rs.log("fetchDeltas",n),this.rs._emit("error",new RemoteStorage.SyncError("fetchDeltas failed"+n)),t.reject(n);else{if(r.status!=200)return r.status==400?(this.rs._emit("error",new RemoteStorage.Unauthorized),t.fulfill(e)):(console.log("!!!!dropbox.fetchDelta returned "+r.status+r.responseText),t.reject("dropbox.fetchDelta returned "+r.status+r.responseText)),t;try{var i=JSON.parse(r.responseText)}catch(n){return rs.log("fetchDeltas can not parse response",n),t.reject("can not parse response of fetchDelta : "+n.message)}if(!i.entries)return console.log("!!!!!DropBox.fetchDeltas() NO ENTRIES FOUND!!",i),t.reject("dropbox.fetchDeltas failed, no entries found");i.reset&&(this._revCache=new s,t.then(function(){var e=Array.prototype.slice.call(arguments);return this._revCache._activatePropagation(),e}.bind(this))),i.cursor&&(this._deltaCursor=i.cursor),console.log("Delta : ",i.entries),i.entries.forEach(function(e){var t=e[0],n;if(!e[1])n=null;else{if(e[1].is_dir)return;n=e[1].rev}this._revCache.set(t,n)}.bind(this)),t.fulfill.apply(t,e)}}),t}},t.Dropbox._rs_init=function(e){e.apiKeys.dropbox&&(e.dropbox=new t.Dropbox(e)),e.backend=="dropbox"&&(e._origRemote=e.remote,e.remote=e.dropbox,e.sync&&o(e),a(e))},t.Dropbox._rs_supported=function(){return n="localStorage"in e,!0},t.Dropbox._rs_cleanup=function(e){u(e),f(e),e._origRemote&&(e.remote=e._origRemote),n&&delete localStorage[i],e.setBackend(undefined)}}(this),remoteStorage=new RemoteStorage;
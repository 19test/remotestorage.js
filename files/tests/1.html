<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      var runId = localStorage.getItem('runId');
      if(!runId) {
        runId = (new Date()).getTime();
      }
      localStorage.setItem('runId', runId);
    </script>

    <script src="http://unhosted.org/remoteStorage.js">{
      category: 'test-app'+runId,
      onChange: function(key, oldValue, newValue) {
        console.info('key '+key+' was '+oldValue+' but updated from remote to '+newValue);
      }
    }</script>
    <script>
      function partOne() {
        var runId = localStorage.getItem('runId');
        localStorage.clear();
        localStorage.setItem('runId', runId);
        localStorage.setItem('foo', 'bar');
      }
      function partTwo() {
        localStorage.setItem('foo2', 'bar2');
      
      }
      function partThree() {
        var runId = localStorage.getItem('runId');
        localStorage.clear();
        localStorage.setItem('runId', runId);
      }
      function partFour() {
        if(localStorage.getItem('foo') != 'bar') {
          console.log('test 1 fail');
        } else {
          console.log('test 1 pass');
        }
        if(localStorage.getItem('foo2') != 'bar2') {
          console.log('test 2 fail');
        } else {
          console.log('test 2 pass');
        }
      }
      function startOver() {
        localStorage.clear();
        sessionStorage.clear();
        window.location='';
      }
    </script>
  </head>
  <body>
    <input type="submit" onclick="partOne();" value="click me first">
    then log in
    <input type="submit" onclick="partTwo();" value="then click me">
    then log out
    <input type="submit" onclick="partThree();" value="then click me">
    then log in again
    <input type="submit" onclick="partFour();" value="then click me">
    <br><input type="submit" onclick="startOver();" value="start over">
  </body>
</html>
